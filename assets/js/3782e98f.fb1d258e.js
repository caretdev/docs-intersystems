"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[90919],{51017:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>a,default:()=>d,frontMatter:()=>i,toc:()=>l});var s=n(74848),r=n(28453);const i={pagination_prev:null,pagination_next:null},a="%Archive.Session",l=[{value:"Parameters",id:"parameters",level:2},{value:"TYPE",id:"type",level:3},{value:"VERSION",id:"version",level:3},{value:"Properties",id:"properties",level:2},{value:"Host",id:"host",level:3},{value:"AuthFile",id:"authfile",level:3},{value:"UserName",id:"username",level:3},{value:"Password",id:"password",level:3},{value:"ApplicationName",id:"applicationname",level:3},{value:"ApplicationVersion",id:"applicationversion",level:3},{value:"BufferSizeInKB",id:"buffersizeinkb",level:3},{value:"PrefetchSizeInKB",id:"prefetchsizeinkb",level:3},{value:"EmbeddedDataThreshold",id:"embeddeddatathreshold",level:3},{value:"dllid",id:"dllid",level:3},{value:"Methods",id:"methods",level:2},{value:"GetAuthorization",id:"getauthorization",level:3},{value:"Connect",id:"connect",level:3},{value:"Disconnect",id:"disconnect",level:3},{value:"DeleteContent",id:"deletecontent",level:3},{value:"AccessContent",id:"accesscontent",level:3},{value:"%OnNew",id:"onnew",level:3},{value:"%OnClose",id:"onclose",level:3},{value:"Store",id:"store",level:3},{value:"Retrieve",id:"retrieve",level:3},{value:"LookUpDLLFunc",id:"lookupdllfunc",level:3},{value:"CheckVersion",id:"checkversion",level:3},{value:"Register",id:"register",level:3},{value:"SetEmbeddedDataThreshold",id:"setembeddeddatathreshold",level:3},{value:"SetBufferSize",id:"setbuffersize",level:3},{value:"GetErrorDetail",id:"geterrordetail",level:3},{value:"Write",id:"write",level:3},{value:"ReadNext",id:"readnext",level:3},{value:"WriteFile",id:"writefile",level:3},{value:"ReadFile",id:"readfile",level:3},{value:"WriteStream",id:"writestream",level:3},{value:"ReadStream",id:"readstream",level:3},{value:"Create",id:"create",level:3},{value:"Commit",id:"commit",level:3},{value:"Open",id:"open",level:3},{value:"Close",id:"close",level:3},{value:"SetAttribute",id:"setattribute",level:3},{value:"NewTag",id:"newtag",level:3},{value:"NextTag",id:"nexttag",level:3}];function c(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"archivesession",children:"%Archive.Session"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Class %Archive.Session Extends %RegisteredObject [ System = 4 ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"API for data archiving"}),"\n",(0,s.jsxs)(t.p,{children:["Sample script that initiates a connection to an archive server ",(0,s.jsx)(t.code,{children:"Set SessionOref = ##class(%Archive.Session).%New() Set SessionOref.Host = 123.45.6.78 // IP address of the archive server Set SessionOref.AuthFile = AuthFilePath // path of the .pea file (for Centera) Set Status = SessionOref.Connect()"})," Once connected, here is a sample script that stores a content (cf. %Archive.Content): ",(0,s.jsx)(t.code,{children:"// create a content object as source, whose handle is ContentOref (see %Archive.Content) Set Status = SessionOref.Store(ContentOref, .ContentUID)"})," After Store() returns successfully, you need to save the ContentUID value somewhere (say, in a database) for future retrieval purpose.",(0,s.jsx)(t.br,{}),"\nHere is a sample script to retrieve the file from the archive server, using the ContentUID and open connection above: ",(0,s.jsx)(t.code,{children:"// create a content object as target, whose handle is ContentOref (see %Archive.Content) Set Status = SessionOref.Retrieve(ContentOref, ContentUID)"})," Limitations:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Only EMC Centera server is supported as an archive server"}),"\n",(0,s.jsx)(t.li,{children:"The source of storing and the target of retrieval must be files"}),"\n",(0,s.jsx)(t.li,{children:"Only one open connection per process. Attempt to open additional connections (whether to the same server as the existing connection or not) would get an error."}),"\n",(0,s.jsx)(t.li,{children:'Retrieving selected files from a content containing multiple files ("blobs") is not supported.'}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(t.h3,{id:"type",children:"TYPE"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter TYPE = "Centera";\n'})}),"\n",(0,s.jsx)(t.p,{children:"Type of the archive system (EMC Centera)"}),"\n",(0,s.jsx)(t.h3,{id:"version",children:"VERSION"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Parameter VERSION = 0.1;\n"})}),"\n",(0,s.jsx)(t.p,{children:"Version of the API"}),"\n",(0,s.jsx)(t.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(t.h3,{id:"host",children:"Host"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property Host As %String;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Connection information, a comma-delimited list of IP addresses",(0,s.jsx)(t.br,{}),'\nFor example, "10.2.3.4,10.6.7.8"']}),"\n",(0,s.jsx)(t.h3,{id:"authfile",children:"AuthFile"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property AuthFile As %String;\n"})}),"\n",(0,s.jsx)(t.p,{children:"The path of a Pool Entry Authorization file (*.pea)"}),"\n",(0,s.jsx)(t.h3,{id:"username",children:"UserName"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property UserName As %Library.Username;\n"})}),"\n",(0,s.jsx)(t.p,{children:"An alternative to a PEA file is a pair of UserName and Password"}),"\n",(0,s.jsx)(t.h3,{id:"password",children:"Password"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property Password As %String;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"applicationname",children:"ApplicationName"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property ApplicationName As %String;\n"})}),"\n",(0,s.jsx)(t.p,{children:'Name of the application, default to something like "Cache for Windows (x86-32)" (from $zv)'}),"\n",(0,s.jsx)(t.h3,{id:"applicationversion",children:"ApplicationVersion"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property ApplicationVersion As %String;\n"})}),"\n",(0,s.jsx)(t.p,{children:'Version of the application, default to something like "2008.2 (Build 366U)" (from $zv)'}),"\n",(0,s.jsx)(t.h3,{id:"buffersizeinkb",children:"BufferSizeInKB"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property BufferSizeInKB As %Integer [ InitialExpression = 64, Private ];\n"})}),"\n",(0,s.jsx)(t.p,{children:"The size of an internal C-Clip buffer in bytes. This value must be greater than 0. The SDK default value is 16KB. The default value we use here is 64KB."}),"\n",(0,s.jsx)(t.h3,{id:"prefetchsizeinkb",children:"PrefetchSizeInKB"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property PrefetchSizeInKB As %Integer(MAXVAL = 1024) [ InitialExpression = 1024, Private ];\n"})}),"\n",(0,s.jsx)(t.p,{children:"The size of the prefetch buffer. This buffer is used to assist in determining the size of the blob. The SDK default size is 32 KB. The maximum size is 1 MB, which is the default value we use here."}),"\n",(0,s.jsx)(t.h3,{id:"embeddeddatathreshold",children:"EmbeddedDataThreshold"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property EmbeddedDataThreshold As %Integer(MAXVAL = 102400) [ InitialExpression = 102400, Private ];\n"})}),"\n",(0,s.jsx)(t.p,{children:"The maximum data size, in bytes, for data to be embedded in the CDF instead of being stored as separate blobs. The SDK default value is 0 bytes, meaning data is never embedded in the CDF. The maximum value is 102400 bytes (100 KB), which is the default value we use here. The value for the embedded data threshold can be set to less than or equal to 102400 bytes."}),"\n",(0,s.jsx)(t.h3,{id:"dllid",children:"dllid"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property dllid As %Integer [ Internal, MultiDimensional, Private ];\n"})}),"\n",(0,s.jsx)(t.p,{children:"dllid = DLL ID dllid(FuncName) = DLL Function ID"}),"\n",(0,s.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(t.h3,{id:"getauthorization",children:"GetAuthorization"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method GetAuthorization() As %String [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"Create a string based on AuthFile or UserName and Password. The string will be part of the connection argument for opening the pool."}),"\n",(0,s.jsx)(t.h3,{id:"connect",children:"Connect"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Connect() As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Connect to the server"}),"\n",(0,s.jsx)(t.h3,{id:"disconnect",children:"Disconnect"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Disconnect() As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Disconnect from the server"}),"\n",(0,s.jsx)(t.h3,{id:"deletecontent",children:"DeleteContent"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method DeleteContent(ContentUID As %String) As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Delete a content (C-Clip) by its UID (ContentAddress)"}),"\n",(0,s.jsx)(t.h3,{id:"accesscontent",children:"AccessContent"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method AccessContent(ContentUID As %String) As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Test the existence of a content (C-Clip) by its UID (ContentAddress)"}),"\n",(0,s.jsx)(t.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method %OnNew() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"Load DLL"}),"\n",(0,s.jsx)(t.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"Unload DLL"}),"\n",(0,s.jsx)(t.h3,{id:"store",children:"Store"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Store(ContentOref As %Archive.Content, ByRef ContentUID As %String) As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Store an entire content to server, commit and return a UID by reference"}),"\n",(0,s.jsx)(t.h3,{id:"retrieve",children:"Retrieve"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Retrieve(ContentOref As %Archive.Content, ContentUID As %String) As %Status\n"})}),"\n",(0,s.jsx)(t.p,{children:"Retrieve an entire content from server"}),"\n",(0,s.jsx)(t.h3,{id:"lookupdllfunc",children:"LookUpDLLFunc"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method LookUpDLLFunc(FuncName) As %Integer [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"checkversion",children:"CheckVersion"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method CheckVersion() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"register",children:"Register"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Register() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"setembeddeddatathreshold",children:"SetEmbeddedDataThreshold"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method SetEmbeddedDataThreshold() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"setbuffersize",children:"SetBufferSize"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method SetBufferSize() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"geterrordetail",children:"GetErrorDetail"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method GetErrorDetail() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"write",children:"Write"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Write(DataSource As %String, TagName As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"A name for the data is required and cannot be NULL"}),"\n",(0,s.jsx)(t.h3,{id:"readnext",children:"ReadNext"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method ReadNext(DataSink As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"writefile",children:"WriteFile"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method WriteFile(Path As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:'Create a tag with a \'TagName\' and stream the given file to the blob associated with the tag Acceptable characters for a TagName are ASCII characters in the Set [a-zA-Z0-9_-.]. [No restriction in Unicode version] The first character must be a letter or an underscore "_". The name must be XML compliant and cannot start with the prefix "xml" or "eclip". May generate  error'}),"\n",(0,s.jsx)(t.h3,{id:"readfile",children:"ReadFile"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method ReadFile(Path As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"Read the blob associated with the tag by the name 'TagName' to the file given by 'Path' If TagName is not specified, use the current tag (either the first tag or the tag pointed to by GetNextTag()) If TagName is not unique in the content, use the first matching tag. May generate  error"}),"\n",(0,s.jsx)(t.h3,{id:"writestream",children:"WriteStream"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:'Method WriteStream(StreamOref As %Stream, TagName As %String = "_") As %Status [ Private ]\n'})}),"\n",(0,s.jsx)(t.p,{children:"Similar to WriteFile, except that the data source is a %Stream object. NOT IMPLEMENTED."}),"\n",(0,s.jsx)(t.h3,{id:"readstream",children:"ReadStream"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method ReadStream(StreamOref As %Stream, TagName As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.p,{children:"Similar to ReadFile, except that the data sink is a %Stream object. NOT IMPLEMENTED."}),"\n",(0,s.jsx)(t.h3,{id:"create",children:"Create"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Create(ContentOref As %Archive.Content) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"commit",children:"Commit"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Commit(ByRef ContentUID As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"open",children:"Open"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Open(ContentOref As %Archive.Content, ContentUID As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"close",children:"Close"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method Close() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"setattribute",children:"SetAttribute"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method SetAttribute(AttribName As %String, AttribValue As %String) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"newtag",children:"NewTag"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method NewTag(Name) As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"nexttag",children:"NextTag"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method NextTag(ByRef Name As %String) As %Status [ Private ]\n"})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var s=n(96540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);