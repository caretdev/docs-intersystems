"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[90118],{27904:(e,s,n)=>{n.r(s),n.d(s,{contentTitle:()=>l,default:()=>o,frontMatter:()=>r,toc:()=>a});var t=n(74848),i=n(28453);const r={pagination_prev:null,pagination_next:null},l="%Net.SSH.SFTP",a=[{value:"Properties",id:"properties",level:2},{value:"Session",id:"session",level:3},{value:"Version",id:"version",level:3},{value:"SSH",id:"ssh",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnNew",id:"onnew",level:3},{value:"Dir",id:"dir",level:3},{value:"DirEnum",id:"direnum",level:3},{value:"FileInfo",id:"fileinfo",level:3},{value:"MkDir",id:"mkdir",level:3},{value:"RmDir",id:"rmdir",level:3},{value:"Delete",id:"delete",level:3},{value:"Rename",id:"rename",level:3},{value:"SymLink",id:"symlink",level:3},{value:"Put",id:"put",level:3},{value:"PutStream",id:"putstream",level:3},{value:"Get",id:"get",level:3},{value:"GetStream",id:"getstream",level:3},{value:"SetSize",id:"setsize",level:3},{value:"SetPermissions",id:"setpermissions",level:3},{value:"SetOwnerAndGroup",id:"setownerandgroup",level:3},{value:"Touch",id:"touch",level:3},{value:"SetFileTime",id:"setfiletime",level:3},{value:"SetBufferSize",id:"setbuffersize",level:3},{value:"GetBufferSize",id:"getbuffersize",level:3},{value:"%OnClose",id:"onclose",level:3},{value:"CloseSFTP",id:"closesftp",level:3},{value:"Test",id:"test",level:3},{value:"TestPut",id:"testput",level:3},{value:"Permissions2Text",id:"permissions2text",level:3},{value:"UTCFileTime2H",id:"utcfiletime2h",level:3},{value:"H2UTCFileTime",id:"h2utcfiletime",level:3},{value:"parseMode",id:"parsemode",level:3},{value:"fnremote",id:"fnremote",level:3},{value:"fnlocal",id:"fnlocal",level:3},{value:"dircallback",id:"dircallback",level:3},{value:"genPattern",id:"genpattern",level:3}];function c(e){const s={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"netsshsftp",children:"%Net.SSH.SFTP"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Class %Net.SSH.SFTP Extends %RegisteredObject [ System = 3 ]\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"For information on using this class"}),", see ",(0,t.jsx)(s.a,{href:"/csp/docbook/DocBook.UI.Page.cls?FIND=CLASSES+%25Net.SSH.SFTP",children:"Using SSH"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["A wrapper object for an SFTP session running over and existing SSH connection. Use the OpenSFTP() method of a previously connected and authenticated %Net.SSH.Session to instantiate a valid SFTP object for use.",(0,t.jsx)(s.br,{}),"\nYou should ",(0,t.jsx)(s.strong,{children:"NOT"})," create instances of %Net.SSH.SFTP directly!",(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.strong,{children:"NOTE:"})," %Net.SSH is currently not supported on OpenVMS platforms."]}),"\n",(0,t.jsx)(s.h2,{id:"properties",children:"Properties"}),"\n",(0,t.jsx)(s.h3,{id:"session",children:"Session"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property Session As %String [ Internal, Private ];\n"})}),"\n",(0,t.jsx)(s.p,{children:"SFTP Session handle"}),"\n",(0,t.jsx)(s.h3,{id:"version",children:"Version"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property Version As %Integer;\n"})}),"\n",(0,t.jsx)(s.p,{children:"SFTP Remote Server Version"}),"\n",(0,t.jsx)(s.h3,{id:"ssh",children:"SSH"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property SSH As %Net.SSH.Session;\n"})}),"\n",(0,t.jsx)(s.p,{children:"SSH Session that hosts this SFTP session."}),"\n",(0,t.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,t.jsx)(s.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method %OnNew(ssh As %Net.SSH.Session, sftp As %RawString) As %Status [ Private, ProcedureBlock = 1, ServerOnly = 1 ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"dir",children:"Dir"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Method Dir(directory As %String, ByRef contents, spec As %String = "", dotFiles As %Boolean = 0) As %Status [ PublicList = (contents, pattern, filter) ]\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Enumerate the contents of a directory. Populates the contents array with $LIST entries for each file in the directory, subscripted by a integer sequence, the $LIST is composed in the same format as with the FileInfo() method.",(0,t.jsx)(s.br,{}),"\nThe optional spec parameter allows for wildcards when searching the directory. The wildcards that can be used are as follows:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"*: Match zero or more characters"}),"\n",(0,t.jsx)(s.li,{children:"?: Match exactly one character\nSome examples are:"}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.em,{children:".txt journal_???."})," 201?-??-??.log"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"direnum",children:"DirEnum"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method DirEnum(directory As %String, oref As %RegisteredObject, method As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Enumerate the contents of a directory by calling the specified instance method once for each entry in the directory. The signature of the callback should take two arguments, first an integer sequence number and secondly a $LIST composed in the same format as with the FileInfo() method (see FileInfo)."}),"\n",(0,t.jsx)(s.h3,{id:"fileinfo",children:"FileInfo"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method FileInfo(file As %String, ByRef info As %List) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Gets information about a file. On return, info is a $LIST containing: 1) Filename 2) Size 3) File type P: Named pipe (FIFO) C: Character special D: Directory B: Block special F: Regular file L: Symbolic link S: Socket U: Unknown 4) Permissions 5) UID 6) GID 7) Last Access Time 8) Last Modification Time Depending on the remote system, some information may not be available and will be indicated by a null list element."}),"\n",(0,t.jsx)(s.h3,{id:"mkdir",children:"MkDir"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Method MkDir(directory As %String, remotemode As %String = "0700") As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Create a new directory on the remote server, with the specified file mode (access)."}),"\n",(0,t.jsx)(s.h3,{id:"rmdir",children:"RmDir"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method RmDir(directory As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Remove a directory on the remote server"}),"\n",(0,t.jsx)(s.h3,{id:"delete",children:"Delete"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method Delete(file As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Delete a file on the remote server"}),"\n",(0,t.jsx)(s.h3,{id:"rename",children:"Rename"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method Rename(old As %String, new As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Rename a file on the remote server"}),"\n",(0,t.jsx)(s.h3,{id:"symlink",children:"SymLink"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SymLink(source As %String, target As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Create a symlink on the remote server"}),"\n",(0,t.jsx)(s.h3,{id:"put",children:"Put"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Method Put(local As %String, remote As %String, remotemode As %String = "0600", append As %Boolean = 0) As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Put a file from the local filesystem to the remote server, setting the specified mode (access)."}),"\n",(0,t.jsx)(s.h3,{id:"putstream",children:"PutStream"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Method PutStream(stream As %Stream.Object, remote As %String, remotemode As %String = "0600", append As %Boolean = 0) As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Put a stream to the remote system, setting the specified mode (access). If stream is a file stream we will just link to the file already present, otherwise we create a temp file to send."}),"\n",(0,t.jsx)(s.h3,{id:"get",children:"Get"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Method Get(remote As %String, local As %String, localmode As %String = "0600", append As %Boolean = 0) As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Get a file from the remote system, storing it in the local file system with the specified mode (access)."}),"\n",(0,t.jsx)(s.h3,{id:"getstream",children:"GetStream"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method GetStream(remote As %String, ByRef stream As %Stream.Object, append As %Boolean = 0) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Get a file from the remote system, storing it in the stream. If stream not defined on entry it will create a stream for this automatically. If stream is a file stream we will just link to the file we created."}),"\n",(0,t.jsx)(s.h3,{id:"setsize",children:"SetSize"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetSize(remote As %String, size As %Integer) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Change the size of the specified file (by either truncating or extending it)."}),"\n",(0,t.jsx)(s.h3,{id:"setpermissions",children:"SetPermissions"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetPermissions(remote As %String, mode As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Change the permissions mode for the specified file or directory."}),"\n",(0,t.jsx)(s.h3,{id:"setownerandgroup",children:"SetOwnerAndGroup"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetOwnerAndGroup(remote As %String, uid As %Integer, gid As %Integer) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Change the uid/gid for the specified file or directory (you must be the current owner or root)."}),"\n",(0,t.jsx)(s.h3,{id:"touch",children:"Touch"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method Touch(remote As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Touch the file to have an access time of now."}),"\n",(0,t.jsx)(s.h3,{id:"setfiletime",children:"SetFileTime"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetFileTime(remote As %String, atimeUTC As %TimeStamp, mtimeUTC As %TimeStamp) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Change the access and last modification times for the specified file (you must be the current owner or root). NOTE: Timestamp values must be in UTC time (see $ZTIMESTAMP)."}),"\n",(0,t.jsx)(s.h3,{id:"setbuffersize",children:"SetBufferSize"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetBufferSize(pBufferSize As %Integer) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Sets the transfer buffer size for SFTP operations (in bytes). The default is 1MB, performance may be degraded when this is set to small values."}),"\n",(0,t.jsx)(s.h3,{id:"getbuffersize",children:"GetBufferSize"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method GetBufferSize(ByRef pBufferSize As %Integer) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Gets the transfer buffer size for SFTP operations (in bytes)."}),"\n",(0,t.jsx)(s.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Clean up any resources"}),"\n",(0,t.jsx)(s.h3,{id:"closesftp",children:"CloseSFTP"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method CloseSFTP() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Close the SFTP session"}),"\n",(0,t.jsx)(s.h3,{id:"test",children:"Test"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod Test(host As %String, username As %String, password As %String, dir As %String = "/etc", spec As %String = "", dotFiles As %Boolean = 1, ByRef t) As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Demonstrates use of an SFTP session to enumerate the contents of the /etc directory on the remote server."}),"\n",(0,t.jsx)(s.h3,{id:"testput",children:"TestPut"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod TestPut(host As %String, username As %String, password As %String, srcfile As %String, destfile As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Demonstrates use of an SFTP session to put a file to the remote server."}),"\n",(0,t.jsx)(s.h3,{id:"permissions2text",children:"Permissions2Text"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod Permissions2Text(permissions As %Integer) As %String\n"})}),"\n",(0,t.jsx)(s.p,{children:"Convert UNIX permissions flags to a string"}),"\n",(0,t.jsx)(s.h3,{id:"utcfiletime2h",children:"UTCFileTime2H"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod UTCFileTime2H(filetime As %Integer) As %String\n"})}),"\n",(0,t.jsx)(s.p,{children:"Convert UNIX file time to $HOROLOG, for UNIX time is the number of seconds since Midnight Jan 1, 1970 which has a $HOROLOG date of 47117,0"}),"\n",(0,t.jsx)(s.h3,{id:"h2utcfiletime",children:"H2UTCFileTime"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod H2UTCFileTime(horolog As %String) As %Integer\n"})}),"\n",(0,t.jsx)(s.p,{children:"Convert $HOROLOG to UNIX file time; note that UNIX time is the number of seconds since Midnight Jan 1, 1970 which has a $HOROLOG date of 47117,0"}),"\n",(0,t.jsx)(s.h3,{id:"parsemode",children:"parseMode"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod parseMode(mode As %String, defaultmode As %Integer = 384) As %Integer [ Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Parse a UNIX 'chmod' style filemode into the integer value"}),"\n",(0,t.jsx)(s.h3,{id:"fnremote",children:"fnremote"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method fnremote(pIn As %String, pDirection As %String) As %Integer [ CodeMode = expression, Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Internal helper method to convert filenames. If the SFTP version is >3, we use UTF8, otherwise we use the value of RemoteCharset (if not specified, then nothing is done)."}),"\n",(0,t.jsx)(s.h3,{id:"fnlocal",children:"fnlocal"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method fnlocal(pIn As %String, pDirection As %String) As %Integer [ CodeMode = expression, Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Internal helper method to convert filenames to the local character set (if not specified, then nothing is done)."}),"\n",(0,t.jsx)(s.h3,{id:"dircallback",children:"dircallback"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method dircallback(pIndex As %Integer, pFileInfo As %List) [ Internal, PublicList = (contents, pattern, filter) ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Internal helper method to act as a callback for directory enumeration."}),"\n",(0,t.jsx)(s.h3,{id:"genpattern",children:"genPattern"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod genPattern(pSpec As %String) As %String [ Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Passed a pattern match this returns an COS style pattern and a start and stop point."})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var t=n(96540);const i={},r=t.createContext(i);function l(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);