"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[97777],{18691:(e,s,r)=>{r.r(s),r.d(s,{contentTitle:()=>a,default:()=>d,frontMatter:()=>t,toc:()=>i});var l=r(74848),n=r(28453);const t={pagination_prev:null,pagination_next:null},a="%SQL.Manager.QButtons.Base",i=[{value:"Parameters",id:"parameters",level:2},{value:"DOMAIN",id:"domain",level:3},{value:"XMLNAME",id:"xmlname",level:3},{value:"ROWLEVELSECURITY",id:"rowlevelsecurity",level:3},{value:"Properties",id:"properties",level:2},{value:"QueryStatement",id:"querystatement",level:3},{value:"QueryPlan",id:"queryplan",level:3},{value:"QueryCompileStatus",id:"querycompilestatus",level:3},{value:"QueryIntCode",id:"queryintcode",level:3},{value:"QueryPlanArray",id:"queryplanarray",level:3},{value:"ClassList",id:"classlist",level:3},{value:"ClassDefXml",id:"classdefxml",level:3},{value:"VersionString",id:"versionstring",level:3},{value:"QueryResultData",id:"queryresultdata",level:3},{value:"WRCNumber",id:"wrcnumber",level:3},{value:"TimeInserted",id:"timeinserted",level:3},{value:"UserInserted",id:"userinserted",level:3},{value:"QueryCompileDecomposedStatus",id:"querycompiledecomposedstatus",level:3},{value:"IncludeResults",id:"includeresults",level:3},{value:"AllowDelimitedIdentifiers",id:"allowdelimitedidentifiers",level:3},{value:"DefaultSchema",id:"defaultschema",level:3},{value:"BackgroundJobNumber",id:"backgroundjobnumber",level:3},{value:"Methods",id:"methods",level:2},{value:"%SecurityPolicy",id:"securitypolicy",level:3},{value:"FetchPlan",id:"fetchplan",level:3},{value:"FetchClassDef",id:"fetchclassdef",level:3},{value:"BuildClassList",id:"buildclasslist",level:3},{value:"GetVersion",id:"getversion",level:3},{value:"InsertQuery",id:"insertquery",level:3},{value:"ListCharStrip",id:"listcharstrip",level:3},{value:"ClearData",id:"cleardata",level:3},{value:"ClearRow",id:"clearrow",level:3},{value:"WRCRowExists",id:"wrcrowexists",level:3},{value:"FindQueryById",id:"findquerybyid",level:3},{value:"WriteAllToFile",id:"writealltofile",level:3},{value:"ConsumeReport",id:"consumereport",level:3},{value:"LoadClassDefs",id:"loadclassdefs",level:3},{value:"LoadIntCode",id:"loadintcode",level:3}];function c(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"sqlmanagerqbuttonsbase",children:"%SQL.Manager.QButtons.Base"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Class %SQL.Manager.QButtons.Base Extends (%Persistent, %XML.Adaptor) [ System = 4 ]\n"})}),"\n",(0,l.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,l.jsx)(s.h3,{id:"domain",children:"DOMAIN"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'Parameter DOMAIN = "%Utility";\n'})}),"\n",(0,l.jsx)(s.h3,{id:"xmlname",children:"XMLNAME"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'Parameter XMLNAME = "QButton";\n'})}),"\n",(0,l.jsx)(s.h3,{id:"rowlevelsecurity",children:"ROWLEVELSECURITY"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Parameter ROWLEVELSECURITY = 1;\n"})}),"\n",(0,l.jsx)(s.h2,{id:"properties",children:"Properties"}),"\n",(0,l.jsx)(s.h3,{id:"querystatement",children:"QueryStatement"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryStatement As %String(MAXLEN = 32000) [ Required ];\n"})}),"\n",(0,l.jsx)(s.p,{children:"Stores the actual query statement, if you really need more than 32k, enable long strings and change the MAXLEN"}),"\n",(0,l.jsx)(s.h3,{id:"queryplan",children:"QueryPlan"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryPlan As %Stream.GlobalCharacter(CLASSNAME = 2);\n"})}),"\n",(0,l.jsx)(s.p,{children:"Stream containing the query's plan as built by the optimizer"}),"\n",(0,l.jsx)(s.h3,{id:"querycompilestatus",children:"QueryCompileStatus"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryCompileStatus As %Status [ InitialExpression = 0, Required ];\n"})}),"\n",(0,l.jsx)(s.p,{children:"Property to tell if QueryPlan was built and is valid, otherwise contains the query's compilation error"}),"\n",(0,l.jsx)(s.h3,{id:"queryintcode",children:"QueryIntCode"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryIntCode As %Stream.GlobalCharacter(CLASSNAME = 2);\n"})}),"\n",(0,l.jsx)(s.p,{children:"Stream containing compiled int code as exported XML"}),"\n",(0,l.jsx)(s.h3,{id:"queryplanarray",children:"QueryPlanArray"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryPlanArray As list Of %String(MAXLEN = 32000);\n"})}),"\n",(0,l.jsx)(s.p,{children:"Array of %plan for query plan"}),"\n",(0,l.jsx)(s.h3,{id:"classlist",children:"ClassList"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property ClassList As list Of %String(MAXLEN = 500);\n"})}),"\n",(0,l.jsx)(s.p,{children:"List of all classes referenced by the query statement"}),"\n",(0,l.jsx)(s.h3,{id:"classdefxml",children:"ClassDefXml"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property ClassDefXml As %Stream.GlobalCharacter(CLASSNAME = 2);\n"})}),"\n",(0,l.jsx)(s.p,{children:"Stream containing XML export of all class definitions referenced by the query statement"}),"\n",(0,l.jsx)(s.h3,{id:"versionstring",children:"VersionString"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property VersionString As %String(MAXLEN = 500) [ Required ];\n"})}),"\n",(0,l.jsx)(s.p,{children:"simply contains $zv"}),"\n",(0,l.jsx)(s.h3,{id:"queryresultdata",children:"QueryResultData"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryResultData As %Stream.GlobalCharacter(CLASSNAME = 2);\n"})}),"\n",(0,l.jsx)(s.p,{children:"Stream containing the results of the query as %XML.Dataset output"}),"\n",(0,l.jsx)(s.h3,{id:"wrcnumber",children:"WRCNumber"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property WRCNumber As %Integer [ Required ];\n"})}),"\n",(0,l.jsx)(s.p,{children:"WRC Number provided by the user"}),"\n",(0,l.jsx)(s.h3,{id:"timeinserted",children:"TimeInserted"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property TimeInserted As %String [ SqlComputeCode = { s {TimeInserted}=$zdt($zts,3,3)}, SqlComputed ];\n"})}),"\n",(0,l.jsx)(s.h3,{id:"userinserted",children:"UserInserted"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property UserInserted As %String [ SqlComputeCode = { s {UserInserted}=$username}, SqlComputed ];\n"})}),"\n",(0,l.jsx)(s.h3,{id:"querycompiledecomposedstatus",children:"QueryCompileDecomposedStatus"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property QueryCompileDecomposedStatus As %String [ SqlComputeCode = { s {QueryCompileDecomposedStatus}=##class(%Status).LogicalToOdbc({QueryCompileStatus})}, SqlComputed ];\n"})}),"\n",(0,l.jsx)(s.h3,{id:"includeresults",children:"IncludeResults"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property IncludeResults As %Boolean;\n"})}),"\n",(0,l.jsx)(s.p,{children:"This property has no effect, but remains available for compatibility. Use %SQL.Statement to generate query results"}),"\n",(0,l.jsx)(s.h3,{id:"allowdelimitedidentifiers",children:"AllowDelimitedIdentifiers"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property AllowDelimitedIdentifiers As %Boolean;\n"})}),"\n",(0,l.jsx)(s.h3,{id:"defaultschema",children:"DefaultSchema"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property DefaultSchema As %String;\n"})}),"\n",(0,l.jsx)(s.h3,{id:"backgroundjobnumber",children:"BackgroundJobNumber"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Property BackgroundJobNumber As %Integer;\n"})}),"\n",(0,l.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,l.jsx)(s.h3,{id:"securitypolicy",children:"%SecurityPolicy"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod %SecurityPolicy(UserInserted As %String) As %String [ SqlProc ]\n"})}),"\n",(0,l.jsx)(s.h3,{id:"fetchplan",children:"FetchPlan"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Method FetchPlan() As %Status [ Internal ]\n"})}),"\n",(0,l.jsx)(s.p,{children:"This method builds the query plan and stores it in a stream that will be part of the report."}),"\n",(0,l.jsx)(s.h3,{id:"fetchclassdef",children:"FetchClassDef"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Method FetchClassDef() As %Status [ Internal ]\n"})}),"\n",(0,l.jsx)(s.p,{children:"This method exports the class definitions for each of the classes referenced in the query statement into a stream that is stored inside the report"}),"\n",(0,l.jsx)(s.h3,{id:"buildclasslist",children:"BuildClassList"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Method BuildClassList() As %Status [ ProcedureBlock = 0 ]\n"})}),"\n",(0,l.jsx)(s.p,{children:"This method uses the mtc array created by the query compilation process to find all the classes referenced by the query statement"}),"\n",(0,l.jsx)(s.h3,{id:"getversion",children:"GetVersion"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"Method GetVersion() [ Internal ]\n"})}),"\n",(0,l.jsx)(s.h3,{id:"insertquery",children:"InsertQuery"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod InsertQuery(query As %String = "", wrcnum As %String = "NoWRCProvided", includeresults As %Boolean = 0, debug As %Boolean = 0) As %Status\n'})}),"\n",(0,l.jsx)(s.p,{children:"Adds a query to the report, writes out report if a file name is provided This is the main method customer will use to generate reports to be sent to InterSystems Support"}),"\n",(0,l.jsx)(s.h3,{id:"listcharstrip",children:"ListCharStrip"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ListCharStrip(ByRef stream As %Stream.TmpCharacter)\n"})}),"\n",(0,l.jsx)(s.h3,{id:"cleardata",children:"ClearData"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod ClearData(wrcnum As %String = "") As %Status\n'})}),"\n",(0,l.jsx)(s.p,{children:"Delete any previous queries that have been added to the report"}),"\n",(0,l.jsx)(s.h3,{id:"clearrow",children:"ClearRow"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ClearRow(filter As %String) As %Status\n"})}),"\n",(0,l.jsx)(s.h3,{id:"wrcrowexists",children:"WRCRowExists"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod WRCRowExists(wrc As %String) As %Boolean\n"})}),"\n",(0,l.jsx)(s.h3,{id:"findquerybyid",children:"FindQueryById"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod FindQueryById(id As %String) As %String\n"})}),"\n",(0,l.jsx)(s.h3,{id:"writealltofile",children:"WriteAllToFile"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod WriteAllToFile(wrcnum As %String, ByRef filename As %String) As %Status\n"})}),"\n",(0,l.jsx)(s.p,{children:"Writes XML report of all queries added so far"}),"\n",(0,l.jsx)(s.h3,{id:"consumereport",children:"ConsumeReport"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod ConsumeReport(filename As %String, qspec As %String = "ck", loadcode As %Boolean = 1, NameSpace As %String) As %Status\n'})}),"\n",(0,l.jsx)(s.p,{children:"consume report. This is intended to be used by Intersystems Support to consume the report generated by the customer It is best to run this in an empty namespace as it will import and compile class definitions and routines"}),"\n",(0,l.jsx)(s.h3,{id:"loadclassdefs",children:"LoadClassDefs"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'Method LoadClassDefs(qspec As %String = "ck", ByRef loadedlist) As %Status\n'})}),"\n",(0,l.jsx)(s.p,{children:"Import and compile the class definitions in the report"}),"\n",(0,l.jsx)(s.h3,{id:"loadintcode",children:"LoadIntCode"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-objectscript-class",children:'Method LoadIntCode(qspec As %String = "ck", ByRef loadedlist) As %Status\n'})}),"\n",(0,l.jsx)(s.p,{children:"Import and compile the query routine int code in the report"})]})}function d(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453:(e,s,r)=>{r.d(s,{R:()=>a,x:()=>i});var l=r(96540);const n={},t=l.createContext(n);function a(e){const s=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),l.createElement(t.Provider,{value:s},e.children)}}}]);