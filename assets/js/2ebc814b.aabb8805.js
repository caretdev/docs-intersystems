"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[68458],{77229:(e,r,t)=>{t.r(r),t.d(r,{contentTitle:()=>l,default:()=>c,frontMatter:()=>a,toc:()=>i});var n=t(74848),s=t(28453);const a={pagination_prev:null,pagination_next:null},l="%SYS.PTools.SQLBenchMarkQueries",i=[{value:"Properties",id:"properties",level:2},{value:"QueryText",id:"querytext",level:3},{value:"NameSpace",id:"namespace",level:3},{value:"PValues",id:"pvalues",level:3},{value:"RunTime",id:"runtime",level:3},{value:"JobNumber",id:"jobnumber",level:3},{value:"SQLIndexHash",id:"sqlindexhash",level:3},{value:"Triggers",id:"triggers",level:2},{value:"OnDelete",id:"ondelete",level:3},{value:"Methods",id:"methods",level:2},{value:"Run",id:"run",level:3},{value:"Parse",id:"parse",level:3},{value:"clearSQLBenchMarkQry",id:"clearsqlbenchmarkqry",level:3},{value:"Purge",id:"purge",level:3},{value:"TriggerOnDelete",id:"triggerondelete",level:3}];function o(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"sysptoolssqlbenchmarkqueries",children:"%SYS.PTools.SQLBenchMarkQueries"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Class %SYS.PTools.SQLBenchMarkQueries Extends %Persistent [ System = 4 ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"This Class gets populated from the %SYS.PTools.SQLStats.startSQLStats() method when gathering stats is turned on. There is more info on how to run Stats in %SYS.PTools.SQLStats."}),"\n",(0,n.jsx)(r.p,{children:"The class contains the SQLText, the Job Number, the Time Stamp from when the query was run, the SQLIndexHash, which is a unique ID for the SQL Statement Index, and the Parameters that were used."}),"\n",(0,n.jsx)(r.p,{children:"The Method Run will loop over all the saved queries and execute them one after the other."}),"\n",(0,n.jsx)(r.p,{children:'Because ^%SYS.PTools.BenchMarkResults stores data in the "IRISLOCALDATA" database you need to have %All to execute the Run() method.'}),"\n",(0,n.jsx)(r.h2,{id:"properties",children:"Properties"}),"\n",(0,n.jsx)(r.h3,{id:"querytext",children:"QueryText"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property QueryText As %String(MAXLEN = 15000);\n"})}),"\n",(0,n.jsx)(r.h3,{id:"namespace",children:"NameSpace"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property NameSpace As %String;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"pvalues",children:"PValues"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property PValues As array Of %String(MAXLEN = 2000);\n"})}),"\n",(0,n.jsx)(r.h3,{id:"runtime",children:"RunTime"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property RunTime As %TimeStamp;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"jobnumber",children:"JobNumber"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property JobNumber As %String;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"sqlindexhash",children:"SQLIndexHash"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property SQLIndexHash As %String(MAXLEN = 32);\n"})}),"\n",(0,n.jsxs)(r.p,{children:['Internal unique statement hash used as the ID for the SQL Statement Index (DPV4651): ^rINDEXSQL("sqlidx",1,{SQLIndexHash},...) ^rINDEXSQL("sqlidx",2,{rtn},{SQLIndexHash}) ^rINDEXSQL("sqlidx",3,{table},{SQLIndexHash}) For additional details, refer to the following: ',(0,n.jsx)(r.a,{href:"http://twiki.iscinternal.com/twiki/bin/view/ISC/SQL20Statement20Indexing",children:"http://twiki.iscinternal.com/twiki/bin/view/ISC/SQL20Statement20Indexing"})," Also, refer to the following methods in the %SYS.SQLSRVR.MAC routine: - SaveSQLIndex(...) - UnfreezePlan(...) - FreezePlanSchema(...) - CleanSQLIndex(...) - SaveSQLIndexImport(...) - FreezePlan(...) - FreezePlanRelation(...) - ... - UpdateSQLIndex(...) - FreezePlanAll(...) - DeleteSQLIndex(...)"]}),"\n",(0,n.jsx)(r.h2,{id:"triggers",children:"Triggers"}),"\n",(0,n.jsx)(r.h3,{id:"ondelete",children:"OnDelete"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Trigger OnDelete [ Event = DELETE, Time = AFTER ]\n"})}),"\n",(0,n.jsx)(r.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(r.h3,{id:"run",children:"Run"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod Run(NameSpace As %String, Display As %Integer = 1) As %Status\n"})}),"\n",(0,n.jsx)(r.p,{children:"This is a simple example of what can be done with the data stored in this table."}),"\n",(0,n.jsx)(r.p,{children:"This methods take 2 parameters:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"NameSpace - the NameSpace where you want to run the Benchmark"}),"\n",(0,n.jsx)(r.li,{children:"Display - 1 or 0 to control output to the screen"}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"This method will loop over the queries that are stored in this classes and execute them as Dynamic SQL statements SQLStats is turned off for this run and the state is returned when the code finishes The code will display and save data for fetching the first row and for fetching all the rows The data saved will be: Global Refs, Lines of Code, Rows Returned, and Total Time. All the results are stored in the %SYS.SQLBenchMarkResults class."}),"\n",(0,n.jsx)(r.h3,{id:"parse",children:"Parse"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod Parse(sql) As %String\n"})}),"\n",(0,n.jsx)(r.h3,{id:"clearsqlbenchmarkqry",children:"clearSQLBenchMarkQry"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'ClassMethod clearSQLBenchMarkQry(ns As %String = "", rtn As %String = "", ph3 As %Integer = 0, clearErrs As %Integer = 0, returnType As %Integer = 0, ByRef ptInfo As %RawString) As %Status [ Deprecated, SqlName = PT_clearSQLBenchMarkQry, SqlProc ]\n'})}),"\n",(0,n.jsx)(r.p,{children:"-- DEPRECATED --- DEPRECATED --- DEPRECATED --- DEPRECATED --- DEPRECATED --  Method: clearSQLBenchMarkQry [SQL: PT_clearSQLBenchMarkQry] Replaced BY: N/A Status: New Functionality Purpose: Delete all of the data stored in the '%SYS.PTools.SQLBenchMarkQueries' class, based on the specified parameters... Invocation: This method can be invoked in the following ways: ObjectScript: ##class(%SYS.PTools.SQLBenchMarkQueries).clearSQLBenchMarkQry(...) SQL: CALL %SYS_PTools.PT_clearSQLBenchMarkQry(...) SELECT %SYS_PTools.PT_clearSQLBenchMarkQry(...) NOTE: This 'SqlProc' method can be invoked with either the CALL-interface or the SELECT-interface. Both interfaces execute the method: the CALL-interface does not return any resulting value, while the SELECT-interface does. Examples: The following examples shows the use of this method: #1 Delete all of the data stored in the '%SYS.PTools.SQLBenchMarkQueries' class in the 'SAMPLES' namespace: set stats=##class(%SYS.PTools.SQLBenchMarkQueries).clearSQLBenchMarkQry(\"SAMPLES\") Data Storage: ^%sqlcq($NAMESPACE,\"PTools\",\"Bench\",\"Queries\",\"{D|I|C|S}\") Parameters: ns - The namespace in which to clear SQL Statistics If none provided, use the current namespaces where SQL Stats collected [DEFAULT: Current Namespace] rtn - The routine for which to clear SQL Statistics If none provided, clear all routines in the given 'ns' [OPTIONAL] ph3 - Placeholder Parameter for future extensibility clearAll - 0 = Perform a normal clear, but leave the 'INFO' rows 1 = Clear everything including the 'INFO' rows [DEFAULT: 0] clearErrs - 0 = Don't delete the 'PTools' Application Errors 1 = Delete all of the 'PTools' Application Errors [DEFAULT: 0] returnType - 0 = Return a %Status code of either $$$OK or $$$ERROR() 1 = Return the number of Stats rows deleted from the following class: %SYS.PTools.SQLBenchMarkQueries [DEFAULT: 0] ptInfo - A Pass By Reference information array that returns detailed information to the user in the following format: ptInfo(category,variable)=value OR $LB(val1,...,valn) Where category = { \"cnt\" | \"curr\" | \"term\" | ... } variable = A var corresponding to the given 'category' Example: ptInfo(\"cnt\",\"clearSQLBenchMarkQry\")=The number of rows deleted via this method [Routine Method] RETURN Value: Based on the value of the 'returnType' parameter, return one of the following: 0: Return a %Status code of either $$$OK or $$$ERROR() 1: Return the number of Stats rows deleted from the following class; Otherwise, return an error message if an error occurred: %SYS.PTools.SQLBenchMarkQueries"}),"\n",(0,n.jsx)(r.h3,{id:"purge",children:"Purge"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'ClassMethod Purge(ns As %String = "", rtn As %String = "", ph3 As %Integer = 0, clearErrs As %Integer = 0, returnType As %Integer = 0, ByRef ptInfo As %RawString) As %Status [ SqlName = PurgeBench, SqlProc ]\n'})}),"\n",(0,n.jsx)(r.p,{children:"This method is called to remove SQL Benchmark Stats data from the following two classes: - %SYS.PTools.SQLBenchMarkQueries - %SYS.PTools.SQLBenchMarkResults Backward-compatible Entry Point: NOTE: For additional details, see the following methods in their respective aforementioned classes: - clearSQLBenchMarkQry - clearSQLBenchMarkRslt"}),"\n",(0,n.jsx)(r.h3,{id:"triggerondelete",children:"TriggerOnDelete"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod TriggerOnDelete(timing)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Perform the OnDelete Trigger operations for this class..."})]})}function c(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>l,x:()=>i});var n=t(96540);const s={},a=n.createContext(s);function l(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);