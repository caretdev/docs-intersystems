"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[17386],{67047:(e,n,r)=>{r.r(n),r.d(n,{contentTitle:()=>i,default:()=>a,frontMatter:()=>l,toc:()=>o});var s=r(74848),t=r(28453);const l={pagination_prev:null,pagination_next:null},i="%Library.COSCallout",o=[{value:"Properties",id:"properties",level:2},{value:"BinDir",id:"bindir",level:3},{value:"DLLCallMode",id:"dllcallmode",level:3},{value:"DLLHandle",id:"dllhandle",level:3},{value:"DLLResultCode",id:"dllresultcode",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnClose",id:"onclose",level:3},{value:"Compile",id:"compile",level:3},{value:"ConfigName",id:"configname",level:3},{value:"ConfigPath",id:"configpath",level:3},{value:"InvokeDLL",id:"invokedll",level:3},{value:"ZF5",id:"zf5",level:3},{value:"ZF6",id:"zf6",level:3},{value:"PathToDLL",id:"pathtodll",level:3},{value:"SetDefaultBinDir",id:"setdefaultbindir",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"librarycoscallout",children:"%Library.COSCallout"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Class %Library.COSCallout Extends %RegisteredObject [ System = 4 ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Transform COS source code to a parse tree"}),"\n",(0,s.jsx)(n.p,{children:"Internal ISC code, not for customer use - these interfaces may change without warning"}),"\n",(0,s.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(n.h3,{id:"bindir",children:"BinDir"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property BinDir As %String(TRUNCATE = 1);\n"})}),"\n",(0,s.jsx)(n.p,{children:"The directory for CacheObjectScript.DLL."}),"\n",(0,s.jsx)(n.p,{children:'Defaults to the instance\'s "Bin" directory - change it if you want to debug a different version of the DLL.'}),"\n",(0,s.jsx)(n.h3,{id:"dllcallmode",children:"DLLCallMode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property DLLCallMode As %Integer [ InitialExpression = 3 ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"How we call the DLL"}),"\n",(0,s.jsx)(n.p,{children:"Takes one of the following values :-"}),"\n",(0,s.jsx)(n.p,{children:"1 - use $ZF(-3) ... handy for debugging the DLL because it doesn't stay loaded"}),"\n",(0,s.jsx)(n.p,{children:"2 - use $ZF(-4)/$ZF(-5) ... to cache the DLL handle"}),"\n",(0,s.jsx)(n.p,{children:"3 - use $ZF(-4)/$ZF(-6) ... the default - there's normally no reason to change it"}),"\n",(0,s.jsx)(n.p,{children:"Initialised to 3"}),"\n",(0,s.jsx)(n.h3,{id:"dllhandle",children:"DLLHandle"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property DLLHandle As %Integer [ InitialExpression = 0 ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"The cached DLLHandle (used only when DLLCallMode=2)"}),"\n",(0,s.jsx)(n.h3,{id:"dllresultcode",children:"DLLResultCode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property DLLResultCode As %String(TRUNCATE = 1);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Set to a result code string"}),"\n",(0,s.jsx)(n.p,{children:"Mainly of use to Intersystems support."}),"\n",(0,s.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status\n"})}),"\n",(0,s.jsx)(n.h3,{id:"compile",children:"Compile"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method Compile(SourceStream As %RawString, ErrorsStream As %RawString, ByRef ColoringErrors As %Boolean) As %Boolean\n"})}),"\n",(0,s.jsx)(n.p,{children:"Convert the given COS source code to a parse tree"}),"\n",(0,s.jsx)(n.p,{children:"SourceStream is a stream containing the source code"}),"\n",(0,s.jsx)(n.p,{children:"ErrorsStream is a stream to which any error messages are written"}),"\n",(0,s.jsx)(n.p,{children:"The return value is 1 on success, 0 on failure"}),"\n",(0,s.jsx)(n.p,{children:"If 0 is returned the caller should see the DLLResultCode property for information about failure."}),"\n",(0,s.jsx)(n.p,{children:'CacheObjectScript.DLL must be in the directory given by the BinDir property. By default this points to the instance\'s "Bin" directory.'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"In the example below SourceIn and ErrorsOut are streams. SourceIn supplies the source code and ErrorsOut receives any error messages."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"Set TT=##class(%Library.COSCallout).%New() Set Ret=TT.Compile(SourceIn,ErrorsOut) If 'Ret Write \"Fatal error: \",TT.DLLResultCode,! ZTrap Do Errors.Rewind() If 'Errors.AtEnd { //... show Errors } Else { //... use tree }"})}),"\n",(0,s.jsx)(n.h3,{id:"configname",children:"ConfigName"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method ConfigName() As %String [ CodeMode = expression, Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Helper function to return the InterSystems IRIS configuration name."}),"\n",(0,s.jsx)(n.h3,{id:"configpath",children:"ConfigPath"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method ConfigPath() As %String [ CodeMode = expression, Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Helper function to return the InterSystems IRIS configuration path."}),"\n",(0,s.jsx)(n.h3,{id:"invokedll",children:"InvokeDLL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method InvokeDLL(DLLFunction As %Integer, DLLArgs) As %List [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Invoke the CacheObjectScript DLL function (DLLFunction), passing DLLArgs."}),"\n",(0,s.jsx)(n.p,{children:"Returns what the $ZF call into the DLL returns, or something in the same format :-"}),"\n",(0,s.jsx)(n.p,{children:"$LISTBUILD(ZFOK, $LISTBUILD(Lang1, Lang2, ...), ColoringErrors, DLLResultCode)"}),"\n",(0,s.jsx)(n.h3,{id:"zf5",children:"ZF5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method ZF5(handle As %Integer, DLLFunction As %Integer, DLLArgs, ByRef failed As %Boolean) As %String [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Sets failed to 1 if the $ZF(-5,..) call fails, otherwise sets it to 0 and returns the DLL return code"}),"\n",(0,s.jsx)(n.h3,{id:"zf6",children:"ZF6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method ZF6(DLLPath As %String, DLLFunction As %Integer, DLLArgs, ByRef failed As %Boolean) As %String [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Sets failed to 1 if the $ZF(-6,..) call fails, otherwise sets it to 0 and returns the DLL return code"}),"\n",(0,s.jsx)(n.h3,{id:"pathtodll",children:"PathToDLL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"ClassMethod PathToDLL() As %String\n"})}),"\n",(0,s.jsx)(n.p,{children:"Return the path to the DLL"}),"\n",(0,s.jsx)(n.h3,{id:"setdefaultbindir",children:"SetDefaultBinDir"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method SetDefaultBinDir() [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:'Set the default for the instance\'s "Bin" directory'})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(96540);const t={},l=s.createContext(t);function i(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);