"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[69485],{97193:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>i,default:()=>a,frontMatter:()=>o,toc:()=>c});var s=t(74848),r=t(28453);const o={pagination_prev:null,pagination_next:null},i="%Net.WebSocket.Client",c=[{value:"Properties",id:"properties",level:2},{value:"URL",id:"url",level:3},{value:"Credentials",id:"credentials",level:3},{value:"EventListener",id:"eventlistener",level:3},{value:"Request",id:"request",level:3},{value:"Nonce",id:"nonce",level:3},{value:"AcceptedProtocols",id:"acceptedprotocols",level:3},{value:"Protocol",id:"protocol",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnNew",id:"onnew",level:3},{value:"EstablishConnection",id:"establishconnection",level:3},{value:"ValidateProtocolSwitch",id:"validateprotocolswitch",level:3},{value:"Next",id:"next",level:3},{value:"Send",id:"send",level:3},{value:"Ping",id:"ping",level:3},{value:"Pong",id:"pong",level:3},{value:"%OnClose",id:"onclose",level:3}];function l(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"netwebsocketclient",children:"%Net.WebSocket.Client"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Class %Net.WebSocket.Client Extends %RegisteredObject [ Final ]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Implements a WebSocket client.",(0,s.jsx)(n.br,{}),"\nUsage:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implement %Net.WebSocket.IEventListener to respond to events (most importantly, receipt of a message)."}),"\n",(0,s.jsx)(n.li,{children:"Implement %Net.WebSocket.ICredentials to provide a username/password/SSLConfiguration for the connection as needed."}),"\n",(0,s.jsx)(n.li,{children:"Create a new instance of %Net.WebSocket.Client, providing a WebSocket URL and instances of the ICredentials and IEventListener implementations."}),"\n",(0,s.jsx)(n.li,{children:"Call Next() to wait for the next message, and Send to send a message."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(n.h3,{id:"url",children:"URL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property URL As %String [ ReadOnly ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"WebSocket endpoint"}),"\n",(0,s.jsx)(n.h3,{id:"credentials",children:"Credentials"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property Credentials As %Net.WebSocket.ICredentials [ Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"Provides username, password, and SSL configuration"}),"\n",(0,s.jsx)(n.h3,{id:"eventlistener",children:"EventListener"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property EventListener As %Net.WebSocket.IEventListener [ Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"Handles open, close, message, and error events"}),"\n",(0,s.jsx)(n.h3,{id:"request",children:"Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property Request As %Net.HttpRequest [ Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"The HTTP request, wrapping use of the device used for communcation"}),"\n",(0,s.jsx)(n.h3,{id:"nonce",children:"Nonce"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property Nonce As %String [ InitialExpression = {$System.Encryption.Base64Encode($System.Encryption.GenCryptRand(16))}, Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"Base64-encoded 16-byte random value provided to the server for validation"}),"\n",(0,s.jsx)(n.h3,{id:"acceptedprotocols",children:"AcceptedProtocols"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property AcceptedProtocols As %String [ Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"Accepted protocols (Sec-WebSocket-Protocol request header)"}),"\n",(0,s.jsx)(n.h3,{id:"protocol",children:"Protocol"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Property Protocol As %String [ Private ];\n"})}),"\n",(0,s.jsx)(n.p,{children:"The actual protocol in use (Sec-WebSocket-Protocol response header)"}),"\n",(0,s.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:'Method %OnNew(pURL As %String, pCredentials As %Net.WebSocket.ICredentials = {$$$NULLOREF}, pEventListener As %Net.WebSocket.IEventListener = {$$$NULLOREF}, pAcceptedProtocols As %String = "", pRequest As %Net.HttpRequest = {$$$NULLOREF}) As %Status\n'})}),"\n",(0,s.jsx)(n.h3,{id:"establishconnection",children:"EstablishConnection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method EstablishConnection() [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Makes the initial HTTP request and negotiates the upgrade to WebSocket protocol"}),"\n",(0,s.jsx)(n.h3,{id:"validateprotocolswitch",children:"ValidateProtocolSwitch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method ValidateProtocolSwitch() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Ensures response headers are valid for upgrading to web sockets"}),"\n",(0,s.jsx)(n.h3,{id:"next",children:"Next"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method Next(pTimeout As %Integer = 10, Output pTimedOut As %Boolean) As %Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Waits for data from the server. Returns 1 if the connection remains open, and 0 if the connection is closed or an error occurs.",(0,s.jsx)(n.br,{}),"\nThe event listener will be notified upon receiving a message, or if the connection is closed or an error occurs.",(0,s.jsx)(n.br,{}),"\n@Argument pTimeout Timeout (in seconds) to wait to receive a message from the server. @Argument pTimedOut True if the read operation timed out."]}),"\n",(0,s.jsx)(n.h3,{id:"send",children:"Send"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method Send(pContent, pFragmentSize As %Integer = 0) As %Status\n"})}),"\n",(0,s.jsx)(n.p,{children:"Sends a binary or character stream, dynamic object, or string to the server. @Argument pContent Binary or character stream, dynamic object, or string to the server. @Argument pFragmentSize Maximum size (in bytes) to send in a single frame; 0 indicates no maximum."}),"\n",(0,s.jsx)(n.h3,{id:"ping",children:"Ping"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method Ping(pMessage As %String, pTimeout As %Integer = 10) As %Status\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Sends a ping frame to the server.",(0,s.jsx)(n.br,{}),"\nReturns $$$NetWebSocketErrPingTimeout if the ping times out",(0,s.jsx)(n.br,{}),"\nReturns $$$NetWebSocketErrPongInvalid if the pong response is not equal to pMessage",(0,s.jsx)(n.br,{}),'\nOtherwise, returns $$$OK @Argument pMessage Message to send with the ping @Argument pFragmentSize Timeout (in seconds) to wait to receive a "pong" back from the server.']}),"\n",(0,s.jsx)(n.h3,{id:"pong",children:"Pong"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method Pong(pMessage As %String) As %Status\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Sends an ",(0,s.jsx)(n.strong,{children:"unsolicited"})," pong frame to the server.",(0,s.jsx)(n.br,{}),"\n@Argument pMessage Message to send with the pong"]}),"\n",(0,s.jsx)(n.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status [ Private, ServerOnly = 1 ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Closes the web socket connection from the client."})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var s=t(96540);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);