"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[83144],{93993:(e,s,t)=>{t.r(s),t.d(s,{contentTitle:()=>r,default:()=>i,frontMatter:()=>c,toc:()=>l});var n=t(74848),a=t(28453);const c={pagination_prev:null,pagination_next:null},r="%DocDB.REST",l=[{value:"Parameters",id:"parameters",level:2},{value:"DOMAIN",id:"domain",level:3},{value:"Methods",id:"methods",level:2},{value:"Http500",id:"http500",level:3},{value:"ReportHttpStatusCode",id:"reporthttpstatuscode",level:3},{value:"RenderResponseBody",id:"renderresponsebody",level:3},{value:"GetClientServerHash",id:"getclientserverhash",level:3},{value:"SetClientServerHash",id:"setclientserverhash",level:3},{value:"ServeXml",id:"servexml",level:3},{value:"Page",id:"page",level:3},{value:"getRequestBody",id:"getrequestbody",level:3},{value:"AccessibleNamespaces",id:"accessiblenamespaces",level:3},{value:"exceptionToHttpResponse",id:"exceptiontohttpresponse",level:3},{value:"exceptionToHttpStatus",id:"exceptiontohttpstatus",level:3},{value:"SQLCODEToHttpStatus",id:"sqlcodetohttpstatus",level:3}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"docdbrest",children:"%DocDB.REST"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"Class %DocDB.REST Extends %CSP.REST\n"})}),"\n",(0,n.jsx)(s.p,{children:"This class implements a custom response format and serves as the basis for all DocDB REST APIs"}),"\n",(0,n.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsx)(s.h3,{id:"domain",children:"DOMAIN"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:'Parameter DOMAIN = "%DOCDB";\n'})}),"\n",(0,n.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(s.h3,{id:"http500",children:"Http500"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod Http500(pE As %Exception.AbstractException) As %Status\n"})}),"\n",(0,n.jsx)(s.p,{children:"Use our special format Http500 handler"}),"\n",(0,n.jsx)(s.h3,{id:"reporthttpstatuscode",children:"ReportHttpStatusCode"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ReportHttpStatusCode(httpStatus, status As %Status = {$$$OK}) As %Status\n"})}),"\n",(0,n.jsx)(s.p,{children:"User our special format handler for other status codes"}),"\n",(0,n.jsx)(s.h3,{id:"renderresponsebody",children:"RenderResponseBody"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod RenderResponseBody(httpStatus As %String = "", error As %DynamicAbstractObject = "", content As %DynamicAbstractObject = "") As %Status\n'})}),"\n",(0,n.jsx)(s.p,{children:"Render the three-part Response Body which contains an status, console, and a result part"}),"\n",(0,n.jsx)(s.h3,{id:"getclientserverhash",children:"GetClientServerHash"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod GetClientServerHash() As %String [ CodeMode = expression, Internal ]\n"})}),"\n",(0,n.jsx)(s.p,{children:"Get the clients version of the server hash"}),"\n",(0,n.jsx)(s.h3,{id:"setclientserverhash",children:"SetClientServerHash"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod SetClientServerHash(pHash As %String)\n"})}),"\n",(0,n.jsx)(s.p,{children:"Set the clients version of the server hash"}),"\n",(0,n.jsx)(s.h3,{id:"servexml",children:"ServeXml"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod ServeXml(pDocName As %String, pStatus As %Status, pMsgArray As %DynamicArray, pStream As %Stream, pTimeStamp As %String = "") As %Status\n'})}),"\n",(0,n.jsx)(s.p,{children:"This private helper method server wraps the message and document and returns it to the caller"}),"\n",(0,n.jsx)(s.h3,{id:"page",children:"Page"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod Page(skipheader As %Boolean = 1) As %Status [ ProcedureBlock = 0 ]\n"})}),"\n",(0,n.jsx)(s.p,{children:"Sets the response's localization domain (something that %CSP.REST should do, in theory) and then invokes default super class behavior"}),"\n",(0,n.jsx)(s.h3,{id:"getrequestbody",children:"getRequestBody"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod getRequestBody() As %DynamicAbstractObject\n"})}),"\n",(0,n.jsx)(s.h3,{id:"accessiblenamespaces",children:"AccessibleNamespaces"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod AccessibleNamespaces()\n"})}),"\n",(0,n.jsx)(s.p,{children:"This method returneds a list of accessible namespaces"}),"\n",(0,n.jsx)(s.h3,{id:"exceptiontohttpresponse",children:"exceptionToHttpResponse"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod exceptionToHttpResponse(exception As %Exception.AbstractException) As %String\n"})}),"\n",(0,n.jsx)(s.p,{children:"set status = exception.AsStatus() do ..StatusToJSON(status,.statusObject) All exceptions can have an inner exception Status exceptions can also have NextException, forming a linked list structure This can be normalized by converting the exception to a dynamic object and then we process the dynamic object"}),"\n",(0,n.jsx)(s.h3,{id:"exceptiontohttpstatus",children:"exceptionToHttpStatus"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod exceptionToHttpStatus(exception As %Exception.AbstractException) As %Library.DynamicAbstractObject\n"})}),"\n",(0,n.jsx)(s.p,{children:"Map an exception graph to an http status code"}),"\n",(0,n.jsx)(s.h3,{id:"sqlcodetohttpstatus",children:"SQLCODEToHttpStatus"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod SQLCODEToHttpStatus(SQLCODE As %Integer) As %String\n"})})]})}function i(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},28453:(e,s,t)=>{t.d(s,{R:()=>r,x:()=>l});var n=t(96540);const a={},c=n.createContext(a);function r(e){const s=n.useContext(c);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(c.Provider,{value:s},e.children)}}}]);