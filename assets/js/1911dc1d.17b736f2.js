"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[8835],{74488:(e,r,s)=>{s.r(r),s.d(r,{contentTitle:()=>c,default:()=>l,frontMatter:()=>a,toc:()=>o});var n=s(74848),t=s(28453);const a={pagination_prev:null,pagination_next:null},c="OAuth2.Server.Token",o=[{value:"Parameters",id:"parameters",level:2},{value:"HTTP200OK",id:"http200ok",level:3},{value:"HTTP400BADREQUEST",id:"http400badrequest",level:3},{value:"HTTP401UNAUTHORIZED",id:"http401unauthorized",level:3},{value:"HTTP500INTERNALSERVERERROR",id:"http500internalservererror",level:3},{value:"Methods",id:"methods",level:2},{value:"Process",id:"process",level:3},{value:"ProcessAuthorizationCode",id:"processauthorizationcode",level:3},{value:"ProcessPassword",id:"processpassword",level:3},{value:"ProcessClientCredentials",id:"processclientcredentials",level:3},{value:"ProcessJWT",id:"processjwt",level:3},{value:"ProcessRefreshToken",id:"processrefreshtoken",level:3},{value:"ProcessGetCertificate",id:"processgetcertificate",level:3},{value:"ReturnToken",id:"returntoken",level:3},{value:"GenerateRefreshToken",id:"generaterefreshtoken",level:3},{value:"MakeRefreshToken",id:"makerefreshtoken",level:3},{value:"ReturnError",id:"returnerror",level:3},{value:"Authorize",id:"authorize",level:3},{value:"CheckJWTAuthorization",id:"checkjwtauthorization",level:3},{value:"GetJWTBody",id:"getjwtbody",level:3},{value:"CheckDuplicate",id:"checkduplicate",level:3},{value:"StatusError",id:"statuserror",level:3}];function i(e){const r={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"oauth2servertoken",children:"OAuth2.Server.Token"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Class OAuth2.Server.Token Extends %RegisteredObject [ System = 4 ]\n"})}),"\n",(0,n.jsxs)(r.p,{children:["The class OAuth2.Server.Token implements the token endpoint, as specified in RFC 6749, for the Authorization Code, Password Credentials and Client Credentials grant types, and for refreshing the access token.",(0,n.jsx)(r.br,{}),"\nThis class also serves as the endpoint for token management requests from the resource server and client.",(0,n.jsx)(r.br,{}),'\nAll requests to this endpoint are of Content-Type "application/x-www-form-urlencoded". The requests from a confidential client must be authenticated using basic authentication with the client id and client secret as specified in RFC 6749. This class is used internally by InterSystems IRIS. You should not make direct use of it within your applications. There is no guarantee made about either the behavior or future operation of this class.']}),"\n",(0,n.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsx)(r.h3,{id:"http200ok",children:"HTTP200OK"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'Parameter HTTP200OK As STRING = "200 OK";\n'})}),"\n",(0,n.jsx)(r.h3,{id:"http400badrequest",children:"HTTP400BADREQUEST"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'Parameter HTTP400BADREQUEST As STRING = "400 Bad Request";\n'})}),"\n",(0,n.jsx)(r.h3,{id:"http401unauthorized",children:"HTTP401UNAUTHORIZED"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'Parameter HTTP401UNAUTHORIZED As STRING = "401 Unauthorized";\n'})}),"\n",(0,n.jsx)(r.h3,{id:"http500internalservererror",children:"HTTP500INTERNALSERVERERROR"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'Parameter HTTP500INTERNALSERVERERROR As STRING = "500 Internal Server Error";\n'})}),"\n",(0,n.jsx)(r.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(r.h3,{id:"process",children:"Process"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod Process() As %Status [ Internal, ServerOnly = 1 ]\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Event handler for ",(0,n.jsx)(r.strong,{children:"PreHTTP"})," event: this is invoked before the HTTP headers for a CSP page have been sent. All changes to the %CSP.Response class, such as adding cookies, HTTP headers, setting the content type etc. must be made from within the OnPreHTTP() method. Return ",(0,n.jsx)(r.strong,{children:"0"})," to prevent OnPage from being called."]}),"\n",(0,n.jsx)(r.p,{children:"OnPreHttp is used to control flow and redirect back to the requester. OnPage is where the actual authentication takes place."}),"\n",(0,n.jsx)(r.h3,{id:"processauthorizationcode",children:"ProcessAuthorizationCode"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessAuthorizationCode() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Process authorization_code grant type token request"}),"\n",(0,n.jsx)(r.h3,{id:"processpassword",children:"ProcessPassword"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessPassword() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Process password credentials grant type token request"}),"\n",(0,n.jsx)(r.h3,{id:"processclientcredentials",children:"ProcessClientCredentials"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessClientCredentials() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Process client credentials grant type token request"}),"\n",(0,n.jsx)(r.h3,{id:"processjwt",children:"ProcessJWT"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessJWT() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:'Process client credentials grant type token request. The signing algorithm used to sign the JWT is specified by OAuth2.Client.Metadata."token_endpoint_auth_signing_alg"; the same signing algorithm as used for client authenticxation JWT.'}),"\n",(0,n.jsx)(r.h3,{id:"processrefreshtoken",children:"ProcessRefreshToken"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessRefreshToken() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Process a request for a new access token based on the refresh token"}),"\n",(0,n.jsx)(r.h3,{id:"processgetcertificate",children:"ProcessGetCertificate"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ProcessGetCertificate() As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.h3,{id:"returntoken",children:"ReturnToken"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ReturnToken(client As OAuth2.Server.Client, token As OAuth2.Server.AccessToken) As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Return the access token"}),"\n",(0,n.jsx)(r.h3,{id:"generaterefreshtoken",children:"GenerateRefreshToken"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod GenerateRefreshToken(client As OAuth2.Server.Client, token As OAuth2.Server.AccessToken) [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Generate an refresh token if needed"}),"\n",(0,n.jsx)(r.h3,{id:"makerefreshtoken",children:"MakeRefreshToken"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod MakeRefreshToken() [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Just make a random refresh token"}),"\n",(0,n.jsx)(r.h3,{id:"returnerror",children:"ReturnError"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod ReturnError(error As %OAuth2.Error) [ Internal, ServerOnly = 1 ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Return error response"}),"\n",(0,n.jsx)(r.h3,{id:"authorize",children:"Authorize"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod Authorize(secretRequired As %Boolean, Output client As OAuth2.Server.Client, requireTLS As %Boolean = 1) As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Check the client credentials for a request"}),"\n",(0,n.jsx)(r.h3,{id:"checkjwtauthorization",children:"CheckJWTAuthorization"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod CheckJWTAuthorization(jwt As %String, isAuthorizationGrant As %Boolean, Output client As OAuth2.Server.Client, Output sub As %String) As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"If private_key_jwt or client_secret_jwt authentication used, or JWT authorization grant type, then verify"}),"\n",(0,n.jsx)(r.h3,{id:"getjwtbody",children:"GetJWTBody"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod GetJWTBody(jwt As %String, Output alg As %String) As %DynamicObject [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Get algorithm and body from a signed JWT"}),"\n",(0,n.jsx)(r.h3,{id:"checkduplicate",children:"CheckDuplicate"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod CheckDuplicate(parameters As %String) As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Check for duplicate query parameters"}),"\n",(0,n.jsx)(r.h3,{id:"statuserror",children:"StatusError"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod StatusError(sc As %Status) As %OAuth2.Error [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Return an internal server error"})]})}function l(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(i,{...e})}):i(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>o});var n=s(96540);const t={},a=n.createContext(t);function c(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);