"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[79551],{35854:(e,s,n)=>{n.r(s),n.d(s,{contentTitle:()=>a,default:()=>o,frontMatter:()=>l,toc:()=>c});var t=n(74848),r=n(28453);const l={pagination_prev:null,pagination_next:null},a="%CSP.XMLSQL",c=[{value:"Parameters",id:"parameters",level:2},{value:"PRIVATE",id:"private",level:3},{value:"ENCODED",id:"encoded",level:3},{value:"Methods",id:"methods",level:2},{value:"OnPreHTTP",id:"onprehttp",level:3},{value:"OnPage",id:"onpage",level:3},{value:"OnPostHTTP",id:"onposthttp",level:3},{value:"PreProcessSQL",id:"preprocesssql",level:3},{value:"TkInit",id:"tkinit",level:3},{value:"TkToken",id:"tktoken",level:3},{value:"TkSkipWhite",id:"tkskipwhite",level:3},{value:"TkIsNextToken",id:"tkisnexttoken",level:3},{value:"ResolveElementName",id:"resolveelementname",level:3}];function i(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",row:"row",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"cspxmlsql",children:"%CSP.XMLSQL"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Class %CSP.XMLSQL Extends %CSP.Page [ Not ProcedureBlock, System = 3 ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"The %CSP.XMLSQL accepts an SQL statement in the incoming URL and executes it as a Dynamic SQL query. The results are returned in an XML format that corresponds to the MS XML-SQL Server format. See:"}),"\n",(0,t.jsxs)(s.p,{children:["< ",(0,t.jsx)(s.a,{href:"http://msdn.microsoft.com/msdnmag/issues/0300/sql/default.aspx%3E",children:"http://msdn.microsoft.com/msdnmag/issues/0300/sql/default.aspx>"})]}),"\n",(0,t.jsx)(s.p,{children:"There are 3 formats that can be specified using the FOR XML command:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"RAW"})," - Return ",(0,t.jsx)(s.row,{children:" elements with columns as attributes."})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"AUTO"})," - Return the data in an XML tree structure."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"EXPLICIT"})," - It is a pretty complex version of AUTO."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The DTD can also be requested using the ",(0,t.jsx)(s.code,{children:"FOR XML format, DTD"}),". For example:"]}),"\n  "," "," ]> \n",(0,t.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsx)(s.h3,{id:"private",children:"PRIVATE"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Parameter PRIVATE = 1;\n"})}),"\n",(0,t.jsx)(s.p,{children:"Override PRIVATE from %CSP.Page"}),"\n",(0,t.jsx)(s.h3,{id:"encoded",children:"ENCODED"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Parameter ENCODED = 2;\n"})}),"\n",(0,t.jsx)(s.p,{children:"Override ENCODED from %CSP.Page"}),"\n",(0,t.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,t.jsx)(s.h3,{id:"onprehttp",children:"OnPreHTTP"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod OnPreHTTP() As %Boolean\n"})}),"\n",(0,t.jsx)(s.p,{children:"The OnPreHTTP() is called by the CSP dispatcher before the HTTP headers have been sent. Here, we prepare the Dynamic SQL query and set the content type to text/xml."}),"\n",(0,t.jsx)(s.h3,{id:"onpage",children:"OnPage"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod OnPage() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"The OnPage() is called by the CSP dispatcher to generate the page content. For XMLSQL, we loop across the ResultSet and output the contents as XML."}),"\n",(0,t.jsx)(s.h3,{id:"onposthttp",children:"OnPostHTTP"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod OnPostHTTP()\n"})}),"\n",(0,t.jsx)(s.p,{children:"The OnPostHTTP() is called by the CSP dispatcher after the page content has been sent. We use it here to clean up the ResultSet"}),"\n",(0,t.jsx)(s.h3,{id:"preprocesssql",children:"PreProcessSQL"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod PreProcessSQL(sql As %String, ByRef args As %String, mode As %Integer, ByRef xmlmode As %String) As %String\n"})}),"\n",(0,t.jsx)(s.p,{children:"Process the XML SQL extras from the SQL statement. The mode is as follows:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"0"})," - Default XML-SQL mode"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"1"})," - Oracle XML-SQL mode"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"tkinit",children:"TkInit"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod TkInit(src As %String, ByRef ctx As %List) [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"tktoken",children:"TkToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod TkToken(ByRef ctx As %List, ByRef token As %String) As %Boolean [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"tkskipwhite",children:"TkSkipWhite"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod TkSkipWhite(ByRef ctx As %List) [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"tkisnexttoken",children:"TkIsNextToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod TkIsNextToken(ByRef ctx As %List, token As %String, skipwhite As %Boolean, nocase As %Boolean = 1) As %Boolean [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"resolveelementname",children:"ResolveElementName"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ResolveElementName(expr As %String, element, AssumeName) As %String\n"})})]})}function o(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(i,{...e})}):i(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>c});var t=n(96540);const r={},l=t.createContext(r);function a(e){const s=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(l.Provider,{value:s},e.children)}}}]);