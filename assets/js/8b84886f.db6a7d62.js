"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[72041],{35216:(e,s,n)=>{n.r(s),n.d(s,{contentTitle:()=>i,default:()=>c,frontMatter:()=>r,toc:()=>o});var t=n(74848),a=n(28453);const r={pagination_prev:null,pagination_next:null},i="SYS.Container",o=[{value:"Methods",id:"methods",level:2},{value:"QuiesceForBundling",id:"quiesceforbundling",level:3},{value:"ChangePassword",id:"changepassword",level:3},{value:"ReadPasswordFile",id:"readpasswordfile",level:3},{value:"ChangeGatewayMgrPassword",id:"changegatewaymgrpassword",level:3},{value:"ForcePasswordChange",id:"forcepasswordchange",level:3},{value:"PreventJournalRolloverMessage",id:"preventjournalrollovermessage",level:3},{value:"PreventFailoverMessage",id:"preventfailovermessage",level:3},{value:"EnableOSAuthentication",id:"enableosauthentication",level:3},{value:"ErrorHandler",id:"errorhandler",level:3},{value:"SetNeverExpires",id:"setneverexpires",level:3},{value:"KillPassword",id:"killpassword",level:3},{value:"SetMonitorStateOK",id:"setmonitorstateok",level:3},{value:"LockDownInstance",id:"lockdowninstance",level:3}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"syscontainer",children:"SYS.Container"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Class SYS.Container Extends %RegisteredObject\n"})}),"\n",(0,t.jsx)(s.p,{children:"The SYS.Container class contains methods to help users run IRIS inside an OCI-compliant container. The primary use case for these methods is to be called during the process of building an IRIS image, and these methods are called during InterSystems' own image build process."}),"\n",(0,t.jsx)(s.p,{children:'This class is designed to "fail loudly" to minimize the chance of uncaught errors in an image build process. By default, all public methods in SYS.Container will print any error to the console and terminate the entire calling process with an exit status of 1, which makes it easier to detect failures in automated build environments.'}),"\n",(0,t.jsx)(s.p,{children:"This behavior can be controlled by calling processes through environment variables, as specified in the documentation for ErrorHandler()."}),"\n",(0,t.jsx)(s.p,{children:"InterSystems builds official IRIS images using QuiesceForBundling()."}),"\n",(0,t.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,t.jsx)(s.h3,{id:"quiesceforbundling",children:"QuiesceForBundling"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod QuiesceForBundling() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"This method runs all of the ObjectScript code necessary to get InterSystems IRIS into a state where it can safely be serialized into a container image."}),"\n",(0,t.jsx)(s.p,{children:"Customers who build their own images are not required to implement this method exactly, but might find the source to be a useful starting point."}),"\n",(0,t.jsx)(s.h3,{id:"changepassword",children:"ChangePassword"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ChangePassword(pPasswordFile As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Change the password of all enabled accounts with changeable passwords, and a non-empty role or the special user CSPSystem. This method takes a cleartext file as input, and IRIS encrypts the contents appropriately."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pPasswordFile"})," Absolute path to file whose first line is our new cleartext password."]}),"\n",(0,t.jsx)(s.h3,{id:"readpasswordfile",children:"ReadPasswordFile"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ReadPasswordFile(pPasswordFile As %String, ByRef pPassword As %String) As %Status [ Private ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Reads the first line of text of a file into pPassword. Intended for reading password files, but could be used for other purposes. Fails if the file does not exist or the first line is empty."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pPasswordFile"})," Absolute path to file whose first line is our new cleartext password."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pPassword"})," Passed by reference, set to be the first line of pPasswordFile, minus newline."]}),"\n",(0,t.jsx)(s.h3,{id:"changegatewaymgrpassword",children:"ChangeGatewayMgrPassword"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'ClassMethod ChangeGatewayMgrPassword(pPasswordFile As %String, pCSPIniFile As %String = "") As %Status\n'})}),"\n",(0,t.jsx)(s.p,{children:"Changes the Gateway Manager password in CSP.ini."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pPasswordFile"})," Absolute path to file whose first line is our new cleartext password."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pCSPIniFile"})," Override for path to CSP.ini file. It is usually correct to leave this blank and use the default."]}),"\n",(0,t.jsx)(s.h3,{id:"forcepasswordchange",children:"ForcePasswordChange"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ForcePasswordChange() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"This method forces all IRIS users for this instance to change their password as part of their next login. The special user CSPSystem is excluded."}),"\n",(0,t.jsx)(s.h3,{id:"preventjournalrollovermessage",children:"PreventJournalRolloverMessage"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod PreventJournalRolloverMessage() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:'This method prevents messages from journal rollover in freshly-started containers. It is not guaranteed to work if the instance is not started with "nostu", as the normal shutdown process involves recording journaling metadata.'}),"\n",(0,t.jsxs)(s.p,{children:['For more about "nostu", see ',(0,t.jsx)(s.a,{href:"../docbook/DocBook.UI.Page.cls?KEY=GSA%5Fusing%5Finstance%5Fcontrol",children:"Controlling an InterSystems IRIS Instance"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"preventfailovermessage",children:"PreventFailoverMessage"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod PreventFailoverMessage() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:'IRIS stores the hostname it is running on in the database. If IRIS later starts and discovers the hostname has changed, it will emit a warning: "System appears to have failed over from node OLD_HOSTNAME". This method removes the stored hostname, preventing that message.'}),"\n",(0,t.jsx)(s.p,{children:'Container healthchecks are based on the System Monitor state. If this failover message is not suppressed, a new container may spend its first several minutes with the System Monitor in a "warn" state, which will cause container healthchecks to fail.'}),"\n",(0,t.jsx)(s.h3,{id:"enableosauthentication",children:"EnableOSAuthentication"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod EnableOSAuthentication() As %Status\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Enables Operating-System-Based Authentication for this instance. This streamlines automation tasks common in containers. For more, see ",(0,t.jsx)(s.a,{href:"../docbook/DocBook.UI.Page.cls?KEY=GCAS%5Fintro#GCAS%5Fintro%5Fauthe%5Fos",children:"OS Authentication"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"errorhandler",children:"ErrorHandler"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ErrorHandler(pSC As %Status) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:'Takes a %Status object as input. Returns that value or "fails loudly" by printing the error text and terminating the process, exit status 1.'}),"\n",(0,t.jsx)(s.p,{children:"These behaviors can be suppressed by setting either SYS_CONTAINER_QUIET or SYS_CONTAINER_CONTINUE_ON_ERROR to 1 in the OS environment."}),"\n",(0,t.jsx)(s.p,{children:"Setting both makes this function a no-op."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pSC"})," The %Status object to be interpreted."]}),"\n",(0,t.jsx)(s.h3,{id:"setneverexpires",children:"SetNeverExpires"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod SetNeverExpires(pUsername As %String) As %Status\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Sets the AccountNeverExpires bit for a username. Without this, user accounts will expire in images that are more than 90 days old. For more, see ",(0,t.jsx)(s.a,{href:"../docbook/DocBook.UI.Page.cls?KEY=GCAS%5Fsecmgmt#GCAS%5Fsecmgmt%5Fsyssttngs",children:"Security Management"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pUsername"})," The IRIS username to be operated on."]}),"\n",(0,t.jsx)(s.h3,{id:"killpassword",children:"KillPassword"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod KillPassword(pUsername As %String) As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Removes the IRIS password for a user. This destroys the ability to login via any authentication which requires a password. Non-password forms, such as OS-based authentication, will continue to work."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"pUsername"})," The IRIS username to be operated on."]}),"\n",(0,t.jsx)(s.h3,{id:"setmonitorstateok",children:"SetMonitorStateOK"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod SetMonitorStateOK() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Clears severity 1 and severity 2 alerts from the System Monitor. These messages are usually transient and inappropriate to have in an instance which is being quiesced into an image."}),"\n",(0,t.jsx)(s.p,{children:"If there have been any severity 3 alerts, this method will return an error, as severity 3 messages are fatal and indicate that this instance should not be made into an image at all."}),"\n",(0,t.jsxs)(s.p,{children:["For more information on the System Monitor and severity levels, see ",(0,t.jsx)(s.a,{href:"../docbook/DocBook.UI.Page.cls?KEY=GCM%5Fhealthmon#GCM%5Fhealthmon%5Fsysmon%5Falerts",children:"System Monitor Status and Resource Metrics"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"lockdowninstance",children:"LockDownInstance"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod LockDownInstance() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:'Performs additional securing of this instance. The instance must have been installed with GCI_prepare_install#GCI_security_initial"Locked Down" security settings. Some of these changes may be inconvenient for development or other interactive use cases, but they may be useful for running IRIS containers in production. The steps taken by this method are a suggestion. No one set of security settings will be perfect for all use cases and customers are strongly encouraged to examine their use case and make the best decisions available.'})]})}function c(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>o});var t=n(96540);const a={},r=t.createContext(a);function i(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);