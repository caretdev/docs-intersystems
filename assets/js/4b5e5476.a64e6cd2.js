"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[18351],{33458:(e,t,o)=>{o.r(t),o.d(t,{contentTitle:()=>l,default:()=>a,frontMatter:()=>r,toc:()=>c});var s=o(74848),n=o(28453);const r={pagination_prev:null,pagination_next:null},l="%SYSTEM.AutoLock",c=[{value:"Properties",id:"properties",level:2},{value:"Args",id:"args",level:3},{value:"Lock",id:"lock",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnNew",id:"onnew",level:3},{value:"%OnClose",id:"onclose",level:3},{value:"Lock",id:"lock-1",level:3}];function i(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"systemautolock",children:"%SYSTEM.AutoLock"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Class %SYSTEM.AutoLock Extends %SystemBase\n"})}),"\n",(0,s.jsx)(t.p,{children:"Add a new class which can hold lock references and automatically release them when the oref goes out of scope. This can greatly simplify the locking code and prevent errors if the user forgets to add an error trap to make sure the lock is released in the event of an error."}),"\n",(0,s.jsxs)(t.p,{children:["There are two ways to use this, the first uses a macro to get the lock and this lock is released when you leave the current stack frame: ",(0,s.jsx)(t.code,{children:'#include %systemInclude Function() public { $$$AutoLock(^Global,"S",10) ; Lock ^Global with shared lock and a timeout of 10 seconds If \'$test Write "Lock failed" Quit ; Do work here }'})," This will obtain a shared 'S' lock on ^Global with a timeout of 10 seconds and if it fails to get the lock it will write that it failed and exit, otherwise it will hold the lock until after the end of the function where the stack frame is removed. If the work throws an error then even though this routine has no error trapping the lock will still be removed correctly."]}),"\n",(0,s.jsxs)(t.p,{children:["The alternative form explicitly returns an oref from the lock call so you can manage this oref yourself, for example: ",(0,s.jsx)(t.code,{children:'#include %systemInclude Function() public { Set lock=$system.AutoLock.Lock("^Global","S",10) If lock=$$$NULLOREF Write "Lock failed",! Quit ; Do work }'})," This obtains the same lock but puts the oref into 'lock' local variable, sometimes this can be useful as it can be returned to the caller for it to manage rather than always having the lock removed when you go back from this stack frame as the other method of using this does."]}),"\n",(0,s.jsx)(t.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(t.h3,{id:"args",children:"Args"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property Args As %String [ Private ];\n"})}),"\n",(0,s.jsx)(t.h3,{id:"lock",children:"Lock"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Property Lock As %String [ Private ];\n"})}),"\n",(0,s.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(t.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:'Method %OnNew(lock As %String, args As %String = "") As %Status [ Private ]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status [ Private ]\n"})}),"\n",(0,s.jsx)(t.h3,{id:"lock-1",children:"Lock"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod Lock(lock As %String, args As %String = "", timeout As %Integer = 0) As %SYSTEM.AutoLock\n'})}),"\n",(0,s.jsx)(t.p,{children:'Passed a lock reference and optional args for the lock and optional timeout and it will try to obtain this lock. If it fails then it will return "", but if it worked then it will return an oref which will automatically release the lock when it goes out of scope.'})]})}function a(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>l,x:()=>c});var s=o(96540);const n={},r=s.createContext(n);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);