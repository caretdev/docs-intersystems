"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[91308],{97595:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>i,default:()=>l,frontMatter:()=>a,toc:()=>o});var r=s(74848),n=s(28453);const a={pagination_prev:null,pagination_next:null},i="%DeepSee.REST.REST",o=[{value:"Parameters",id:"parameters",level:2},{value:"CHARSET",id:"charset",level:3},{value:"CONTENTTYPE",id:"contenttype",level:3},{value:"HandleCorsRequest",id:"handlecorsrequest",level:3},{value:"DOMAIN",id:"domain",level:3},{value:"Methods",id:"methods",level:2},{value:"OnPreDispatch",id:"onpredispatch",level:3},{value:"%ValidateRequest",id:"validaterequest",level:3},{value:"%ErrorToJSON",id:"errortojson",level:3},{value:"%CreateObjectFromArray",id:"createobjectfromarray",level:3},{value:"%WaitForProviderResults",id:"waitforproviderresults",level:3},{value:"%ConstructResponseFromArray",id:"constructresponsefromarray",level:3},{value:"%ConstructResponseObject",id:"constructresponseobject",level:3},{value:"%ExtractDatasourceName",id:"extractdatasourcename",level:3},{value:"%SetRequestField",id:"setrequestfield",level:3},{value:"%ConvertErrorStatusToJSON",id:"converterrorstatustojson",level:3},{value:"%Array2JSON",id:"array2json",level:3}];function c(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"deepseerestrest",children:"%DeepSee.REST.REST"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"Class %DeepSee.REST.REST Extends %CSP.REST\n"})}),"\n",(0,r.jsx)(t.p,{children:"Utilities used in the DeepSee rest services"}),"\n",(0,r.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(t.h3,{id:"charset",children:"CHARSET"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter CHARSET = "utf-8";\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Specifies the default character set for the page. This can be overriden using the <CSP:CONTENT CHARSET=> tag, or by setting the ",(0,r.jsx)(t.strong,{children:"%response"}),".CharSet property in the OnPreHTTP method. If this parameter is not specified, then for the default charset is utf-8."]}),"\n",(0,r.jsx)(t.h3,{id:"contenttype",children:"CONTENTTYPE"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter CONTENTTYPE = "application/json";\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Specifies the default content type for the page. This can be overriden using the <CSP:CONTENT TYPE=> tag, or by setting the ",(0,r.jsx)(t.strong,{children:"%response"}),".ContentType property in the OnPreHTTP method. The default value if this parameter is not set is text/html."]}),"\n",(0,r.jsx)(t.h3,{id:"handlecorsrequest",children:"HandleCorsRequest"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"Parameter HandleCorsRequest = 1;\n"})}),"\n",(0,r.jsx)(t.p,{children:"This parameter influences the CORS support. The default is an empty string meaning 'not specified'. If set to true (1) then CORS processing is ON. If set to false (0) then CORS processing is OFF. If left unset \"\" then the decision to process CORS is delegated to the setting on the URL map route."}),"\n",(0,r.jsx)(t.h3,{id:"domain",children:"DOMAIN"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter DOMAIN = "%DeepSee";\n'})}),"\n",(0,r.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(t.h3,{id:"onpredispatch",children:"OnPreDispatch"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod OnPreDispatch(pUrl As %String, pMethod As %String, ByRef pContinue As %Boolean) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:"This method Gets called prior to dispatch of the request. Put any common code here that you want to be executed for EVERY request. If pContinue is set to 0, the request will NOT be dispatched according to the UrlMap. If this case it's the responsibility of the user to return a response."}),"\n",(0,r.jsx)(t.h3,{id:"validaterequest",children:"%ValidateRequest"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %ValidateRequest(pUrl As %String, pMethod As %String) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:"Perform specific validation for the service that will handle the request. This is used as a callback in each service that extends %DeepSee.REST"}),"\n",(0,r.jsx)(t.h3,{id:"errortojson",children:"%ErrorToJSON"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %ErrorToJSON(pStatus As %Status) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:"Convert a %Status object that contains an error into JSON for transmission back to the client. The error will be located in the same position within the object as with any JSON MDX resultset return. If there is a reported error, the existence of other properties within the return object is not guaranteed."}),"\n",(0,r.jsx)(t.h3,{id:"createobjectfromarray",children:"%CreateObjectFromArray"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %CreateObjectFromArray(ByRef pArray, pMetaData As %List, Output pObject) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:"This consumes an array and attempts to create a dynamic object out of it. This object can then be further augmented or pruned, and can be used as a facility for converting the content to JSON."}),"\n",(0,r.jsx)(t.h3,{id:"waitforproviderresults",children:"%WaitForProviderResults"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %WaitForProviderResults(pProvider As %ZEN.Auxiliary.jsonMDXProvider, pTimeout As %Integer) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:"Given an instance of the jsonMDXProvider, begin executing the query and wait for results. Quit early if the value supplied by pTimeout is reached."}),"\n",(0,r.jsx)(t.h3,{id:"constructresponsefromarray",children:"%ConstructResponseFromArray"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod %ConstructResponseFromArray(ByRef pArray, pMetaData As %List = "", pNodeLabel = "ListItems", pFetchStatus As %Status = 1, Output pResponseObj, Output pProvider) As %Status\n'})}),"\n",(0,r.jsxs)(t.p,{children:["This utility assists in constructing a standardized JSON response object from an array of lists, as commonly returned by %DeepSee utilities. The data in pArray must be organized in the form",(0,r.jsx)(t.br,{}),"\npArray(index) = $LB(data1,data2,data3)",(0,r.jsx)(t.br,{}),"\nwhere the contents in each list are converted to name-value pairs using the list of labels provided in pMetaData. The array of objects is placed in the Result section of the dynamic object returned via pResponseObj. The specifc node within the Result section is labeled according to the string supplied in pNodeLabel.",(0,r.jsx)(t.br,{}),"\nFor convenience, the method may return an instance of the %ZEN.Auxiliary.jsonMDXProvider used to augment the response object with more dynamic objects or arrays, as well as convert the object to JSON when the response object is complete."]}),"\n",(0,r.jsx)(t.h3,{id:"constructresponseobject",children:"%ConstructResponseObject"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %ConstructResponseObject(Output pInfoObj, Output pResultObj, Output pProvider) As %DynamicObject\n"})}),"\n",(0,r.jsx)(t.p,{children:"Create a template response object"}),"\n",(0,r.jsx)(t.h3,{id:"extractdatasourcename",children:"%ExtractDatasourceName"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod %ExtractDatasourceName(pUrl = "", pType = "", Output pRemainder As %String, Output pStatus As %Status) As %String\n'})}),"\n",(0,r.jsxs)(t.p,{children:['DeepSee REST APIs permit use of the "/" character in data source names and dimension specs. Given a piece of a pUrl that begins with a data source, this searches for the first valid data source name and returns it. This can be limited by type or a list of types in the comma-delimited list pType. Currently supported datasource types are "kpi" and "cube"',(0,r.jsx)(t.br,{}),"\nThe remainder of the URL, if it exists, is returned in the pRemainder."]}),"\n",(0,r.jsx)(t.h3,{id:"setrequestfield",children:"%SetRequestField"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %SetRequestField(pPropertyName As %String, pCurrentInput, pDefaultValue, Output ans, pTargetClass As %String) As %Status\n"})}),"\n",(0,r.jsx)(t.p,{children:'This method sets a request field to its current value as passed in the request.Content section of the POST request or, if that does not exist, sets it to its default value as specified in the method signature in CubeManager.Utils Example: SetRequestField is being invoked to set the value for the field %request.Content.myField pPropertyName is a string values containing the name of the field. For the above example,the pProperty is "myField" pCurrentInput is the current input value for the field in question. For the above example, the pCurrentInput is %request.Content.myField pDefaultValue is the default value for the field in question, as specified in the signature of the corresponding method that the API is designed to call. For the above example, the pDefaultValue could be "5" ans is the variable or object reference in which the populated value is stored pTargetClass is an optional argument that contains the name of the class, that ans should be an object of. This is only passed in when ans is expected to be an object and not a variable. An example of this is "%DeepSee.CubeManager.RegistryMapCube"'}),"\n",(0,r.jsx)(t.h3,{id:"converterrorstatustojson",children:"%ConvertErrorStatusToJSON"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod %ConvertErrorStatusToJSON(pStatus As %Status, ByRef statusAsJSONString As %String = "") As %Status\n'})}),"\n",(0,r.jsx)(t.p,{children:"Converts a %Status object that contains an error, to a JSON string, but does not cause it to be output to the console (unlike %DeepSee.REST.REST.ErrorToJSON, thus allowing for it to be used as a string wherever required If a non-error status is passed in, an empty string will be returned becuase the underlying method tProvider.%StatusToDynamicObject does not convert $$$OK statuses to dynamic objects May need to be refactored if %Zen is phased out"}),"\n",(0,r.jsx)(t.h3,{id:"array2json",children:"%Array2JSON"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %Array2JSON(ByRef array)\n"})}),"\n",(0,r.jsx)(t.p,{children:"Converts an objectscript array that may have an arbitrary structure, to a JSON object array is the array to be converted"})]})}function l(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>o});var r=s(96540);const n={},a=r.createContext(n);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);