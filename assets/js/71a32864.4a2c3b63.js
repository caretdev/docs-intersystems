"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[20855],{75410:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>c,default:()=>d,frontMatter:()=>l,toc:()=>a});var r=t(74848),s=t(28453);const l={pagination_prev:null,pagination_next:null},c="%Atelier.v7.TerminalAgent",a=[{value:"Parameters",id:"parameters",level:2},{value:"SECURITYRESOURCE",id:"securityresource",level:3},{value:"DEBUGTARGET",id:"debugtarget",level:3},{value:"ENABLEINTERRUPTEXPR",id:"enableinterruptexpr",level:3},{value:"TIMEOUT",id:"timeout",level:3},{value:"InitState",id:"initstate",level:3},{value:"PromptState",id:"promptstate",level:3},{value:"ReadState",id:"readstate",level:3},{value:"ExecuteState",id:"executestate",level:3},{value:"Properties",id:"properties",level:2},{value:"Trace",id:"trace",level:3},{value:"TraceNode",id:"tracenode",level:3},{value:"DeviceList",id:"devicelist",level:3},{value:"WebSocketDevice",id:"websocketdevice",level:3},{value:"State",id:"state",level:3},{value:"Debug",id:"debug",level:3},{value:"EnableInterruptBeforePrompt",id:"enableinterruptbeforeprompt",level:3},{value:"RawMode",id:"rawmode",level:3},{value:"ChildProcessDKey",id:"childprocessdkey",level:3},{value:"SyntaxColor",id:"syntaxcolor",level:3},{value:"ChildProcessPrincipalDevice",id:"childprocessprincipaldevice",level:3},{value:"Methods",id:"methods",level:2},{value:"InitTrace",id:"inittrace",level:3},{value:"TraceMsg",id:"tracemsg",level:3},{value:"TerminalPrompt",id:"terminalprompt",level:3},{value:"ReadFromWebSocket",id:"readfromwebsocket",level:3},{value:"ReadFromDebugDev",id:"readfromdebugdev",level:3},{value:"InterruptChildProcess",id:"interruptchildprocess",level:3},{value:"SendMessageToWebSocket",id:"sendmessagetowebsocket",level:3},{value:"SendPromptToWebSocket",id:"sendprompttowebsocket",level:3},{value:"SendOutputToWebSocket",id:"sendoutputtowebsocket",level:3},{value:"SendReadToWebSocket",id:"sendreadtowebsocket",level:3},{value:"SanitizePromptInput",id:"sanitizepromptinput",level:3},{value:"SyntaxCheckInput",id:"syntaxcheckinput",level:3},{value:"SyntaxColorInput",id:"syntaxcolorinput",level:3},{value:"OnPreServer",id:"onpreserver",level:3},{value:"OnPostServer",id:"onpostserver",level:3},{value:"Server",id:"server",level:3},{value:"ChildProcess",id:"childprocess",level:3},{value:"ExceptionHandler",id:"exceptionhandler",level:3}];function i(e){const n={code:"code",external:"external",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"atelierv7terminalagent",children:"%Atelier.v7.TerminalAgent"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Class %Atelier.v7.TerminalAgent Extends %CSP.WebSocket\n"})}),"\n",(0,r.jsx)(n.p,{children:"This class serves as an agent for terminal I/O."}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.h3,{id:"securityresource",children:"SECURITYRESOURCE"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:'Parameter SECURITYRESOURCE = "%Development";\n'})}),"\n",(0,r.jsx)(n.p,{children:"Require development resource"}),"\n",(0,r.jsx)(n.h3,{id:"debugtarget",children:"DEBUGTARGET"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:'Parameter DEBUGTARGET [ Internal ] = "ChildProcess";\n'})}),"\n",(0,r.jsx)(n.p,{children:'The method name of "debug target" that we launch for the child process'}),"\n",(0,r.jsx)(n.h3,{id:"enableinterruptexpr",children:"ENABLEINTERRUPTEXPR"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:'Parameter ENABLEINTERRUPTEXPR [ Internal ] = "$SYSTEM.Util.SetInterruptEnable(1)";\n'})}),"\n",(0,r.jsx)(n.p,{children:"Expression to enable external interrupts for the current process"}),"\n",(0,r.jsx)(n.h3,{id:"timeout",children:"TIMEOUT"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Parameter TIMEOUT [ Internal ] = 0.02;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"initstate",children:"InitState"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Parameter InitState [ Internal ] = 0;\n"})}),"\n",(0,r.jsx)(n.p,{children:"The terminal is waiting for the configuration message from the client"}),"\n",(0,r.jsx)(n.h3,{id:"promptstate",children:"PromptState"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Parameter PromptState [ Internal ] = 1;\n"})}),"\n",(0,r.jsx)(n.p,{children:"The terminal is waiting for command input from the user"}),"\n",(0,r.jsx)(n.h3,{id:"readstate",children:"ReadState"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Parameter ReadState [ Internal ] = 2;\n"})}),"\n",(0,r.jsx)(n.p,{children:"The terminal is waiting for READ input from the user"}),"\n",(0,r.jsx)(n.h3,{id:"executestate",children:"ExecuteState"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Parameter ExecuteState [ Internal ] = 3;\n"})}),"\n",(0,r.jsx)(n.p,{children:"The terminal is executing user's input"}),"\n",(0,r.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(n.h3,{id:"trace",children:"Trace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:'Property Trace As %Boolean [ InitialExpression = {$GET(^IRIS.Temp.Atelier("terminal")) > 0} ];\n'})}),"\n",(0,r.jsx)(n.p,{children:"This holds the TRACE flag"}),"\n",(0,r.jsx)(n.h3,{id:"tracenode",children:"TraceNode"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property TraceNode As %Integer [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"This holds the TRACE global node for this session"}),"\n",(0,r.jsx)(n.h3,{id:"devicelist",children:"DeviceList"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property DeviceList As %List [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"This holds the device list for $SYSTEM.Socket.Select"}),"\n",(0,r.jsx)(n.h3,{id:"websocketdevice",children:"WebSocketDevice"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property WebSocketDevice As %String [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"This holds the WebSocket device"}),"\n",(0,r.jsx)(n.h3,{id:"state",children:"State"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property State As %String [ InitialExpression = {..#InitState}, Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"The state the the terminal is in"}),"\n",(0,r.jsx)(n.h3,{id:"debug",children:"Debug"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property Debug As %Debugger.System [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"This holds the debugger instance. We use the debugger to control the child process."}),"\n",(0,r.jsx)(n.h3,{id:"enableinterruptbeforeprompt",children:"EnableInterruptBeforePrompt"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property EnableInterruptBeforePrompt As %Boolean [ InitialExpression = 0, Internal ];\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If true, enable ",(0,r.jsx)(n.external,{interrupt:"",children:" before sending the prompt message"})]}),"\n",(0,r.jsx)(n.h3,{id:"rawmode",children:"RawMode"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property RawMode As %Boolean [ InitialExpression = 0, Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"If true, ANSI escape codes will not be included in any text sent to the client"}),"\n",(0,r.jsx)(n.h3,{id:"childprocessdkey",children:"ChildProcessDKey"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property ChildProcessDKey As %String [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"The last value of $KEY set by a child process READ."}),"\n",(0,r.jsx)(n.h3,{id:"syntaxcolor",children:"SyntaxColor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property SyntaxColor As %SyntaxColor [ Internal ];\n"})}),"\n",(0,r.jsx)(n.p,{children:"The %SyntaxColor instance used to color prompt input"}),"\n",(0,r.jsx)(n.h3,{id:"childprocessprincipaldevice",children:"ChildProcessPrincipalDevice"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Property ChildProcessPrincipalDevice As %String [ Internal ];\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The value of ",(0,r.jsx)(n.code,{children:"$PRINCIPAL"})," for the child process."]}),"\n",(0,r.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(n.h3,{id:"inittrace",children:"InitTrace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method InitTrace() [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Intialize the trace (if requested)"}),"\n",(0,r.jsx)(n.h3,{id:"tracemsg",children:"TraceMsg"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method TraceMsg(pMsg As %String) [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Log a trace if tracing enabled"}),"\n",(0,r.jsx)(n.h3,{id:"terminalprompt",children:"TerminalPrompt"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"ClassMethod TerminalPrompt(pRawMode As %Boolean = 0) As %String [ Internal ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create the terminal prompt string. This method is called in the child process."}),"\n",(0,r.jsx)(n.h3,{id:"readfromwebsocket",children:"ReadFromWebSocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method ReadFromWebSocket(Output pUserMsg As %DynamicObject) As %Status [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Read data from the WebSocket device and convert it to a %DynamicObject"}),"\n",(0,r.jsx)(n.h3,{id:"readfromdebugdev",children:"ReadFromDebugDev"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method ReadFromDebugDev(Output pOutput As %String) As %Status [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Read output from the child process"}),"\n",(0,r.jsx)(n.h3,{id:"interruptchildprocess",children:"InterruptChildProcess"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method InterruptChildProcess() As %Status [ Internal, Private ]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Send an ",(0,r.jsx)(n.external,{interrupt:"",children:" to the child process"})]}),"\n",(0,r.jsx)(n.h3,{id:"sendmessagetowebsocket",children:"SendMessageToWebSocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SendMessageToWebSocket(pMsg As %DynamicObject) As %Status [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Send the JSON message to the WebSocket"}),"\n",(0,r.jsx)(n.h3,{id:"sendprompttowebsocket",children:"SendPromptToWebSocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SendPromptToWebSocket() As %Status [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Send the terminal prompt message to the WebSocket"}),"\n",(0,r.jsx)(n.h3,{id:"sendoutputtowebsocket",children:"SendOutputToWebSocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SendOutputToWebSocket(pOutput As %String) As %Status [ CodeMode = expression, Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Send the child process's output to the WebSocket"}),"\n",(0,r.jsx)(n.h3,{id:"sendreadtowebsocket",children:"SendReadToWebSocket"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SendReadToWebSocket() As %Status [ CodeMode = expression, Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Send the read message to the WebSocket. No text is needed since it should already have been sent."}),"\n",(0,r.jsx)(n.h3,{id:"sanitizepromptinput",children:"SanitizePromptInput"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SanitizePromptInput(pInput As %String) As %String [ CodeMode = expression, Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Sanitize user input in response to a prompt"}),"\n",(0,r.jsx)(n.h3,{id:"syntaxcheckinput",children:"SyntaxCheckInput"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SyntaxCheckInput(pInput As %String) As %String [ Internal, Private ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Check if user input is valid INT syntax. If not, return the error output that should be sent to the user."}),"\n",(0,r.jsx)(n.h3,{id:"syntaxcolorinput",children:"SyntaxColorInput"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method SyntaxColorInput(pInput As %String, Output pOutput As %String) As %Status\n"})}),"\n",(0,r.jsx)(n.p,{children:"Returns pInput with ANSI escape codes that color the text"}),"\n",(0,r.jsx)(n.h3,{id:"onpreserver",children:"OnPreServer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method OnPreServer() As %Status\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Event handler for the ",(0,r.jsx)(n.strong,{children:"PreServer"})," event: this is invoked before starting the WebSockets Server."]}),"\n",(0,r.jsx)(n.h3,{id:"onpostserver",children:"OnPostServer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method OnPostServer() As %Status\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Event handler for the ",(0,r.jsx)(n.strong,{children:"PostServer"})," event: this is invoked after closing the WebSockets Server."]}),"\n",(0,r.jsx)(n.h3,{id:"server",children:"Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"Method Server() As %Status\n"})}),"\n",(0,r.jsx)(n.p,{children:"The WebSocket Server. Use the Read and Write methods to receive data from, and send data to, the client. Call the EndServer method to gracefully terminate the WebSocket Server."}),"\n",(0,r.jsx)(n.h3,{id:"childprocess",children:"ChildProcess"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"ClassMethod ChildProcess() [ Internal ]\n"})}),"\n",(0,r.jsx)(n.p,{children:'Dummy method to use as the "debug target" in the child process.'}),"\n",(0,r.jsx)(n.h3,{id:"exceptionhandler",children:"ExceptionHandler"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-objectscript-class",children:"ClassMethod ExceptionHandler(pEx As %Exception.AbstractException, pRawMode As %Boolean = 0) As %String [ Internal ]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Helper method used for processing exceptions caused by user input"})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var r=t(96540);const s={},l=r.createContext(s);function c(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);