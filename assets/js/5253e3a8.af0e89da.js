"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[61493],{14156:(e,t,r)=>{r.r(t),r.d(t,{contentTitle:()=>o,default:()=>c,frontMatter:()=>a,toc:()=>i});var n=r(74848),s=r(28453);const a={pagination_prev:null,pagination_next:null},o="%SYNC.Transporter",i=[{value:"Overview",id:"overview",level:2},{value:"Create a Transport Container",id:"create-a-transport-container",level:2},{value:"Properties",id:"properties",level:2},{value:"transportGlobal",id:"transportglobal",level:3},{value:"transporter",id:"transporter",level:3},{value:"objectStack",id:"objectstack",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnNew",id:"onnew",level:3},{value:"DeleteTransportGlobal",id:"deletetransportglobal",level:3},{value:"GlobalName",id:"globalname",level:3},{value:"Import",id:"import",level:3},{value:"loadTransportContainer",id:"loadtransportcontainer",level:3},{value:"ExportFile",id:"exportfile",level:3},{value:"AddObject",id:"addobject",level:3},{value:"getTransporter",id:"gettransporter",level:3}];function l(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"synctransporter",children:"%SYNC.Transporter"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Class %SYNC.Transporter Extends %RegisteredObject [ System = 3 ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"%SYNC.Transporter is a utility class used to transport objects from one namespace to another."}),"\n  \n",(0,n.jsx)(t.h1,{id:"sync-transporter",children:"SYNC Transporter"}),"\n",(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsx)(t.p,{children:"%SYNC.Transporter is a utility class used to export and import objects from one namespace to another. Raw object data is copied to a transport container global. The transport container global is then exported to a file and moved to the desired location where it can be imported into another namespace. The import namespace must contain runnable classes corresponding to type of each object contained in the transport container. IDs and references can be abstracted during transport and resolved on import to the correct ID value as it exists in the import namespace."}),"\n",(0,n.jsx)(t.h2,{id:"create-a-transport-container",children:"Create a Transport Container"}),"\n",(0,n.jsxs)(t.p,{children:["To transport objects using the Transporter, simply instantiate the Transporter and add the desired objects. When all objects are in the transport container, export it to a file. The following method that transports instances of Sample.Person to a transport container is implemented as: ",(0,n.jsx)(t.code,{children:'classmethod TransportByState(pState as %String(MAXLEN=2) = "MA", pDirectory as %String = "") as %Status { try { set statement = ##class(%SQL.Statement).%New() set statement.%ObjectSelectMode = 1 do statement.prepare("select %ID as ID from Sample.Person where home_state = ?") set persons = statement.%Execute(pState) set transporter = ##class(%SYNC.Transporter).%New() while persons.%Next() { set tSC = transporter.AddObject(persons.ID.%Oid()) write !,$Select($$$ISOK(tSC):"Successfully added ",1:"Error occurred adding "),persons.ID.%Id()," ",persons.ID.Name," to the transporter" } do transporter.ExportFile(pDirectory _ "people"_pState_".gof") set tSC = $$$OK } catch tException { set tSC = tException.AsStatus() } quit tSC }'}),(0,n.jsx)(t.br,{}),"\nRunning this method produces the following output:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'\tSAMPLES>d ##class(Sample.Person).TransportByState("NY","/Users/test/Downloads/")  \t\tSuccessfully added 12 Nathanson,Debra I. to the transporter \t\tSuccessfully added 19 North,Molly K. to the transporter \t\tSuccessfully added 71 Grabscheid,Lawrence A. to the transporter \t\tSuccessfully added 108 Massias,Mary I. to the transporter \t\tSuccessfully added 179 Eastman,Lawrence M. to the transporter \t\tSuccessfully added 188 Ihringer,Dmitry G. to the transporter \t\tSuccessfully added 195 Isaacs,Dmitry A. to the transporter \t\tExporting to GO/GOF format started on 12/12/2011 08:31:33 \t\tExporting global: ^OBJ.EXP.37 \t\tExport finished successfully. \t\n'})}),"\n",(0,n.jsx)(t.p,{children:"The file, peopleNY, created by running the example above now contains the object data for each of the objects selected by the dynamic SQL statement. The file also contains abstracted keys for each of the objects referenced by the objects explicitly added to the transport container. It is the user's responsiblity to explicitly add referenced objects if more than the key is required. For example, if the Company object referenced by an Employee object needs to transported then it must be added explicitly by calling AddObject and passing it the OID of the Company object."}),"\n",(0,n.jsx)(t.p,{children:'The transport file can be moved to a place where it is visible to the namespace where it is to be imported. To import a transport file, simply instantiate the %SYNC.Transporter class and call the Import method. The following example simply imports the transport file back into the same namespace where it was produced. The rows transported are deleted first to demonstrate the Import behavior.  SAMPLES>d $system.SQL.Shell() SQL Command Line Shell ---------------------------------------------------- The command prefix is currently set to: <>. Enter q to quit, ? for help. SAMPLES>>delete from Sample.Person where home_state = ? 2. delete from Sample.Person where home_state = ? Enter the value for parameter \'1\': NY executing statement with parameter values: set %tResult=%tStatement.%Execute("NY") 7 Rows Affected statement prepare time: 0.0157s, elapsed execute time: 0.0337s. --------------------------------------------------------------------------- SAMPLES>>q SAMPLES>set status = transporter.Import("/Users/danp/Downloads/peopleNY.gof",.count,.errors) SAMPLES>write status 1 SAMPLES>write count 7 SAMPLES>zw errors errors=0 SAMPLES>d $system.SQL.Shell() SQL Command Line Shell ---------------------------------------------------- The command prefix is currently set to: <>. Enter q to quit, ? for help. SAMPLES>>select %id,name from sample.person where home_state = ? 1. select %id,name from sample.person where home_state = ? Enter the value for parameter \'1\': NY executing statement with parameter values: set %tResult=%tStatement.%Execute("NY") ID Name 12 Nathanson,Debra I. 19 North,Molly K. 71 Grabscheid,Lawrence A. 108 Massias,Mary I. 179 Eastman,Lawrence M. 188 Ihringer,Dmitry G. 195 Isaacs,Dmitry A. 7 Rows(s) Affected statement prepare time: 0.0847s, elapsed execute time: 0.0012s. --------------------------------------------------------------------------- SAMPLES>>'}),"\n",(0,n.jsx)(t.p,{children:"After creating a transport container it is a good idea to delete the global used by calling DeleteTransportGlobal."}),"\n",(0,n.jsx)(t.h2,{id:"properties",children:"Properties"}),"\n",(0,n.jsx)(t.h3,{id:"transportglobal",children:"transportGlobal"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property transportGlobal As %String(MAXLEN = 250);\n"})}),"\n",(0,n.jsx)(t.p,{children:"transportGlobal is the name of the global that will contain transported objects."}),"\n",(0,n.jsx)(t.h3,{id:"transporter",children:"transporter"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Property transporter As %String(MAXLEN = "") [ Internal, MultiDimensional ];\n'})}),"\n",(0,n.jsx)(t.h3,{id:"objectstack",children:"objectStack"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property objectStack As %Integer [ Internal ];\n"})}),"\n",(0,n.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(t.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method %OnNew(initvalue As %RawString = "") As %Status [ Private, ProcedureBlock = 1 ]\n'})}),"\n",(0,n.jsx)(t.p,{children:"This callback method is invoked by the %New method to provide notification that a new instance of an object is being created."}),"\n",(0,n.jsx)(t.p,{children:"If this method returns an error then the object will not be created. This method initializes a new transporter global unless the user passes the transporterId when instantiating this class. In that case, it is assumed that the user wishes to add to an existing transporter global and the global is not initialized if it exists."}),"\n",(0,n.jsx)(t.h3,{id:"deletetransportglobal",children:"DeleteTransportGlobal"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod DeleteTransportGlobal(pTransportId As %RawString = "") As %Status [ ProcedureBlock = 1 ]\n'})}),"\n",(0,n.jsx)(t.p,{children:'This method should be used to delete the transport global when it is no longer needed. The pTransportId is the integer appended to "^OBJ.EXP." to form the transport global name.'}),"\n",(0,n.jsx)(t.h3,{id:"globalname",children:"GlobalName"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method GlobalName() As %String [ CodeMode = expression, Internal ]\n"})}),"\n",(0,n.jsx)(t.h3,{id:"import",children:"Import"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method Import(pFile As %String = "", ByRef pCount = 0, ByRef errorlog As %String = 0) As %Status\n'})}),"\n",(0,n.jsx)(t.p,{children:"Import is the method to call to import a transport container from a file. Each object contained in the transport container is loaded into the current namespace. The number of objects found in the container and a log of all errors encountered during import is returned to the caller."}),"\n",(0,n.jsx)(t.h3,{id:"loadtransportcontainer",children:"loadTransportContainer"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method loadTransportContainer(pFile As %String = "") As %Status [ Internal ]\n'})}),"\n",(0,n.jsx)(t.p,{children:"loadTransportContainer is an internal method called by Import to import the transport container from pFile. This method returns a %Library.Status value indicating success or failure."}),"\n",(0,n.jsx)(t.h3,{id:"exportfile",children:"ExportFile"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method ExportFile(pFile As %String = "", qspec As %String = "") As %Status\n'})}),"\n",(0,n.jsx)(t.p,{children:"ExportFile will export the current transport container to the pFile file."}),"\n",(0,n.jsx)(t.h3,{id:"addobject",children:"AddObject"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method AddObject(pOID As %ObjectIdentity = "", pDepth As %Integer = 1) As %Status\n'})}),"\n",(0,n.jsx)(t.p,{children:"AddObject adds the object whose OID is pOID to the transport container if that object is not already present in the container. Objects can be present in the container as either a complete object or as a simple OID reference."}),"\n",(0,n.jsx)(t.p,{children:"If pDepth is 0 (zero) and the object is not already present in the container then the complete object is added."}),"\n",(0,n.jsx)(t.p,{children:"If pDepth is 1 (one) and the complete object is not already present in the container then the complete object and the key of each object referenced by that object are added."}),"\n",(0,n.jsx)(t.h3,{id:"gettransporter",children:"getTransporter"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method getTransporter(pClass, ByRef pSC As %Library.Status) As %String [ Internal ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Internal method to return the name of the routine that implements the transporter for pClass. If the transporter is not yet generated for pClass then the generator is called. If no transporter is found and the generator fails then NULL is returned."})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>i});var n=r(96540);const s={},a=n.createContext(s);function o(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);