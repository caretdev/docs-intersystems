"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[80733],{93052:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>n,default:()=>l,frontMatter:()=>r,toc:()=>o});var a=s(74848),i=s(28453);const r={pagination_prev:null,pagination_next:null},n="%OAuth2.Server.Validate",o=[{value:"Methods",id:"methods",level:2},{value:"ValidateDelegatedAuthentication",id:"validatedelegatedauthentication",level:3},{value:"ValidateUser",id:"validateuser",level:3},{value:"ValidateClient",id:"validateclient",level:3},{value:"SupportedClaims",id:"supportedclaims",level:3},{value:"Validate2FA",id:"validate2fa",level:3}];function d(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"oauth2servervalidate",children:"%OAuth2.Server.Validate"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"Class %OAuth2.Server.Validate Extends %RegisteredObject [ System = 4 ]\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The %OAuth2.Server.Validate class is the default ValidateUserClass which is included with the server. The default class will use the user database of the InterSystems IRIS instance where the authorization server is located to validate the user. The supported properties will be issuer (Issuer), roles and sub (Username).",(0,a.jsx)(t.br,{}),"\nThe ValidateUserClass is specified in the Authorization Server Configuration. It must contain a ValidateUser method which will validate a username/password combination and return a set of properties associated with this user."]}),"\n",(0,a.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,a.jsx)(t.h3,{id:"validatedelegatedauthentication",children:"ValidateDelegatedAuthentication"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod ValidateDelegatedAuthentication(properties As %OAuth2.Server.Properties, Output username As %String, Output sc As %Status) As %Boolean\n"})}),"\n",(0,a.jsx)(t.p,{children:"Your custom ValidateDelegatedAuthentication method must return true only if the delegated authentication event initiated by the DelegatedAuthentication method in the Authenticate class is valid. It must return false in other cases."}),"\n",(0,a.jsx)(t.p,{children:"The properties.CustomProperties array may be used to pass values between the DelegatedAuthentication method and this one."}),"\n",(0,a.jsx)(t.h3,{id:"validateuser",children:"ValidateUser"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod ValidateUser(username As %String, password As %String, scope As %ArrayOfDataTypes, properties As %OAuth2.Server.Properties, Output sc As %Status, Output use2fa As %Boolean = 0) As %Boolean\n"})}),"\n",(0,a.jsx)(t.p,{children:"Your custom ValidateUser method must return true (1) only if the username and password refer to a valid user based on whatever criteria you choose to implement. It must return false in other cases."}),"\n",(0,a.jsx)(t.p,{children:'If password="", then the user is already logged into an existing session and the password does not need to be validated.'}),"\n",(0,a.jsx)(t.p,{children:'In addition, this method receives the properties array and can further modify it; this correspond to the Properties property of %OAuth2.Server.Token. The authorization server will always add the "iss" (URL of authorization server), "sub" (client_id), and "exp" (expiration time in seconds since December 31st, 1840) to ClaimValues and "client_id" (client_id of the requesting client) to CusotmProperties after return from ValidateUser if they have not already been added.'}),"\n",(0,a.jsx)(t.p,{children:"This sample ValidateUser method validates the user based on the users for this instance. Set the use2fa output parameter to 1 (true) to indicate two factor authentication should be used. In this case the authenticate page will ask the user to enter a security code, which will be validated by Validate2FA."}),"\n",(0,a.jsx)(t.h3,{id:"validateclient",children:"ValidateClient"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod ValidateClient(clientId As %String, clientSecret As %String, scope As %ArrayOfDataTypes, Output properties As %OAuth2.Server.Properties, Output sc As %Status) As %Boolean\n"})}),"\n",(0,a.jsxs)(t.p,{children:['The ValidateClient method returns true (1), if the client_id and client_secret refer to a client computer which may use the client credentials grant type based on whatever criteria the method chooses to implement. This client will already have been verified to be registered to this authorization server and thus will usually be accepted. ValidateClient populates the properties array argument with any properties needed to generate the access token. This correspond to the Properties arguments of OAuth2.Server.Token. The authorization server will always add the "iss" (URL of authorization server), "sub" (client_id), and "exp" (expiration time in seconds since December 31st, 1840) to ClaimValues and "client_id" (client_id of the requesting client) to CusotmProperties after return from ValidateUser if they have not already been added.',(0,a.jsx)(t.br,{}),"\nIf not valid then false is returned.",(0,a.jsx)(t.br,{}),"\nThis default ValidateClient accepts all clients and adds no properties."]}),"\n",(0,a.jsx)(t.h3,{id:"supportedclaims",children:"SupportedClaims"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod SupportedClaims() As %List\n"})}),"\n",(0,a.jsx)(t.p,{children:"The SupportedClaims method returns a $list of claims that are supported by this authorization server based on customizations. The SupportedClaims method is in the ValidateUserClass since this is where additional claims are usually added. The returned list is added to the list of claims defined by OpenID Connect Core and should include JWT, IDToken, userinfo endpoint and introspection endpoint claims."}),"\n",(0,a.jsx)(t.h3,{id:"validate2fa",children:"Validate2FA"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod Validate2FA(username As %String, token As %String) As %Boolean\n"})}),"\n",(0,a.jsx)(t.p,{children:"If two factor authentication is enabled for this user, Validate2FA will be called to validate the security code entered by the user to complete their authentication."})]})}function l(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>o});var a=s(96540);const i={},r=a.createContext(i);function n(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);