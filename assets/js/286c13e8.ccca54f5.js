"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[70095],{82562:(e,s,n)=>{n.r(s),n.d(s,{contentTitle:()=>o,default:()=>l,frontMatter:()=>i,toc:()=>c});var t=n(74848),r=n(28453);const i={pagination_prev:null,pagination_next:null},o="OAuth2.AccessToken",c=[{value:"Parameters",id:"parameters",level:2},{value:"LogoutInterval",id:"logoutinterval",level:3},{value:"Properties",id:"properties",level:2},{value:"SessionId",id:"sessionid",level:3},{value:"ApplicationName",id:"applicationname",level:3},{value:"State",id:"state",level:3},{value:"Stage",id:"stage",level:3},{value:"AccessToken",id:"accesstoken",level:3},{value:"Hash",id:"hash",level:3},{value:"IDToken",id:"idtoken",level:3},{value:"IDHash",id:"idhash",level:3},{value:"TokenType",id:"tokentype",level:3},{value:"Expires",id:"expires",level:3},{value:"Scope",id:"scope",level:3},{value:"RefreshToken",id:"refreshtoken",level:3},{value:"RedirectURL",id:"redirecturl",level:3},{value:"GrantType",id:"granttype",level:3},{value:"Nonce",id:"nonce",level:3},{value:"ResponseType",id:"responsetype",level:3},{value:"ResponseMode",id:"responsemode",level:3},{value:"ResponseProperties",id:"responseproperties",level:3},{value:"Error",id:"error",level:3},{value:"TemporarySession",id:"temporarysession",level:3},{value:"CodeVerifier",id:"codeverifier",level:3},{value:"HasNonStandardImplicitIdToken",id:"hasnonstandardimplicitidtoken",level:3},{value:"LogoutRedirectURL",id:"logoutredirecturl",level:3},{value:"LogoutState",id:"logoutstate",level:3},{value:"InLogout",id:"inlogout",level:3},{value:"LoginRedirectURL",id:"loginredirecturl",level:3},{value:"Methods",id:"methods",level:2},{value:"AccessTokenSet",id:"accesstokenset",level:3},{value:"IDTokenSet",id:"idtokenset",level:3},{value:"SetError",id:"seterror",level:3},{value:"ClearError",id:"clearerror",level:3},{value:"IsError",id:"iserror",level:3},{value:"IsExpired",id:"isexpired",level:3},{value:"IsOpenID",id:"isopenid",level:3},{value:"OpenForSession",id:"openforsession",level:3},{value:"Open",id:"open",level:3},{value:"OpenByIDToken",id:"openbyidtoken",level:3},{value:"Remove",id:"remove",level:3},{value:"Cleanup",id:"cleanup",level:3},{value:"%OnBeforeSave",id:"onbeforesave",level:3},{value:"%OnDelete",id:"ondelete",level:3}];function a(e){const s={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"oauth2accesstoken",children:"OAuth2.AccessToken"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Class OAuth2.AccessToken Extends %Persistent [ System = 4 ]\n"})}),"\n",(0,t.jsxs)(s.p,{children:["OAuth2.AccessToken stores an OAuth 2.0 access token and its related information.",(0,t.jsx)(s.br,{}),"\nOAuth2.AccessToken is indexed by the combination of SessionId and ApplicationName. Therefore, only one scope may be requested for each SessionId/ApplicationName. If a second request is made with a different scope and access token has yet been granted, the scope in the new request becomes the expected scope."]}),"\n",(0,t.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsx)(s.h3,{id:"logoutinterval",children:"LogoutInterval"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Parameter LogoutInterval As INTEGER [ Internal ] = 15;\n"})}),"\n",(0,t.jsx)(s.p,{children:"LogoutInterval specifies the timeout interval (in seconds) used during RP-initiated front-channel logout. If the user agent has not returned to the post logout redirect url before this time the OAuth2.AccessToken record is considered abandoned, and may be automatically deleted."}),"\n",(0,t.jsx)(s.h2,{id:"properties",children:"Properties"}),"\n",(0,t.jsx)(s.h3,{id:"sessionid",children:"SessionId"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property SessionId As %String(COLLATION = "EXACT") [ Required ];\n'})}),"\n",(0,t.jsx)(s.p,{children:"An access token is linked to the combination of a session and client application The access token is indexed by hash of its value The IDToken is indexed by hash of its value The access token is indexed by the State during Authorization Server requests The access token is indexed by the State during Authorization Server requests This access token is linked to the session whose id is here."}),"\n",(0,t.jsx)(s.h3,{id:"applicationname",children:"ApplicationName"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property ApplicationName As %String(COLLATION = "EXACT", MAXLEN = 128, MINLEN = 1) [ Required ];\n'})}),"\n",(0,t.jsx)(s.p,{children:"This access token is linked to this client application."}),"\n",(0,t.jsx)(s.h3,{id:"state",children:"State"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property State As %String(COLLATION = "EXACT", MAXLEN = 1024);\n'})}),"\n",(0,t.jsx)(s.p,{children:"The base64 encoded random state associated with request to Authorization Server."}),"\n",(0,t.jsx)(s.h3,{id:"stage",children:"Stage"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property Stage As %String(VALUELIST = ",new,loggedin") [ Internal ];\n'})}),"\n",(0,t.jsxs)(s.p,{children:['Stage reflects the stage of the token usage process and is used for keeping track of usage attempts. Possible values of Stage: "new", "loggedin".',(0,t.jsx)(s.br,{}),'\n"new": Access token was just initiated. System is waiting for csp url.',(0,t.jsx)(s.br,{}),'\n"loggedin": system is logged in.']}),"\n",(0,t.jsx)(s.h3,{id:"accesstoken",children:"AccessToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property AccessToken As %String(COLLATION = "EXACT", MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:"The access token"}),"\n",(0,t.jsx)(s.h3,{id:"hash",children:"Hash"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property Hash As %String(COLLATION = "EXACT", MAXLEN = 64);\n'})}),"\n",(0,t.jsx)(s.p,{children:"SHA512 hash of the AccessToken to be used for indexing"}),"\n",(0,t.jsx)(s.h3,{id:"idtoken",children:"IDToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property IDToken As %String(COLLATION = "EXACT", MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:"The IDToken"}),"\n",(0,t.jsx)(s.h3,{id:"idhash",children:"IDHash"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property IDHash As %String(COLLATION = "EXACT", MAXLEN = 64);\n'})}),"\n",(0,t.jsx)(s.p,{children:"SHA512 hash of the IDToken to be used for indexing"}),"\n",(0,t.jsx)(s.h3,{id:"tokentype",children:"TokenType"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property TokenType As %String;\n"})}),"\n",(0,t.jsx)(s.p,{children:"The token type that is returned from the authorization server."}),"\n",(0,t.jsx)(s.h3,{id:"expires",children:"Expires"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property Expires As %Integer;\n"})}),"\n",(0,t.jsx)(s.p,{children:"The time when the token expires in seconds since December 31st, 1840 (i.e. since beginning of $h)"}),"\n",(0,t.jsx)(s.h3,{id:"scope",children:"Scope"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property Scope As %String(MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:"Blank separated list of scope names which this token supports"}),"\n",(0,t.jsx)(s.h3,{id:"refreshtoken",children:"RefreshToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property RefreshToken As %String(MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:'The refresh token that is returned by the authorization server or "".'}),"\n",(0,t.jsx)(s.h3,{id:"redirecturl",children:"RedirectURL"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property RedirectURL As %String(MAXLEN = 1024) [ Internal ];\n"})}),"\n",(0,t.jsx)(s.p,{children:"The URL of the CSP page which will be invoked after the access token is obtained. By default, this is the page that began the token request workflow."}),"\n",(0,t.jsx)(s.h3,{id:"granttype",children:"GrantType"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property GrantType As %String(VALUELIST = ",A,I,P,C,J");\n'})}),"\n",(0,t.jsx)(s.p,{children:'GrantType is the grant type that was used to create this access token: - "A" - Authorization Code - "I" - Implicit - "P" - Resource Owner Password Credentials - "C" - Client Credentials - "J" - JWT Authorization'}),"\n",(0,t.jsx)(s.h3,{id:"nonce",children:"Nonce"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property Nonce As %String(MAXLEN = 1024);\n"})}),"\n",(0,t.jsx)(s.p,{children:"Nonce for OpenID Connect request. This nonce must be included in the IDToken."}),"\n",(0,t.jsx)(s.h3,{id:"responsetype",children:"ResponseType"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property ResponseType As %String;\n"})}),"\n",(0,t.jsx)(s.p,{children:"The response_type of the access token request"}),"\n",(0,t.jsx)(s.h3,{id:"responsemode",children:"ResponseMode"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property ResponseMode As %String;\n"})}),"\n",(0,t.jsx)(s.p,{children:"The response_mode of the access token request: query or fragment"}),"\n",(0,t.jsx)(s.h3,{id:"responseproperties",children:"ResponseProperties"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property ResponseProperties As array Of %String(MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:"ResponseProperties contains the response properties from the access token request where the key is the property name and the value is the property value."}),"\n",(0,t.jsx)(s.h3,{id:"error",children:"Error"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property Error As %OAuth2.Error;\n"})}),"\n",(0,t.jsx)(s.p,{children:"Error object for error during authorization"}),"\n",(0,t.jsx)(s.h3,{id:"temporarysession",children:"TemporarySession"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property TemporarySession As %Boolean [ Deprecated, InitialExpression = 0 ];\n"})}),"\n",(0,t.jsx)(s.p,{children:"If TemporarySession is true, then this access token object was created for a temproary session by %OAuth2.Login. This object should not be deleted by the end session event handler."}),"\n",(0,t.jsx)(s.h3,{id:"codeverifier",children:"CodeVerifier"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property CodeVerifier As %String(MAXLEN = "");\n'})}),"\n",(0,t.jsx)(s.p,{children:"Code verifier sent with authorization requests when using the authorization_code grant type. This is in accordance with PKCE (RFC7636)."}),"\n",(0,t.jsx)(s.h3,{id:"hasnonstandardimplicitidtoken",children:"HasNonStandardImplicitIdToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property HasNonStandardImplicitIdToken As %Boolean [ InitialExpression = 0, Internal ];\n"})}),"\n",(0,t.jsx)(s.p,{children:'If HasNonStandardImplicitIdToken is true, then this access token object contains an id token that was not accompanied by the openid scope in the server response (and this object\'s scope has been modified to include "openid" as a reflection of this). This behavior is governed by the AcceptNonStandardImplicitIdToken property in OAuth2.Client and should not be set by the user'}),"\n",(0,t.jsx)(s.h3,{id:"logoutredirecturl",children:"LogoutRedirectURL"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property LogoutRedirectURL As %String(MAXLEN = 1024) [ Internal ];\n"})}),"\n",(0,t.jsx)(s.p,{children:"LogoutRedirectURL is stored during RP-initiated front-channel logout. This value indicates the URL to navigate to after a successful logout."}),"\n",(0,t.jsx)(s.h3,{id:"logoutstate",children:"LogoutState"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property LogoutState As %String(COLLATION = "EXACT", MAXLEN = 1024);\n'})}),"\n",(0,t.jsx)(s.p,{children:"The base64 encoded random state associated with a logout request to the Authorization Server."}),"\n",(0,t.jsx)(s.h3,{id:"inlogout",children:"InLogout"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Property InLogout As %Boolean [ InitialExpression = 0, Internal ];\n"})}),"\n",(0,t.jsx)(s.p,{children:"The InLogout flag is set to true during RP-iniated front-channel logout. If true, we should not delete this record until the logout sequence is completed. This is needed so we can keep the value in LogoutRedirectURL."}),"\n",(0,t.jsx)(s.h3,{id:"loginredirecturl",children:"LoginRedirectURL"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:'Property LoginRedirectURL As %String(MAXLEN = "") [ Internal ];\n'})}),"\n",(0,t.jsx)(s.p,{children:"LoginRedirectURL stores the redirectURL to the authorization server"}),"\n",(0,t.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,t.jsx)(s.h3,{id:"accesstokenset",children:"AccessTokenSet"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method AccessTokenSet(accessToken As %String) As %Status [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"idtokenset",children:"IDTokenSet"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method IDTokenSet(IDToken As %String) As %Status [ Internal ]\n"})}),"\n",(0,t.jsx)(s.h3,{id:"seterror",children:"SetError"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method SetError(error As %OAuth2.Error)\n"})}),"\n",(0,t.jsx)(s.p,{children:"Set the error."}),"\n",(0,t.jsx)(s.h3,{id:"clearerror",children:"ClearError"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method ClearError()\n"})}),"\n",(0,t.jsx)(s.p,{children:"Clear the error."}),"\n",(0,t.jsx)(s.h3,{id:"iserror",children:"IsError"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method IsError() As %Boolean\n"})}),"\n",(0,t.jsx)(s.p,{children:"Return if an error been set."}),"\n",(0,t.jsx)(s.h3,{id:"isexpired",children:"IsExpired"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method IsExpired() As %Boolean\n"})}),"\n",(0,t.jsx)(s.p,{children:"Check if this token is expired"}),"\n",(0,t.jsx)(s.h3,{id:"isopenid",children:"IsOpenID"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method IsOpenID() As %Boolean [ CodeMode = expression ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Is this an OpenID authorization request? Find out by looking for openid scope."}),"\n",(0,t.jsx)(s.h3,{id:"openforsession",children:"OpenForSession"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod OpenForSession(applicationName As %String, sessionId As %String, Output sc As %Status) As OAuth2.AccessToken\n"})}),"\n",(0,t.jsx)(s.p,{children:"Open an OAuth2.AccessToken instance based on the session and client application that it is linked to."}),"\n",(0,t.jsx)(s.h3,{id:"open",children:"Open"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod Open(accessToken As %String, Output sc As %Status) As OAuth2.AccessToken\n"})}),"\n",(0,t.jsx)(s.p,{children:"Open an OAuth2.AccessToken instance based on the AccessToken property"}),"\n",(0,t.jsx)(s.h3,{id:"openbyidtoken",children:"OpenByIDToken"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod OpenByIDToken(IDToken As %String, Output sc As %Status) As OAuth2.AccessToken\n"})}),"\n",(0,t.jsx)(s.p,{children:"Open an OAuth2.AccessToken instance based on the IDToken property"}),"\n",(0,t.jsx)(s.h3,{id:"remove",children:"Remove"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method Remove() As %Status\n"})}),"\n",(0,t.jsx)(s.p,{children:"Remove this token from the client. If this token is currently processing a RP-initiated front-channel logout request (That is, if InLogout is true,) then the token(s) will be removed, but the AccessToken record will not be deleted until the logout is completed or times out."}),"\n",(0,t.jsx)(s.h3,{id:"cleanup",children:"Cleanup"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod Cleanup() [ Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"Clean up all expired tokens"}),"\n",(0,t.jsx)(s.h3,{id:"onbeforesave",children:"%OnBeforeSave"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"Method %OnBeforeSave(insert As %Boolean) As %Status [ Internal, Private ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"This callback method is invoked by the %Save method to provide notification that the object is being saved. It is called before any data is written to disk."}),"\n",(0,t.jsx)(s.p,{children:"insert will be set to 1 if this object is being saved for the first time."}),"\n",(0,t.jsx)(s.p,{children:"If this method returns an error then the call to %Save will fail."}),"\n",(0,t.jsx)(s.h3,{id:"ondelete",children:"%OnDelete"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod %OnDelete(oid As %ObjectIdentity) As %Status [ Internal ]\n"})}),"\n",(0,t.jsx)(s.p,{children:"This callback method is invoked by the %Delete method to provide notification that the object specified by oid is being deleted."}),"\n",(0,t.jsx)(s.p,{children:"If this method returns an error then the object will not be deleted. [Previously private]"})]})}function l(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var t=n(96540);const r={},i=t.createContext(r);function o(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);