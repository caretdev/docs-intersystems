"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[5506],{6258:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>a,default:()=>h,frontMatter:()=>i,toc:()=>l});var n=s(74848),r=s(28453);const i={pagination_prev:null,pagination_next:null},a="%SYS.LDAP",l=[{value:"Methods",id:"methods",level:2},{value:"AddExts",id:"addexts",level:3},{value:"Binds",id:"binds",level:3},{value:"CheckFilter",id:"checkfilter",level:3},{value:"CompareExts",id:"compareexts",level:3},{value:"Connect",id:"connect",level:3},{value:"CountEntries",id:"countentries",level:3},{value:"CountValues",id:"countvalues",level:3},{value:"CountValuesLen",id:"countvalueslen",level:3},{value:"DeleteExts",id:"deleteexts",level:3},{value:"Err2String",id:"err2string",level:3},{value:"EscapeFilter",id:"escapefilter",level:3},{value:"FirstEntry",id:"firstentry",level:3},{value:"GetDN",id:"getdn",level:3},{value:"GetError",id:"geterror",level:3},{value:"GetLastError",id:"getlasterror",level:3},{value:"GetNextPages",id:"getnextpages",level:3},{value:"GetOption",id:"getoption",level:3},{value:"GetValues",id:"getvalues",level:3},{value:"GetValuesLen",id:"getvalueslen",level:3},{value:"Init",id:"init",level:3},{value:"Initialize",id:"initialize",level:3},{value:"FirstAttribute",id:"firstattribute",level:3},{value:"ModifyExts",id:"modifyexts",level:3},{value:"MsgFree",id:"msgfree",level:3},{value:"NextAttribute",id:"nextattribute",level:3},{value:"NextEntry",id:"nextentry",level:3},{value:"RenameExts",id:"renameexts",level:3},{value:"SASLBinds",id:"saslbinds",level:3},{value:"SearchExts",id:"searchexts",level:3},{value:"SearchInitPage",id:"searchinitpage",level:3},{value:"SearchAbandonPage",id:"searchabandonpage",level:3},{value:"SetOption",id:"setoption",level:3},{value:"SimpleBinds",id:"simplebinds",level:3},{value:"StartTLSs",id:"starttlss",level:3},{value:"StopTLSs",id:"stoptlss",level:3},{value:"UnBinds",id:"unbinds",level:3},{value:"Get",id:"get",level:3},{value:"ListExecute",id:"listexecute",level:3},{value:"ListFetch",id:"listfetch",level:3},{value:"ListClose",id:"listclose",level:3}];function o(e){const t={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"sysldap",children:"%SYS.LDAP"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Class %SYS.LDAP [ Abstract, System = 4 ]\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Requires %syLDAP.INC to be included in your COS routine for some macro definitions.",(0,n.jsx)(t.br,{}),"\nThe class methods described below are built on top of the interfaces OPENLDAP provides. For more information on OPENLDAP, see ",(0,n.jsx)(t.a,{href:"http://www.openldap.org",children:"www.openldap.org"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["This class only supports the OPENLDAP version 3 protocols.",(0,n.jsx)(t.br,{}),"\nIt is based on OPENLDAP's source version openldap-2.4.48.",(0,n.jsx)(t.br,{}),"\nThis class allows the user to interface with an LDAP database. The user can use the methods provided to authenticate themselves, Search, Add, Modify, Rename, and Delete entries in the LDAP database."]}),"\n",(0,n.jsxs)(t.p,{children:["Error Handling:",(0,n.jsx)(t.br,{}),"\nEvery time an LDAP method is called, a success status or error status is either returned or set into the LDAP session. If the method does not return the error as a result of the call, then the caller needs to retrieve the error with a call to either the GetError method, or the GetLastError method. The caller should test the return values for success or failure after every call."]}),"\n",(0,n.jsxs)(t.p,{children:["Example:",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).AddExts(LD,DN,Attributes)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS {",(0,n.jsx)(t.br,{}),'\nw !,"AddExts error: "_Status_" - "_##Class(%SYS.LDAP).Err2String(Status)',(0,n.jsx)(t.br,{}),"\ng LDAPError",(0,n.jsx)(t.br,{}),"\n}"]}),"\n",(0,n.jsxs)(t.p,{children:["See the LDAP.mac routine for extensive LDAP samples. This routine is available on GitHub at ",(0,n.jsx)(t.a,{href:"https://github.com/intersystems/Samples-Security",children:"https://github.com/intersystems/Samples-Security"})]}),"\n",(0,n.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(t.h3,{id:"addexts",children:"AddExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod AddExts(LD As %Integer, DN As %String, ATTR As %List, ServerControls As %String = "", ClientControls As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Add an entry to the LDAP directory tree."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - String that contains the distinguished name of the entry to add."}),"\n",(0,n.jsxs)(t.p,{children:["ATTR - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"})," formatted with attributes to add to the new entry.",(0,n.jsx)(t.br,{}),"\nEach element in the list is a separate attribute to be added to the new entry.",(0,n.jsx)(t.br,{}),"\nAttribute=$lb(op,type,vals)",(0,n.jsx)(t.br,{}),"\nop - For create, set to 0. However, if the vals parameter is to be treated as binary, then pass in 128 for this parameter.",(0,n.jsx)(t.br,{}),'\ntype - Name of the attribute. Example="Telephone".',(0,n.jsx)(t.br,{}),"\nvals - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"}),' of the values to assign to the attribute. If this is a single entry attribute, then $lb(Value), Example=$lb("617-621-0600"). If a multi-value entry, then $lb(Value1,Value2,...,Valuen). If the data is to be treated as binary (e.g. jpeg file), then make sure that 128 is passed for the op.']}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Attr1=$lb(0,"displayName",$lb(Jim Nilson))',(0,n.jsx)(t.br,{}),'\ns Attr2=$lb(0,"telephoneNumber",$lb("617-621-0600")',(0,n.jsx)(t.br,{}),'\ns Attr3=$lb(0,"objectClass",$lb("top","person","organizationalPerson","user")',(0,n.jsx)(t.br,{}),'\ns Attr4=$lb(128,"Picture",$lb(Jpegbitstring))',(0,n.jsx)(t.br,{}),"\ns Attributes=$lb(Attr1,Attr2,Attr3,Attr4)",(0,n.jsx)(t.br,{}),'\n; Note the special character identifier "\\" which is needed before the "," in the name',(0,n.jsx)(t.br,{}),'\ns DN="CN=Nilson\\, Jim,OU=Users,OU=England,DC=iscinternal,DC=com"',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).AddExts(LD,DN,Attributes)"]}),"\n",(0,n.jsx)(t.p,{children:"Note: See the ModifyExts method below for how to manipulate passwords on a Windows Active Directory LDAP server."}),"\n",(0,n.jsx)(t.h3,{id:"binds",children:"Binds"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod Binds(LD As %Integer, DN As %String = "", Cred As %List, Method As %Integer) As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Authenticate a Windows client to a Windows Active Directory LDAP Server."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:'DN - Distinguished name of the entry to bind. Currently always "".'}),"\n",(0,n.jsxs)(t.p,{children:["Cred - A ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"})," value that contains the credentials with which to authenticate. Currently only supported credentials are $lb(Username,Domain,Password)."]}),"\n",(0,n.jsxs)(t.p,{children:["Method - Indicates the authentication method to use. The following are supported:",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHSICILY",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHMSN",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHNTLM",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHDPA",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHNEGOTIATE",(0,n.jsx)(t.br,{}),"\n$$$LDAPAUTHDIGEST"]}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"This method is valid only for Windows clients talking to a Windows Active Directory LDAP server. Use SimpleBinds for OPENLDAP servers. If you have retrieved full DN of the Windows user using the LDAP search method, then you may use SimpleBinds on the Windows Active Directory LDAP server also."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:'s Status=##Class(%SYS.LDAP).Binds(LD,"",$lb(Username,Domain,Password),$$$LDAPAUTHNEGOTIATE)'}),"\n",(0,n.jsx)(t.p,{children:"See the documentation in SimpleBindS which shows how to handle errors and retry the operation."}),"\n",(0,n.jsx)(t.h3,{id:"checkfilter",children:"CheckFilter"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod CheckFilter(LD As %Integer, SearchFilter As %String) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Verify search filter syntax."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"SearchFilter - String that contains the name of the filter to check."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"This method is valid only for Windows clients."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:'s Status=##Class(%SYS.LDAP).CheckFilter(LD,"(objectclass=*)")'}),"\n",(0,n.jsx)(t.h3,{id:"compareexts",children:"CompareExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod CompareExts(LD As %Integer, DN As %String, Attr As %String, Data As %String, ServerControls As %String = "", ClientControls As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Determine if an attribute, for a given entry, holds a known value."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - String that contains the distinguished name of the entry to compare."}),"\n",(0,n.jsx)(t.p,{children:"Attr - String that contains the attribute to compare."}),"\n",(0,n.jsx)(t.p,{children:"Data - String or list value to be compared to the attribute value. If the data is a string, then simply pass in the string. If the data is binary, then pass in $lb(binaryvalue)."}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, and the attribute and known values match, $$$LDAPCOMPARETRUE is returned.",(0,n.jsx)(t.br,{}),"\nIf the values do not match, $$$LDAPCOMPAREFALSE is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).CompareExts(LD,"CN=Nilson,OU=Users,DC=iscinternal,DC=com","mail","',(0,n.jsx)(t.a,{href:"mailto:nilson@intersystems.com",children:"nilson@intersystems.com"}),")"]}),"\n",(0,n.jsx)(t.h3,{id:"connect",children:"Connect"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod Connect(LD As %Integer, Timeout As %Integer = 0) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Establish a connection to an LDAP server."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Timeout - The number of seconds to spend in an attempt to establish a connection before a timeout. If 0, the function uses a default timeout value."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["This method is valid only for Windows clients.",(0,n.jsx)(t.br,{}),"\nUse this function to force a connection to an LDAP server from a Windows client. This connection would normally be done as part of the LDAP methods (like SimpleBinds). However, when diagnosing problems, performing the connection by itself can help narrow down connection issues versus search issues."]}),"\n",(0,n.jsx)(t.h3,{id:"countentries",children:"CountEntries"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod CountEntries(LD As %Integer, SearchResult As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Count the number of search entries that an LDAP server returned."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"SearchResult - The search result as returned by SearchExts."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, it returns the number of entries.",(0,n.jsx)(t.br,{}),"\nIf the function fails, the return value is -1. The actual session error can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"The CountEntries function returns the number of entries contained, or remaining in a chain of entries. Call the function with the return value from SearchExts."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).SearchExts(LD,BaseDN,$$$LDAPSCOPESUBTREE,Filter,Attributes,0,"","",2,ServerTimeout,.SearchResult)',(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns NumEntries=##Class(%SYS.LDAP).CountEntries(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ni NumEntries=-1 s Status=##Class(%SYS.LDAP).GetError(LD) q Status"]}),"\n",(0,n.jsx)(t.h3,{id:"countvalues",children:"CountValues"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod CountValues(Values As %List) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Count the number of values returned by a GetValue call."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"Values - Values as returned by GetValues."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, it returns the number of entries in the list.",(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Values=##Class(%SYS.LDAP).GetValues(LD,CurrentEntry,Attr)",(0,n.jsx)(t.br,{}),"\ns Len=##Class(%SYS.LDAP).CountValues(Values)"]}),"\n",(0,n.jsx)(t.h3,{id:"countvalueslen",children:"CountValuesLen"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod CountValuesLen(Values As %List) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Count the number of values in a binary list returned by a GetValuesLen call."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"Values - Values as returned by GetValuesLen."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, it returns the number of entries in the list.",(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Values=##Class(%SYS.LDAP).GetValuesLen(LD,CurrentEntry,Attr)",(0,n.jsx)(t.br,{}),"\ns Len=##Class(%SYS.LDAP).CountValuesLen(Values)"]}),"\n",(0,n.jsx)(t.h3,{id:"deleteexts",children:"DeleteExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod DeleteExts(LD As %Integer, DN As %String, ServerControls As %String = "", ClientControls As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Remove a leaf entry from the directory tree."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - String that contains the distinguished name of the entry to delete."}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:'s Status=##Class(%SYS.LDAP).DeleteExts(LD,"CN=Nilson\\, Jim,OU=Users,OU=England,DC=iscinternal,DC=com")'}),"\n",(0,n.jsx)(t.h3,{id:"err2string",children:"Err2String"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod Err2String(Error) As %String\n"})}),"\n",(0,n.jsx)(t.p,{children:"Convert a numeric LDAP error code into a string that describes the error."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"Error - Error as returned by LDAP methods, or as returned by the method GetError."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the method succeeds, a string that describes the error is returned.",(0,n.jsx)(t.br,{}),'\nIf the function fails, "" is returned.',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["s NumEntries=##Class(%SYS.LDAP).CountEntries(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ni NumEntries=-1 s Msg=##Class(%SYS.LDAP).Err2String(##Class(%SYS.LDAP).GetError(LD))"]}),"\n",(0,n.jsx)(t.h3,{id:"escapefilter",children:"EscapeFilter"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod EscapeFilter(ByRef SearchFilter As %String) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Escape a search filter."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"SearchFilter (byref) - String that contains the filter to escape."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["SearchFilter - Returned filter with the characters escaped.",(0,n.jsx)(t.br,{}),"\nIf the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"Search filters need to be escaped according to LDAP rules. See:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://msdn.microsoft.com/en-us/library/aa746475(v=vs.85).aspx",children:"https://msdn.microsoft.com/en-us/library/aa746475(v=vs.85).aspx"})}),"\n",(0,n.jsx)(t.p,{children:"Here is the character substitution this method provides."}),"\n",(0,n.jsxs)(t.p,{children:["* - \\2a",(0,n.jsx)(t.br,{}),"\n( - \\28",(0,n.jsx)(t.br,{}),"\n) - \\29",(0,n.jsx)(t.br,{}),"\n\\ - \\5c",(0,n.jsx)(t.br,{}),"\n/ - \\2f",(0,n.jsx)(t.br,{}),"\nNUL - \\00"]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s SearchFilter="Markus\\, Paul,OU=People,OU=Havens,DC=thehavenshospital,DC=org',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).EscapeFilter(.SearchFilter)",(0,n.jsx)(t.br,{}),"\nw !,SearchFilter",(0,n.jsx)(t.br,{}),"\nMarkus\\5c, Paul,OU=People,OU=Havens,DC=thehavenshospital,DC=org"]}),"\n",(0,n.jsx)(t.h3,{id:"firstentry",children:"FirstEntry"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod FirstEntry(LD As %Integer, SearchResult As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return a pointer to the first entry of a message."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"SearchResult - The search result as returned by SearchExts."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the method succeeds, it returns the entry.",(0,n.jsx)(t.br,{}),"\nIf no entry exists in the result set, it returns 0, and a call to GetError returns $$$LDAPSUCCESS.",(0,n.jsx)(t.br,{}),"\nIf the function fails, it returns 0 and a call to GetError returns the session error."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"Use FirstEntry in conjunction with NextEntry to step through and retrieve the list of entries from a search result chain."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).SearchExts(LD,BaseDN,$$$LDAPSCOPESUBTREE,Filter,Attributes,0,"","",2,ServerTimeout,.SearchResult)',(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status"]}),"\n",(0,n.jsx)(t.h3,{id:"getdn",children:"GetDN"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetDN(LD As %Integer, Entry As %Integer) As %String\n"})}),"\n",(0,n.jsx)(t.p,{children:"Retrieve the distinguished name for a given entry."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - Entry whose distinguished name is to be retrieved, as returned by the FirstEntry or NextEntry methods."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, it returns the distinguished name.",(0,n.jsx)(t.br,{}),'\nIf the function fails, it returns "".',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["s Entry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns DN=##Class(%SYS.LDAP).GetDN(LD,Entry)",(0,n.jsx)(t.br,{}),'\ni DN="" s Status=##Class(%SYS.LDAP).GetError(LD)']}),"\n",(0,n.jsx)(t.h3,{id:"geterror",children:"GetError"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetError(LD) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Retrieve the last error code returned by an LDAP call for a specific session."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsx)(t.p,{children:"An LDAP error code."}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["Use the GetError method to return the last LDAP error message for a specific session. The value from the GetError method may in turn be passed to the Err2String method to get error text for the error.",(0,n.jsx)(t.br,{}),'\nError numbers >= $zh("5000") are ISC internal LDAP errors.']}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["s Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ns Msg=##Class(%SYS.LDAP).Err2String(Status)"]}),"\n",(0,n.jsx)(t.h3,{id:"getlasterror",children:"GetLastError"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetLastError() As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Retrieve the last error code returned by an LDAP call."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsx)(t.p,{children:"An LDAP error code."}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["Use the GetLastError method to return the last LDAP error message. The value from the GetLastError method may in turn be passed to the Err2String method to get error text for the error.",(0,n.jsx)(t.br,{}),"\nReturned errors are only in the LDAP error range and do not include ISC internal errors."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["s Status=##Class(%SYS.LDAP).GetLastError()",(0,n.jsx)(t.br,{}),"\ns Msg=##Class(%SYS.LDAP).Err2String(Status)"]}),"\n",(0,n.jsx)(t.h3,{id:"getnextpages",children:"GetNextPages"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetNextPages(LD As %Integer, Page As %Integer, Timeout As %Integer, PageSize As %Integer, ByRef TotalPages As %Integer, ByRef SearchResult As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Search the LDAP directory using a pages search and return a requested set of attributes for each entry."}),"\n",(0,n.jsxs)(t.p,{children:["This is a Windows only method.",(0,n.jsx)(t.br,{}),"\nParameters:"]}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Page - Pointer to page of results as returned by SearchInitPage() method. Timeout - Specifies both the local search time-out value in seconds and the operation time limit that is sent to the server within the search request."}),"\n",(0,n.jsx)(t.p,{children:"PageSize - Number of records to be returned in each page for each call to GetNextPages()."}),"\n",(0,n.jsx)(t.p,{children:"TotalPages (byRef) - Estimated number of pages which will be returned by the search. Depending on the type of the LDAP server, this number may always be 0 (unknown)."}),"\n",(0,n.jsx)(t.p,{children:"SearchResult (byRef) - Contains the results of the search upon completion of the call."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf there are more results to retrieve, then If the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"When done with the search results you need to free the search results the following way:"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"1) First call the MsgFree(SearchResult) method."}),"\n",(0,n.jsx)(t.strong,{children:"2) Then call the the SearchAbandonPage(LD,Page)() method."}),"\n",(0,n.jsx)(t.strong,{children:"Failure to do this before a call to UnBinds may cause your process to core on a future LDAP call."})]}),"\n",(0,n.jsx)(t.p,{children:'Note that the caller can have several different searches "open" at the same time by using a different variable for the SearchResult parameter.'}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:"Search for all users in the LDAP database. Return their display name, e-mail and telephone number. Use a timeout of 10 seconds, and return at most 100 items for each call to the GetNextPages() method."}),"\n",(0,n.jsxs)(t.p,{children:['s Page=##Class(%SYS.LDAP).SearchExts(LD,"DC=mydomain,DC=com",',(0,n.jsx)(t.br,{}),'\n$$$LDAPSCOPESUBTREE,"sAMAccountname=*",',(0,n.jsx)(t.br,{}),'\n$lb("displayName","mail","telephoneNumber"),0,"","",10,100,"")',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetNextPages(LD,Page,10,100,.TotalPages,.SearchResult)",(0,n.jsx)(t.br,{}),"\nWhile (Status=$$$LDAPSUCCESS) {",(0,n.jsx)(t.br,{}),"\n; Process page of results here"]}),"\n",(0,n.jsxs)(t.p,{children:["; Now get the next page of results",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetNextPages(LD,Page,10,100,.TotalPages,.SearchResult)",(0,n.jsx)(t.br,{}),"\n}",(0,n.jsx)(t.br,{}),'\ni Status=$$$LDAPNORESULTSRETURNED {w !,"End of search"} else { w !,"Error "_Status}',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).MsgFree(SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).SearchAbandonPage(LD, Page)"]}),"\n",(0,n.jsx)(t.h3,{id:"getoption",children:"GetOption"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetOption(LD As %Integer, Option As %Integer, ByRef OutValue As %String) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Get options for an LDAP session."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Option - The name of the option to get. See valid options below."}),"\n",(0,n.jsx)(t.p,{children:"OutValue - Value of that option."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, the return value is $$$LDAPSUCCESS.",(0,n.jsx)(t.br,{}),"\nIf the function fails, it returns an error code."]}),"\n",(0,n.jsx)(t.p,{children:"Valid Options:"}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTERRORNUMBER - Returns the last LDAP error."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTNETWORKTIMEOUT - Returns the network timeout value after which poll/select following a connect returns in case of no activity. Specifying seconds set to 0 results in an infinite timeout, which is the default. Normally there is no need to change the default. This is available on Unix platforms only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTTIMEOUT - Returns the timeout value for the synchronous API calls. Specifying seconds set to 0 results in an infinite timeout, which is the default. Normally there is no need to change the default. This is available on Unix platforms only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTSSL - Returns 0/1 whether SSL is enabled on the connection. The connection must have already been established before this will acurately return 0/1. This means calling StartTLS(), or SearchExts(), or additionally on Windows Connect()."}),"\n",(0,n.jsxs)(t.p,{children:["$$$LDAPOPTERRORSTRING - When called after a Bind operation, may give additional information about the cause of the bind failure. Additional information is not available on Windows clients or if using an OPENLDAP server.",(0,n.jsx)(t.br,{}),"\nExamples:"]}),"\n",(0,n.jsxs)(t.p,{children:["Get last LDAP error on the session.",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetOption(LD,$$$LDAPOPTERRORNUMBER,.ErrorNum)"]}),"\n",(0,n.jsx)(t.p,{children:"Note: Previous versions allowed the option $$$LDAPOPTPROTOCOLVERSION and $$$LDAPOPTREFERRALS to be specified. These options are deprecated. SetOption calls using this option will be ignored and always will return success. Version is now always set to 3, and referrals are always turned off."}),"\n",(0,n.jsx)(t.h3,{id:"getvalues",children:"GetValues"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetValues(LD As %Integer, Entry As %Integer, ByRef Attr As %String) As %List\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return string values for a given attribute. Use GetValuesLen for binary data."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - Pointer to the search entry as returned by the FirstEntry or NextEntry methods."}),"\n",(0,n.jsx)(t.p,{children:"Attr - String that contains the attribute whose values are to be retrieved. The passed string can be as returned by FirstAttribute or NextAttribute, or a caller supplied string."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, a ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"})," element is returned containing the values of the attribute.",(0,n.jsx)(t.br,{}),'\nIf the function fails, it returns "".',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).SearchExts(LD,BaseDN,$$$LDAPSCOPESUBTREE,Filter,Attributes,0,"","",2,ServerTimeout,.SearchResult)',(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),'\ns ValueList=##Class(%SYS.LDAP).GetValues(LD,Entry,"sAMAccountname") i ValueList="" q ##Class(%SYS.LDAP).GetError(LD)',(0,n.jsx)(t.br,{}),'\nw !,"sAMAccountname="_$li(ValueList,1)']}),"\n",(0,n.jsx)(t.h3,{id:"getvalueslen",children:"GetValuesLen"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetValuesLen(LD As %Integer, Entry As %Integer, ByRef Attr As %String) As %List\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return binary values for a given attribute. Use GetValues to return string values."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - Pointer to the search entry as returned by the FirstEntry or NextEntry methods."}),"\n",(0,n.jsx)(t.p,{children:"Attr - String that contains the attribute whose values are to be retrieved. The passed string can be as returned by FirstAttribute or NextAttribute, or a caller supplied string."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, a ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"})," element is returned containing the values of the attribute.",(0,n.jsx)(t.br,{}),'\nIf the function fails, it returns "".',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).SearchExts(LD,BaseDN,$$$LDAPSCOPESUBTREE,Filter,Attributes,0,"","",2,ServerTimeout,.SearchResult)',(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),'\ns ValueList=##Class(%SYS.LDAP).GetValuesLen(LD,Entry,"jpegbinarypicture")',(0,n.jsx)(t.br,{}),'\ni ValueList="" q ##Class(%SYS.LDAP).GetError(LD)',(0,n.jsx)(t.br,{}),"\nd Displayjpeg($li(ValueList,1))"]}),"\n",(0,n.jsx)(t.h3,{id:"init",children:"Init"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod Init(HostName As %String = "", PortNumber As %Integer = {$$$LDAPPORT}) As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Initialize a connection to a LDAP server."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"HostName - Space-separated list of host names running an LDAP server to which to connect. Each host name in the list can include an optional port number which is separated from the host itself with a colon (:). The host name must be a fully qualified domain name. A fully qualified domain name (FQDN), sometimes referred to as an absolute domain name, is a domain name that specifies its exact location in the tree hierarchy of the Domain Name System (DNS). It specifies all domain levels, including the top-level domain and the root domain. A fully qualified domain name is distinguished by its unambiguity; it can only be interpreted one way. For example, given a device with a local hostname myhost and a parent domain name example.com, the fully qualified domain name is myhost.example.com. The FQDN therefore uniquely identifies the device; while there may be many hosts in the world called myhost, there can only be one myhost.example.com. When using a Windows Active Directory server as an LDAP server, and a Windows client, a null string will find the default LDAP server for the domain."}),"\n",(0,n.jsx)(t.p,{children:"PortNumber - Contains the TCP port number to which to connect. This defaults to 389 if not specified. This parameter is ignored if a host name includes a port number."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, it returns a handle to the LDAP session. The session handle must be freed with a call to UnBinds when it is no longer required.",(0,n.jsx)(t.br,{}),"\nIf the function fails, it returns 0. Use GetLastError to retrieve the error code."]}),"\n",(0,n.jsx)(t.p,{children:"Note that Init does not make an actual connection to the LDAP server, it simply initializes the connection information. The actual connection will happen during the first request for data from the LDAP server."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Creates a session to your default LDAP server on port 389.",(0,n.jsx)(t.br,{}),"\ns LD = ##Class(%SYS.LDAP).Init()"]}),"\n",(0,n.jsxs)(t.p,{children:['Creates a session to the LDAP server called "ldapserver" on default port 389.',(0,n.jsx)(t.br,{}),'\ns LD = ##Class(%SYS.LDAP).Init("ldapserver.example.com")']}),"\n",(0,n.jsxs)(t.p,{children:['Creates a session to the LDAP server called "ldapserver" on port 389.',(0,n.jsx)(t.br,{}),'\ns LD = ##Class(%SYS.LDAP).Init("ldapserver.example.com",389)']}),"\n",(0,n.jsxs)(t.p,{children:['Creates a session to either the LDAP server called "ldapserver" or if it is unavailable, to LDAP server "backupldapserver" on port 389.',(0,n.jsx)(t.br,{}),'\ns LD = ##Class(%SYS.LDAP).Init("ldapserver.example.com backupldapserver.example.com")']}),"\n",(0,n.jsxs)(t.p,{children:["Secure Connections:",(0,n.jsx)(t.br,{}),"\nFor a Windows client, make sure you have the CA certificates already loaded in the Certificates(local computer)\\Trusted Root Certification Authorities certificate store. NOTE: If the certificates are stored in the Certificates(current user)\\Trusted Root Certification Authorities certificate store, then the SSL connection may fail with Error code 81 if the process is running in the background. For a Unix client, make sure the protections on the certificate file allow your process to be able to read it, and that any additional certificate or LDAP options are specified in the ldap.conf file.",(0,n.jsx)(t.br,{}),'\nIt is recommended that on the Active Directory Server that the parameter "LDAP server signing requirements" be set to "Require signature". This prevents any LDAP bind command on the server on port 389 to be executed unless the channel is encrypted with StartTLS. See']}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/domain-controller-ldap-server-signing-requirements",children:"https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/domain-controller-ldap-server-signing-requirements"})}),"\n",(0,n.jsx)(t.p,{children:"To create a secure SSL connection to an LDAP server, here are the calls you need to make for each platform type."}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Windows Client to Windows Active Directory LDAP server.",(0,n.jsx)(t.br,{}),"\nUsing the StartTLSs call",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com",389)',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"or"}),"\n",(0,n.jsxs)(t.p,{children:["Using a direct connection to the LDAP SSL port.",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com",636)']}),"\n",(0,n.jsxs)(t.ol,{start:"2",children:["\n",(0,n.jsxs)(t.li,{children:["Windows Client to OpenLDAP server",(0,n.jsx)(t.br,{}),"\nUsing a direct connection to the LDAP SSL port.",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com",636)']}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Or",(0,n.jsx)(t.br,{}),"\nusing the StartTLSs call",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com")',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)"]}),"\n",(0,n.jsxs)(t.ol,{start:"3",children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Unix client to Windows Active Directory LDAP server.",(0,n.jsx)(t.br,{}),"\nUsing the StartTLSs call. If you want to connect directly to port 636 without using StartTLSs, use the ##Class(%SYS.LDAP).Initialize() method.",(0,n.jsx)(t.br,{}),"\nNote that there are other options pertaining to certificates which can be specified in the LDAP.CONF file on the Unix client (usually found in /etc/openldap/ldap.conf). The settings in this configuration file will be applied to your LDAP sessions you create. Read the man pages for ldap.conf for more information on the parameters.",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com")',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,CACertFileName)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Unix client to OpenLDAPserver.",(0,n.jsx)(t.br,{}),"\nUsing the StartTLSs call. If you want to connect directly to port 636 without using StartTLSs, use the ##Class(%SYS.LDAP).Initialize() method",(0,n.jsx)(t.br,{}),"\nNote that there are other options pertaining to certificates which can be specified in the LDAP.CONF file on the Unix client (usually found in /etc/openldap/ldap.conf). The settings in this configuration file will be applied to your LDAP sessions you create. Read the man pages for ldap.conf for more information on the parameters.",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("ldapserver.example.com")',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,CACertFileName)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Error codes:"}),"\n",(0,n.jsxs)(t.p,{children:["When connecting using SSL, several different error codes could be returned when the connection is formed.",(0,n.jsx)(t.br,{}),'\n-11 or -12 - The certificate is not correct for the LDAP server, or the FQDN host name was not specified correctly. Make sure that you have the CA certificate properly installed on the client, in the correct directory. On a Windows client, make sure it is in local computer certificate store. On a Unix client, make sure the process has read access to the certificate, and that the file specification in the setoption call is correct. Make sure that the LDAP server name specified is the FQDN (e.g. ldapserver.example.com) and not just "ldapserver", or an ip address.',(0,n.jsx)(t.br,{}),"\n81 - Most likely the certificate is not in the correct Windows certificate store. Import it into the local computer store.",(0,n.jsx)(t.br,{}),"\nWhen on a Unix client, if you try to form an SSL connection with one certificate, and the certificate is wrong, or the server is incorrect, your connection may fail even after you have corrected the problem. The issue here is that the process caches the certificate and node information at the O/S level. To correct this, simply log your process out of the system, then log back in."]}),"\n",(0,n.jsx)(t.h3,{id:"initialize",children:"Initialize"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod Initialize(ByRef LD As %Integer = "", URL As %String) As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Connect from a Unix system to a LDAP server."}),"\n",(0,n.jsx)(t.p,{children:"This sets up a connection from a Unix machine to an LDAP server with or without TLS."}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Connect without using TLS to port 389.",(0,n.jsx)(t.br,{}),'\nSet Status=##Class(%SYS.LDAP).Initialize(.ld,"ldap://domain.com")']}),"\n",(0,n.jsxs)(t.li,{children:["Connect using TLS directly to port 636",(0,n.jsx)(t.br,{}),'\nSet Status=##Class(%SYS.LDAP).Initialize(.ld,"ldaps://domain.com")',(0,n.jsx)(t.br,{}),'\nSet Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,"/iris/mgr/CACertFile.pem")']}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Note that the actual connection to the LDAP server will be made when the first operation on the channel which returns data is executed, such as a SimpleBinds()."}),"\n",(0,n.jsx)(t.h3,{id:"firstattribute",children:"FirstAttribute"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod FirstAttribute(LD As %Integer, Entry As %Integer, ByRef Ptr As %Integer) As %String\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return the first attribute of an Entry."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - The entry whose attributes are to be stepped through, as returned by the FirstEntry or NextEntry methods."}),"\n",(0,n.jsxs)(t.p,{children:["Ptr (ByRef) - Used internally to track the current attribute.",(0,n.jsx)(t.br,{}),"\nReturn Values:"]}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, a string containing the name of the first attribute is returned.",(0,n.jsx)(t.br,{}),'\nIf the function fails, it returns "".',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["Use the FirstAttribute with the NextAttribute method to step through a list of attributes in the entry. Once the Attribute name is returned, you can call the GetValues or GetValuesLen method to return the values for that attribute.",(0,n.jsx)(t.br,{}),"\nPass the Ptr parameter by reference to track the current position in the entry."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Loop through all attributes of an entry",(0,n.jsx)(t.br,{}),"\ns CurrentEntry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns AttrName=##Class(%SYS.LDAP).FirstAttribute(LD,CurrentEntry,.Ptr)",(0,n.jsx)(t.br,{}),'\nwhile (AttrName\'="") {',(0,n.jsx)(t.br,{}),"\ns AttrValues=##Class(%SYS.LDAP).GetValues(LD,CurrentEntry,AttrName)",(0,n.jsx)(t.br,{}),"\ns AttrName=##Class(%SYS.LDAP).NextAttribute(LD,CurrentEntry,.Ptr)",(0,n.jsx)(t.br,{}),"\n}"]}),"\n",(0,n.jsx)(t.h3,{id:"modifyexts",children:"ModifyExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod ModifyExts(LD As %Integer, DN As %String, ATTR As %List, ServerControls As %String = "", ClientControls As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Modify an entry in the directory tree."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - String that contains the distinguished name of the entry to modify."}),"\n",(0,n.jsxs)(t.p,{children:["ATTR - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"})," formatted with attributes to modify in the new entry."]}),"\n",(0,n.jsxs)(t.p,{children:["Each element in the list is a separate attribute to be modified in the new entry.",(0,n.jsx)(t.br,{}),"\nAttribute=$lb(op,type,vals)",(0,n.jsx)(t.br,{}),"\nop - Operation to be performed as follows:",(0,n.jsx)(t.br,{}),"\n0 - Add - The given values are added to the entry, creating the attribute if necessary.",(0,n.jsx)(t.br,{}),'\n1 - Delete - The given values are deleted from the entry, removing the attribute if no values remain. If the entire attribute is to be deleted, the mod_values field should be set to NULL ($lb("")).',(0,n.jsx)(t.br,{}),"\n2 - Replace - The attribute will have the listed values after the modification, having been created if necessary. If set to null, then the attribute is deleted.",(0,n.jsx)(t.br,{}),"\n128 - This value should be combined (ORed) with the Add/Delete/Replace value if the data to be inserted is Binary (e.g. jpeg file.)",(0,n.jsx)(t.br,{}),'\ntype - Name of the attribute. Example="Telephone".',(0,n.jsx)(t.br,{}),"\nvals - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"}),' of the values to assign to the attribute. If this is a single entry attribute, then $lb(Value), Example=$lb("617-621-0600"). If a multi-value entry, then $lb(Value1,Value2,...,Valuen).']}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Attr1=$lb(0,"displayName",$lb(Jim Nilson))',(0,n.jsx)(t.br,{}),'\ns Attr2=$lb(0,"telephoneNumber",$lb("617-621-0600")',(0,n.jsx)(t.br,{}),"\n; Replace the Objectclass attribute",(0,n.jsx)(t.br,{}),'\ns Attr3=$lb(2,"objectClass",$lb("top","person","organizationalPerson","user")',(0,n.jsx)(t.br,{}),"\n;Replace Binary value for a jpeg photo",(0,n.jsx)(t.br,{}),'\ns Attr4=$lb(130,"Photo",$lb(jpegphoto))',(0,n.jsx)(t.br,{}),"\n; Delete Address2 attribute",(0,n.jsx)(t.br,{}),'\na Attr5=$lb(1,"Address2","")',(0,n.jsx)(t.br,{}),"\ns Attributes=$lb(Attr1,Attr2,Attr3,Attr4,Attr5)",(0,n.jsx)(t.br,{}),'\ns DN="CN=Nilson\\, Jim,OU=Users,OU=England,DC=iscinternal,DC=com"',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).ModifyExts(LD,DN,Attributes)"]}),"\n",(0,n.jsxs)(t.p,{children:["Note:",(0,n.jsx)(t.br,{}),"\nChanging a password on a Windows Active Directory LDAP server.",(0,n.jsx)(t.br,{}),"\nThe user must first be created before the password change can take place, and the password change must take place over an encrypted channel. The password is contained in the unicodePwd attribute, and must be formatted in a specific way. When initially creating the user, the unicodePwd attribute must not be specified, or the creation of the user will fail.",(0,n.jsx)(t.br,{}),'\nTo format the password, a leading and trailing double quote must be added to it. Then it must be converted to unicode. Then when passed into the modify function, it must be passed in as a binary value, with the "Replace" operation. It must be the only operation contained in the modify call; No other attribute can be changed at the same time.']}),"\n",(0,n.jsxs)(t.p,{children:['s password="NewPassword"',(0,n.jsx)(t.br,{}),'\ns ChangePassword=$zcvt(""""_password_"""","o","UnicodeLittle")',(0,n.jsx)(t.br,{}),'\ns Attr1=$lb(130,"unicodePwd",$lb(ChangePassword))',(0,n.jsx)(t.br,{}),"\ns Attributes=$lb(Attr1)",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).ModifyExts(LD,DN,Attributes,"","")']}),"\n",(0,n.jsx)(t.p,{children:"Note: In order to change a password, the user must have binded to the LDAP server with an account which has administrator privilege on the system. The password which is set must also pass any length or pattern requirements imposed by the security system on the LDAP server."}),"\n",(0,n.jsx)(t.p,{children:"Changing your own password on a Windows Active Directory LDAP server is similar to above, except that you need to bind to the LDAP server using your own username, and must also pass in the old password with the delete attribute. These must also be the only two attributes passed in the modify method."}),"\n",(0,n.jsxs)(t.p,{children:['s oldpassword="OldPassword"',(0,n.jsx)(t.br,{}),'\ns password="NewPassword"',(0,n.jsx)(t.br,{}),'\ns ChangeOldPassword=$zcvt(""""_oldpassword_"""","o","UnicodeLittle")',(0,n.jsx)(t.br,{}),'\ns ChangeNewPassword=$zcvt(""""_password_"""","o","UnicodeLittle")',(0,n.jsx)(t.br,{}),'\ns Attr1=$lb(128,"unicodePwd",$lb(ChangeOldPassword))',(0,n.jsx)(t.br,{}),'\ns Attr2=$lb(129,"unicodePwd",$lb(ChangePassword))',(0,n.jsx)(t.br,{}),"\ns Attributes=$lb(Attr1,Attr2)",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).ModifyExts(LD,DN,Attributes,"","")']}),"\n",(0,n.jsx)(t.h3,{id:"msgfree",children:"MsgFree"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod MsgFree(SearchResult As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Free the results of the last LDAP SearchExts method call."}),"\n",(0,n.jsx)(t.p,{children:"Parameter:"}),"\n",(0,n.jsx)(t.p,{children:"SearchResult - Contains the results of the SearchExts method."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"When done with the search results you must free the search results by calling this method."}),"\n",(0,n.jsx)(t.p,{children:"Failure to do this before a call to UnBinds may cause your process to core on a future LDAP call."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:"s Status=##Class(%SYS.LDAP).MsgFree(SearchResult)"}),"\n",(0,n.jsx)(t.h3,{id:"nextattribute",children:"NextAttribute"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod NextAttribute(LD As %Integer, Entry As %Integer, ByRef Ptr As %Integer) As %String\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return the next attribute of an Entry."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - The entry whose attributes are to be stepped through, as returned by the FirstEntry or NextEntry methods."}),"\n",(0,n.jsxs)(t.p,{children:["Ptr (ByRef)- Used internally to track the current attribute.",(0,n.jsx)(t.br,{}),"\nReturn Values:"]}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, a string containing the name of the next attribute is returned.",(0,n.jsx)(t.br,{}),'\nIf the function fails, it returns "".',(0,n.jsx)(t.br,{}),"\nThe actual session error status can be returned by a call to the GetError method."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["Use the NextAttribute with the FirstAttribute method to step through a list of attributes in the entry. Once the attribute name is returned, you can call the GetValue or GetValuesLen method to return the values for that attribute.",(0,n.jsx)(t.br,{}),"\nPass the Ptr parameter by reference to track the current position in the entry."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Loop through all attributes of an entry",(0,n.jsx)(t.br,{}),"\ns CurrentEntry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns AttrName=##Class(%SYS.LDAP).FirstAttribute(LD,CurrentEntry,.Ptr)",(0,n.jsx)(t.br,{}),'\nwhile (AttrName\'="") {',(0,n.jsx)(t.br,{}),"\ns AttrValues=##Class(%SYS.LDAP).GetValues(LD,CurrentEntry,AttrName)",(0,n.jsx)(t.br,{}),"\ns AttrName=##Class(%SYS.LDAP).NextAttribute(LD,CurrentEntry,.Ptr)"]}),"\n",(0,n.jsx)(t.h3,{id:"nextentry",children:"NextEntry"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod NextEntry(LD As %Integer, Entry As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Return the next entry of a message."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Entry - The Entry as previously returned by FirstEntry() or NextEntry()."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the method succeeds, it returns the entry.",(0,n.jsx)(t.br,{}),"\nIf no entry exists in the result set, it returns 0, and a call to GetError returns $$$LDAPSUCCESS.",(0,n.jsx)(t.br,{}),"\nIf the function fails, it returns 0 and a call to GetError returns the session error."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"Use NextEntry in conjunction with FirstEntry to step through and retrieve the list of entries from a search result chain."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['s Status=##Class(%SYS.LDAP).SearchExts(LD,BaseDN,$$$LDAPSCOPESUBTREE,Filter,Attributes,0,"","",2,ServerTimeout,.SearchResult)',(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).FirstEntry(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).NextEntry(LD,Entry)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status",(0,n.jsx)(t.br,{}),"\ns Entry=##Class(%SYS.LDAP).NextEntry(LD,Entry)",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetError(LD)",(0,n.jsx)(t.br,{}),"\ni Status'=$$$LDAPSUCCESS q Status"]}),"\n",(0,n.jsx)(t.h3,{id:"renameexts",children:"RenameExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod RenameExts(LD As %Integer, DN As %String, NewRDN As %String, NewParent As %String = "", DeleteOldRdn As %Boolean = 1, ServerControls As %String = "", ClientControls As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Rename the distinguished name of an entry in the directory."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - String that contains the distinguished name of the entry to rename."}),"\n",(0,n.jsx)(t.p,{children:"NewRDN - String that contains the new relative distinguished name."}),"\n",(0,n.jsx)(t.p,{children:'NewParent - String that contains the distinguished name of the new parent for this entry or "". This parameter enables you to move the entry to a new parent container.'}),"\n",(0,n.jsx)(t.p,{children:"DeleteOldRdn - 1 if the old relative distinguished name should be deleted; 0 if the old relative distinguished name should be retained."}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:'s Status=##Class(%SYS.LDAP).RenameExts(LD,"CN=Nilson,OU=Users,DC=iscinternal,DC=com","CN=Nelson","",1)'}),"\n",(0,n.jsx)(t.h3,{id:"saslbinds",children:"SASLBinds"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod SASLBinds(LD As %Integer, DN As %String, Mechanism As %String, ByRef ClientCredentials As %String, ServerControls As %String = "", ClientControls As %String = "", ByRef ServerCredentials As %String = "") As %Integer [ Internal ]\n'})}),"\n",(0,n.jsx)(t.p,{children:"Authenticate a client to a server, using a SASL mechanism."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - Full distinguished name of the user to authenticate. This is usually in some form similar to the following:"}),"\n",(0,n.jsx)(t.p,{children:'"CN=testuser,OU=Users,OU=Cambridge,DC=mydomain,DC=com"'}),"\n",(0,n.jsxs)(t.p,{children:['Mechanism - Type of SASL authentication to perform. Currently only "EXTERNAL" is supported. Pass "" for the DN and ClientCredentials.',(0,n.jsx)(t.br,{}),"\nClientCredentials - Credentials for the DN.",(0,n.jsx)(t.br,{}),'\nServerControls - Ignored, pass as "".']}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsxs)(t.p,{children:["ServerCredentials - Server credentials.",(0,n.jsx)(t.br,{}),"\nReturn Values:"]}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"This function should only be used on connections which has been encrypted with SSL/TLS."}),"\n",(0,n.jsx)(t.p,{children:"On a Unix client, use the SetOption calls with $$$LDAPOPTXTLSCERTFILE and $$$LDAPOPTXTLSKEYFILE to pass in the Public and Private key files. Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Initialize a connection to the default Windows domain LDAP server, start the TLS connection, and bind to the server.",(0,n.jsx)(t.br,{}),"\ns LD=##Class(%SYS.LDAP).Init()",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).StartTLSs(LD) s Status=##Class(%SYS.LDAP).SASLBinds(LD,"","EXTERNAL","","","",.ServerCredentials)']}),"\n",(0,n.jsx)(t.h3,{id:"searchexts",children:"SearchExts"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod SearchExts(LD As %Integer, Base As %String, Scope As %Integer, Filter As %String, Attrs As %List, AttrsOnly As %Boolean = 0, ServerControls As %String = "", ClientControls As %String = "", Timeout As %Integer = 0, SizeLimit As %Integer = 0, ByRef SearchResult As %Integer) As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Search the LDAP directory and return a requested set of attributes for each entry."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Base - String that contains the distinguished name of the entry at which to start the search."}),"\n",(0,n.jsx)(t.p,{children:"Scope - Specifies one of the following values to indicate the scope of the search."}),"\n",(0,n.jsxs)(t.p,{children:["$$$LDAPSCOPEBASE -Search the base entry only.",(0,n.jsx)(t.br,{}),"\n$$$LDAPSCOPEONELEVEL - Search all entries in the first level below the base entry, excluding the base entry.",(0,n.jsx)(t.br,{}),"\n$$$LDAPSCOPESUBTREE - Search the base entry and all entries in the tree below the base."]}),"\n",(0,n.jsxs)(t.p,{children:["Filter - String that specifies the search filter. ",(0,n.jsx)(t.strong,{children:'The search filter may need to be escaped for certain characters. On Unix clients, you may get a "Bad Filter" error. See the EscapeFilter() method.'})]}),"\n",(0,n.jsxs)(t.p,{children:["Attrs - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"}),' containing strings indicating which attributes to return for each matching entry. Pass "" to retrieve all available attributes.']}),"\n",(0,n.jsx)(t.p,{children:"AttrsOnly - A boolean value that should be zero if both attribute types and values are to be returned, 1 if only types are wanted."}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Timeout - Specifies both the local search time-out value in seconds and the operation time limit that is sent to the server within the search request."}),"\n",(0,n.jsx)(t.p,{children:"SizeLimit - A limit on the number of entries to return from the search. A value of zero means no limit. If you set this to some value, and the number of results returned by the search is more than this, then the search may return a size limit exceeded error. Note that the number of entries able to be returned is also controlled by a parameter on the LDAP server. If the search returns more than this limit, then a size limit exceeded error will also be returned. Microsoft Active Directory servers by default can return up to 1,000 entries for a search. If your search exceeds this size, you can use the SearchInitPage() and GetNextPages() methods to use a paged search. See"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://support.microsoft.com/en-us/help/315071/how-to-view-and-set-ldap-policy-in-active-directory-by-using-ntdsutil",children:"https://support.microsoft.com/en-us/help/315071/how-to-view-and-set-ldap-policy-in-active-directory-by-using-ntdsutil"})," for more info."]}),"\n",(0,n.jsx)(t.p,{children:"SearchResult (byRef) - Contains the results of the search upon completion of the call."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"When done with the search results you need to free the search results in one of the following ways:"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"1) Call the MsgFree(SearchResult) method."}),"\n",(0,n.jsx)(t.strong,{children:"2) Call SearchExts again, and pass the SearchResult parameter back in unchanged."})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Failure to do this before a call to UnBinds may cause your process to core on a future LDAP call."})}),"\n",(0,n.jsx)(t.p,{children:'Note that the caller can have several different searches "open" at the same time by using a different variable for the SearchResult parameter.'}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:['Search for all users whose Windows login name starts with "steve". Return their display name, e-mail and telephone number. Use a timeout of 10 seconds, and return at most 20 items.',(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SearchExts(LD,"DC=mydomain,DC=com",',(0,n.jsx)(t.br,{}),'\n$$$LDAPSCOPESUBTREE,"sAMAccountname=steve*",',(0,n.jsx)(t.br,{}),'\n$lb("displayName","mail","telephoneNumber"),0,"","",10,20,.SearchResult)']}),"\n",(0,n.jsxs)(t.p,{children:["After calling this method, the user should test for the success of the search before further examining the search result as follows:",(0,n.jsx)(t.br,{}),"\ns NumEntries=##Class(%SYS.LDAP).CountEntries(LD,SearchResult)",(0,n.jsx)(t.br,{}),"\ni NumEntries=-1 s Status=##Class(%SYS.LDAP).GetError(LD) q Status",(0,n.jsx)(t.br,{}),'\ni NumEntries=0 w !,"No search entries found" g SearchAgain',(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.strong,{children:"Note that the SearchResult buffer must be freed with MsgFree(SearchResult) even after a failed search."})]}),"\n",(0,n.jsx)(t.p,{children:"See the documentation in SimpleBindS which shows how to handle errors and retry the operation."}),"\n",(0,n.jsx)(t.h3,{id:"searchinitpage",children:"SearchInitPage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod SearchInitPage(LD As %Integer, Base As %String, Scope As %Integer, Filter As %String, Attrs As %List, AttrsOnly As %Boolean = 0, ServerControls As %String = "", ClientControls As %String = "", Timeout As %Integer = 0, SizeLimit As %Integer = 0, SortKey As %String = "") As %Integer\n'})}),"\n",(0,n.jsx)(t.p,{children:"Search the LDAP directory using a paged search and return a requested set of attributes for each entry."}),"\n",(0,n.jsxs)(t.p,{children:["This is a Windows only method.",(0,n.jsx)(t.br,{}),"\nParameters:"]}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Base - String that contains the distinguished name of the entry at which to start the search."}),"\n",(0,n.jsx)(t.p,{children:"Scope - Specifies one of the following values to indicate the scope of the search."}),"\n",(0,n.jsxs)(t.p,{children:["$$$LDAPSCOPEBASE -Search the base entry only.",(0,n.jsx)(t.br,{}),"\n$$$LDAPSCOPEONELEVEL - Search all entries in the first level below the base entry, excluding the base entry.",(0,n.jsx)(t.br,{}),"\n$$$LDAPSCOPESUBTREE - Search the base entry and all entries in the tree below the base."]}),"\n",(0,n.jsx)(t.p,{children:"Filter - String that specifies the search filter."}),"\n",(0,n.jsxs)(t.p,{children:["Attrs - ",(0,n.jsx)(t.a,{href:"/csp/docbook/Doc.View.cls?FIND=OBJECTSCRIPT+$LIST+FUNCTION",children:"$list"}),' containing strings indicating which attributes to return for each matching entry. Pass "" to retrieve all available attributes.']}),"\n",(0,n.jsx)(t.p,{children:"AttrsOnly - A boolean value that should be zero if both attribute types and values are to be returned, 1 if only types are wanted."}),"\n",(0,n.jsx)(t.p,{children:'ServerControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:'ClientControls - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Timeout - Specifies both the local search time-out value in seconds and the operation time limit that is sent to the server within the search request."}),"\n",(0,n.jsx)(t.p,{children:'SizeLimit - A limit on the number of entries to return from the search for each page. SortOrder - Ignored, pass as "".'}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsx)(t.p,{children:"Page - Contains a pointer to the initialized page of results which should be passed to the GetNextPages() method."}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"When done with the search results you need to free the search results and page the following way:"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"1) First call the MsgFree(SearchResult) method."}),"\n",(0,n.jsx)(t.strong,{children:"2) Then call the the SearchAbandonPage(LD,Page)() method."}),"\n",(0,n.jsx)(t.strong,{children:"Failure to do this before a call to UnBinds may cause your process to core on a future LDAP call."})]}),"\n",(0,n.jsx)(t.p,{children:'Note that the caller can have several different searches "open" at the same time by using a different variable for the Page parameter.'}),"\n",(0,n.jsx)(t.p,{children:"This method allows the user to perform a single search on the LDAP directory which would enought records to exceed the MaxPageSize parameter (default 1,000) on the LDAP server. An example of this would be to build a phone list of all the employees in the LDAP database, where there are more than 1,000 employees."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Search for all users in the LDAP database. Return their display name, e-mail and telephone number. Use a timeout of 5 seconds, and return at most 100 items for each call to the GetNextPages() method.",(0,n.jsx)(t.br,{}),'\ns Page=##Class(%SYS.LDAP).SearchInitPage(LD,"DC=mydomain,DC=com",',(0,n.jsx)(t.br,{}),'\n$$$LDAPSCOPESUBTREE,"sAMAccountname=*",',(0,n.jsx)(t.br,{}),'\n$lb("displayName","mail","telephoneNumber"),0,"","",5,100,"")',(0,n.jsx)(t.br,{}),"\n; Lets limit each next page to 5 entries",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).GetNextPages(LD,Page,5,5,.TotalCount,.SearchResult)",(0,n.jsx)(t.br,{}),"\nWhile (Status=$$$LDAPSUCCESS) {",(0,n.jsx)(t.br,{}),"\nSet Result = ##Class(%SYS.LDAP).FirstEntry(LD, SearchResult)",(0,n.jsx)(t.br,{}),"\nSet DN = ##Class(%SYS.LDAP).GetDN(tLDAPSession, Result)",(0,n.jsx)(t.br,{}),'\nWrite "DN = ",tDN,! ; only print the first DN in each set of 5',(0,n.jsx)(t.br,{}),"\nSet Status = ##Class(%SYS.LDAP).GetNextPages(LD,Page,5,5,.TotalCount,.SearchResult)",(0,n.jsx)(t.br,{}),"\n}",(0,n.jsx)(t.br,{}),'\ni Status=$$$LDAPNORESULTSRETURNED {w !,"End of search"} else { w !,"Error "_Status}',(0,n.jsx)(t.br,{}),"\nSet Status = ##Class(%SYS.LDAP).SearchAbandonPage(LD, Page)"]}),"\n",(0,n.jsx)(t.h3,{id:"searchabandonpage",children:"SearchAbandonPage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod SearchAbandonPage(LD As %Integer, Page As %Integer) As %Integer\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Free the page pointer returned by the SearchInitPage() method() This is a Windows only method.",(0,n.jsx)(t.br,{}),"\nReturn Values:"]}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"When done with the search results you must free the search page by calling this method."}),"\n",(0,n.jsx)(t.p,{children:"Failure to do this before a call to UnBinds may cause your process to core on a future LDAP call."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsx)(t.p,{children:"s Status=##Class(%SYS.LDAP).SearchAbandonPage(LD,Page)"}),"\n",(0,n.jsx)(t.h3,{id:"setoption",children:"SetOption"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod SetOption(LD As %Integer, Option As %Integer, InValue As %String) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Set options for an LDAP session."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Option - The name of the option to set. See valid options below."}),"\n",(0,n.jsx)(t.p,{children:"InValue - Value that the option is to be given. The actual value of this parameter depends on the setting of the option parameter. The constants $$$LDAP_OPT_ON and $$$LDAP_OPT_OFF can be given for options that have on or off settings."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, the return value is $$$LDAPSUCCESS.",(0,n.jsx)(t.br,{}),"\nIf the function fails, it returns an error code."]}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTXTLSNEWCTX - Clears the current SSL/TLS context for the process. If you have called SetOption with any of the LDAPOPTXTLS* parameters below, and then need to change that option, you need to first clear the previous SSL/TLS settings with this option."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTXTLSCACERTFILE - Directory and name of TLS certificate. The certificate needed is that of the certificate authority that signed the certificate of the LDAP server. It needs to be in .PEM format. Available on Unix only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTXTLSCERTFILE - Directory and name of Client X.509 certificate. Available on Unix only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTXTLSKEYFILE - Directory and name of the Client X.509 certificate private key. Notes: Private keys with passwords are not supported by openldap (see the man pages). Available on Unix only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTNETWORKTIMEOUT - Sets the network timeout value after which poll/select following a connect returns in case of no activity. Specifying seconds set to 0 results in an infinite timeout, which is the default. Normally there is no need to change the default. This is available on Unix platforms only."}),"\n",(0,n.jsx)(t.p,{children:"$$$LDAPOPTTIMEOUT - Sets the timeout value for the synchronous API calls. Specifying seconds set to 0 results in an infinite timeout, which is the default. Normally there is no need to change the default. This is available on Unix platforms only."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Set location of TLS certificate for TLS connection:",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,"/usr/share/ssl/certs/ldapserver.pem")']}),"\n",(0,n.jsx)(t.p,{children:"Note: Previous versions allowed the option $$$LDAPOPTPROTOCOLVERSION and $$$LDAPOPTREFERRALS to be specified. These options are deprecated. SetOption calls using this option will be ignored and always will return success. Version is now always set to 3, and referrals are always turned off."}),"\n",(0,n.jsxs)(t.p,{children:["Note: If you set the TLS options on a Unix client, then issue a StartTLS call to an LDAP server then Unbind the connection, the previous TLS settings will remain active even if the SetOption call is subsequently made with a different certificate. Subsequent LDAP StartTLS calls will use the SetOption values from the first StartTLS call until the InterSystems IRIS process exits. To reset to a different certificate, You need to call:",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSNEWCTX,0) ; Clear prior certificate",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,"/usr/share/ssl/certs/newcert.pem")']}),"\n",(0,n.jsx)(t.p,{children:"Note that if you have not previously created a SSL connection, the $$$LDAPOPTXTLSNEWCTX option will return an error. Depending on the structure of your code, it might be better to call this immediately before you call UnBind()."}),"\n",(0,n.jsx)(t.h3,{id:"simplebinds",children:"SimpleBinds"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod SimpleBinds(LD As %Integer, DN As %String, Password As %String) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Authenticate a client to a server, using a plaintext password."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"DN - Full distinguished name of the user to authenticate. This is usually in some form similar to the following:"}),"\n",(0,n.jsx)(t.p,{children:'"CN=testuser,OU=Users,OU=Cambridge,DC=mydomain,DC=com"'}),"\n",(0,n.jsxs)(t.p,{children:["Password - Password for the DN.",(0,n.jsx)(t.br,{}),'\nNOTE: If the password used is a NULL string, then the SimpleBinds function will attempt to do an "unauthenticated" bind to the LDAP server. If unauthenticated binds are allowed by the server, then SimpleBinds will allways succeed when a NULL password is passed. If you are using this method to authenticate a user entered password, then before calling this function you must make sure that the password entered is not NULL.',(0,n.jsx)(t.br,{}),'\nif you wish to do an LDAP "anonymous" bind, pass a null username and password into this method.']}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"This function should only be used on connections which has been encrypted with SSL/TLS as it sends plaintext usernames and passwords across the channel."}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["Initialize a connection to the default Windows domain LDAP server, start the TLS connection, and bind to the server.",(0,n.jsx)(t.br,{}),"\ns LD=##Class(%SYS.LDAP).Init()",(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)",(0,n.jsx)(t.br,{}),"\n;If using for authentication of the user, make sure the password entered is not null.",(0,n.jsx)(t.br,{}),'\ni PW="" w !,"LDAP password cannot be null" q',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).SimpleBinds(LD,DN,PW)"]}),"\n",(0,n.jsxs)(t.p,{children:["Perform an Anonymous bind.",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SimpleBinds(LD,"","")']}),"\n",(0,n.jsxs)(t.p,{children:["Perform an Unauthenticated bind.",(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SimpleBinds(LD,DN,"")']}),"\n",(0,n.jsx)(t.p,{children:'Sometimes a Bind or other LDAP operation may fail with a "Server Down" error on Unix (-1). This is sometimes because one of the system calls is interrupted by a Unix signal or temporary network glitch. In cases like this, the operation can usually be retried:'}),"\n",(0,n.jsxs)(t.p,{children:["RetryInit  s LD=##Class(%SYS.LDAP).Init()  s Status=##Class(%SYS.LDAP).StartTLSs(LD)  s Status=##Class(%SYS.LDAP).SimpleBinds(LD,Username,Password)  i Status'=$$$LDAPSUCCESS { \td CloseServer \ti Status=$$$XLDAPSERVERDOWN { \t\ti RetryCount<5 { \t\t\ts RetryCount=RetryCount+1 \t\t\th .5 \t\t\tg RetryInit \t\t} \t} \ts Status=$$$ERROR($$$LDAPInvalidPassword,Status,##Class(%SYS.LDAP).Err2String(Status)",(0,n.jsx)(t.em,{children:'":"'}),"$g(ErrString)) \tg LDAPError  } ..... CloseServer #;Make sure we free the search buffers here. If we don't we may crash in the unbind on some #;unix boxes.  i $d(SearchResult) { \t Try { \t\t d ##Class(%SYS.LDAP).MsgFree(SearchResult) \t\t k SearchResult \t } catch {}  }  i $d(LD) { \t Try { \t\t s Status1=##Class(%SYS.LDAP).UnBinds(LD) \t\t k LD \t } catch {}  }  q"]}),"\n",(0,n.jsx)(t.h3,{id:"starttlss",children:"StartTLSs"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod StartTLSs(LD As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Start using TLS encryption on an active LDAP session."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsxs)(t.p,{children:["In order to use TLS, the client needs to have a certificate installed on it. For Windows systems, the certificate needs to be installed in the Windows certificate database.",(0,n.jsx)(t.br,{}),"\nNote for Unix, the certificate needs to be copied to the system, and the SetOption method must be called to load the certificate. The certificate must be in .PEM format."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.p,{children:["This example starts a TLS connection on a Unix machine.",(0,n.jsx)(t.br,{}),'\ns LD=##Class(%SYS.LDAP).Init("myldapserver.example.com")',(0,n.jsx)(t.br,{}),'\ns Status=##Class(%SYS.LDAP).SetOption(LD,$$$LDAPOPTXTLSCACERTFILE,"/usr/share/ssl/certs/ldapserver.pem")',(0,n.jsx)(t.br,{}),"\ns Status=##Class(%SYS.LDAP).StartTLSs(LD)"]}),"\n",(0,n.jsx)(t.h3,{id:"stoptlss",children:"StopTLSs"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod StopTLSs(LD As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"Stop using TLS encryption on an active LDAP session."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"This is a Windows only method and is not supported under Unix."}),"\n",(0,n.jsx)(t.h3,{id:"unbinds",children:"UnBinds"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod UnBinds(LD As %Integer) As %Integer\n"})}),"\n",(0,n.jsx)(t.p,{children:"End an LDAP session and frees its resources."}),"\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsx)(t.p,{children:"LD - The session handle returned by the Init method."}),"\n",(0,n.jsx)(t.p,{children:"Return Values:"}),"\n",(0,n.jsxs)(t.p,{children:["If the function succeeds, $$$LDAPSUCCESS is returned.",(0,n.jsx)(t.br,{}),"\nIf the function fails, an error code is returned."]}),"\n",(0,n.jsx)(t.p,{children:"Comments:"}),"\n",(0,n.jsx)(t.p,{children:"Call this method whenever you are finished with an LDAP session and have an LD handle to pass to it."}),"\n",(0,n.jsx)(t.h3,{id:"get",children:"Get"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod Get(Name As %String, ByRef Properties As %String) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(t.h3,{id:"listexecute",children:"ListExecute"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod ListExecute(ByRef %qHandle As %Binary, Names As %String = "*", Flags As %Integer = 0) As %Status [ Internal ]\n'})}),"\n",(0,n.jsxs)(t.p,{children:["List of LDAPConfigs.",(0,n.jsx)(t.br,{}),'\nNames - Comma separated list of LDAP names, "*" = All',(0,n.jsx)(t.br,{}),'\nFlags - 0 - Use "Startswith" as the selection on the name.',(0,n.jsx)(t.br,{}),'\nFlags - 1 - Use "Contains" as the selection on the name.',(0,n.jsx)(t.br,{}),"\nNote: This query may change in future versions"]}),"\n",(0,n.jsx)(t.h3,{id:"listfetch",children:"ListFetch"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod ListFetch(ByRef %qHandle As %Binary, ByRef Row As %List, ByRef AtEnd As %Integer = 0) As %Status [ Internal, PlaceAfter = ListExecute ]\n"})}),"\n",(0,n.jsx)(t.h3,{id:"listclose",children:"ListClose"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod ListClose(ByRef %qHandle As %Binary) As %Status [ Internal, PlaceAfter = ListExecute ]\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>l});var n=s(96540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);