"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[54239],{47338:(e,s,n)=>{n.r(s),n.d(s,{contentTitle:()=>l,default:()=>o,frontMatter:()=>t,toc:()=>a});var r=n(74848),i=n(28453);const t={pagination_prev:null,pagination_next:null},l="%ML.TrainedModel",a=[{value:"Properties",id:"properties",level:2},{value:"Model",id:"model",level:3},{value:"Provider",id:"provider",level:3},{value:"TrainingRun",id:"trainingrun",level:3},{value:"TrainedAt",id:"trainedat",level:3},{value:"ModelName",id:"modelname",level:3},{value:"ModelType",id:"modeltype",level:3},{value:"ModelInfo",id:"modelinfo",level:3},{value:"Triggers",id:"triggers",level:2},{value:"DeleteTrigger",id:"deletetrigger",level:3},{value:"%DeleteTrainedModelTrigger",id:"deletetrainedmodeltrigger",level:3},{value:"Methods",id:"methods",level:2},{value:"%PredictAll",id:"predictall",level:3},{value:"%Begin",id:"begin",level:3},{value:"%End",id:"end",level:3},{value:"%Predict",id:"predict",level:3},{value:"%Probability",id:"probability",level:3},{value:"%ValidateClassifier",id:"validateclassifier",level:3},{value:"%GetROCAUC",id:"getrocauc",level:3},{value:"ExecQuery",id:"execquery",level:3},{value:"%ValidateRegression",id:"validateregression",level:3},{value:"%ValidateTimeseries",id:"validatetimeseries",level:3},{value:"%OnBeforeSave",id:"onbeforesave",level:3}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"mltrainedmodel",children:"%ML.TrainedModel"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Class %ML.TrainedModel Extends %Persistent [ ClassType = persistent, System = 4 ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"Base class for a trained model"}),"\n",(0,r.jsx)(s.h2,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(s.h3,{id:"model",children:"Model"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property Model As %ML.Model [ Required ];\n"})}),"\n",(0,r.jsx)(s.p,{children:"Base model we trained on"}),"\n",(0,r.jsx)(s.h3,{id:"provider",children:"Provider"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property Provider As %String(MAXLEN = 128) [ Required ];\n"})}),"\n",(0,r.jsx)(s.p,{children:"ML Provider that did the training"}),"\n",(0,r.jsx)(s.h3,{id:"trainingrun",children:"TrainingRun"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property TrainingRun As %ML.TrainingRun;\n"})}),"\n",(0,r.jsx)(s.p,{children:"Training run"}),"\n",(0,r.jsx)(s.h3,{id:"trainedat",children:"TrainedAt"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property TrainedAt As %TimeStamp [ InitialExpression = {$ZDATETIME($ZTIMESTAMP,3,1,3)}, Required ];\n"})}),"\n",(0,r.jsx)(s.p,{children:"Timestamp for when the model was trained (UTC)"}),"\n",(0,r.jsx)(s.h3,{id:"modelname",children:"ModelName"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property ModelName As %String(MAXLEN = 275) [ Required ];\n"})}),"\n",(0,r.jsx)(s.p,{children:"Trained Model name, same as the name for the cooresponding Training Run"}),"\n",(0,r.jsx)(s.h3,{id:"modeltype",children:"ModelType"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:'Property ModelType As %String(VALUELIST = ",classification,regression,timeseries");\n'})}),"\n",(0,r.jsx)(s.p,{children:"Model type"}),"\n",(0,r.jsx)(s.h3,{id:"modelinfo",children:"ModelInfo"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Property ModelInfo As array Of %String(MAXLEN = 1024);\n"})}),"\n",(0,r.jsx)(s.p,{children:"Model information"}),"\n",(0,r.jsx)(s.h2,{id:"triggers",children:"Triggers"}),"\n",(0,r.jsx)(s.h3,{id:"deletetrigger",children:"DeleteTrigger"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Trigger DeleteTrigger [ Event = DELETE, Foreach = row/object ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"When deleting a TrainedModel, also delete any %ML.ValidationRun and %ML.ValidationMetric objects for this Model"}),"\n",(0,r.jsx)(s.h3,{id:"deletetrainedmodeltrigger",children:"%DeleteTrainedModelTrigger"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Trigger %DeleteTrainedModelTrigger [ Event = DELETE, Foreach = row/object ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"When deleting a TrainedModel Purge any cached queries that used this trained model"}),"\n",(0,r.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(s.h3,{id:"predictall",children:"%PredictAll"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:'Method %PredictAll(tfn As %Integer, argspos As %List, predpos As %List, probpos As %List = "", expr As %String = "") As %Status\n'})}),"\n",(0,r.jsx)(s.p,{children:"Bulk Predict arguments: tfn - tempfile index argspos - Positions of the WithColumns in the temp rows, $list(column-positions) predpos - Position of the predicted value, $list(result-column-positions) probpos - Position of the probability value, $list(result-column-positions) expr - expression for probability returns: $$$OK on success, otherwise a $$$ERROR(...)"}),"\n",(0,r.jsx)(s.h3,{id:"begin",children:"%Begin"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %Begin() As %Status [ Abstract ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"Begin model operations"}),"\n",(0,r.jsx)(s.h3,{id:"end",children:"%End"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %End() As %Status [ Abstract ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"End model operations"}),"\n",(0,r.jsx)(s.h3,{id:"predict",children:"%Predict"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %Predict(data As %List, ByRef results As %List) As %Status [ Abstract ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"Predict on an ML model"}),"\n",(0,r.jsx)(s.h3,{id:"probability",children:"%Probability"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %Probability(expr As %String = 1, data As %List, ByRef results As %List) As %Status [ Abstract ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"Predict probability on an ML model Arguments: expr: The argument of PROBABILITY's FOR clause, defaults to 1 data: $List of WITH clause values results: PBR, return value"}),"\n",(0,r.jsx)(s.h3,{id:"validateclassifier",children:"%ValidateClassifier"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %ValidateClassifier(query As %String, ByRef validationRun As %ML.ValidationRun, using As %DynamicObject = {$$$NULLOREF}) [ Internal ]\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Do not call this method directly. Please refer to the SQL syntax as documented in %ML.Model"]}),"\n",(0,r.jsxs)(s.p,{children:["This method produces %ML.ValidationMetric records for ",(0,r.jsx)(s.strong,{children:"Precision"}),", ",(0,r.jsx)(s.strong,{children:"Recall"}),", ",(0,r.jsx)(s.strong,{children:"F-Measure"})," and ",(0,r.jsx)(s.strong,{children:"ROC-AUC"}),' for this TrainedModel instance. For multi-class classifications, these metrics will be calculated for every predicted field value (category), as well as a micro-average across all target values. For binary classifications, these metrics will only be calculated for the "positive" (1, "true" or "yes") category, or for the first value encountered if no such value is found. Overall ',(0,r.jsx)(s.strong,{children:"Accuracy"})," and ",(0,r.jsx)(s.strong,{children:"ROC-AUC"})," numbers are also saved."]}),"\n",(0,r.jsx)(s.p,{children:"A full implementation is included in this class, so there is no need for providers to override anything unless there's a compelling argument on performance or breadth of supported metrics to do so."}),"\n",(0,r.jsx)(s.h3,{id:"getrocauc",children:"%GetROCAUC"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod %GetROCAUC(modelName, category, predictedCol, validateTblQuery, Output ROCAUC) As %Status\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Compute the area under the ROC curve for a given label ",(0,r.jsx)(s.strong,{children:"category"})," where"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"modelName"})," is the name of an %ML.TrainedModel object"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"predictedCol"})," is the name of the label column"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"tblQuery"})," points to the validation table."]}),"\n",(0,r.jsxs)(s.p,{children:["The output is returned in the ",(0,r.jsx)(s.strong,{children:"ROCAUC"})," variable."]}),"\n",(0,r.jsx)(s.h3,{id:"execquery",children:"ExecQuery"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"ClassMethod ExecQuery(query, Output tRS As %SQL.StatementResult) As %Status [ Internal ]\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Do not call this method directly."]}),"\n",(0,r.jsx)(s.p,{children:"This is a utility method that accepts a SQL query and populates results into a %SQL.Statement object."}),"\n",(0,r.jsx)(s.h3,{id:"validateregression",children:"%ValidateRegression"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %ValidateRegression(query As %String, ByRef validationRun As %ML.ValidationRun, using As %DynamicObject = {$$$NULLOREF}) [ Internal ]\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Do not call this method directly. Please refer to the SQL syntax as documented in %ML.Model"]}),"\n",(0,r.jsxs)(s.p,{children:["This method produces %ML.ValidationMetric records for ",(0,r.jsx)(s.strong,{children:"Variance"}),", ",(0,r.jsx)(s.strong,{children:"MSE"}),", ",(0,r.jsx)(s.strong,{children:"RMSE"})," and ",(0,r.jsx)(s.strong,{children:"R\ufffd"})," for this TrainedModel instance."]}),"\n",(0,r.jsx)(s.p,{children:"A full implementation is included in this class, so there is no need for providers to override anything unless there's a compelling argument on performance or breadth of supported metrics to do so."}),"\n",(0,r.jsx)(s.h3,{id:"validatetimeseries",children:"%ValidateTimeseries"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %ValidateTimeseries(query As %String, ByRef validationRun As %ML.ValidationRun, using As %DynamicObject = {$$$NULLOREF}) [ Internal ]\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Do not call this method directly. Please refer to the SQL syntax as documented in %ML.Model"]}),"\n",(0,r.jsxs)(s.p,{children:["This method produces %ML.ValidationMetric records for ",(0,r.jsx)(s.strong,{children:"Variance"}),", ",(0,r.jsx)(s.strong,{children:"MAPE"}),", for this TrainedModel instance."]}),"\n",(0,r.jsx)(s.p,{children:"A full implementation is included in this class, so there is no need for providers to override anything unless there's a compelling argument on performance or breadth of supported metrics to do so."}),"\n",(0,r.jsx)(s.h3,{id:"onbeforesave",children:"%OnBeforeSave"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-objectscript-class",children:"Method %OnBeforeSave(insert As %Boolean) As %Status [ Private, ServerOnly = 1 ]\n"})}),"\n",(0,r.jsx)(s.p,{children:"This callback method is invoked by the %Save method to provide notification that the object is being saved. It is called before any data is written to disk."}),"\n",(0,r.jsx)(s.p,{children:"insert will be set to 1 if this object is being saved for the first time."}),"\n",(0,r.jsx)(s.p,{children:"If this method returns an error then the call to %Save will fail."})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var r=n(96540);const i={},t=r.createContext(i);function l(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);