"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[17351],{84723:(e,r,s)=>{s.r(r),s.d(r,{contentTitle:()=>a,default:()=>c,frontMatter:()=>t,toc:()=>l});var n=s(74848),i=s(28453);const t={pagination_prev:null,pagination_next:null},a="Config.Journal",l=[{value:"Parameters",id:"parameters",level:2},{value:"NOTRANSACTIONS",id:"notransactions",level:3},{value:"Properties",id:"properties",level:2},{value:"AlternateDirectory",id:"alternatedirectory",level:3},{value:"ArchiveName",id:"archivename",level:3},{value:"BackupsBeforePurge",id:"backupsbeforepurge",level:3},{value:"CurrentDirectory",id:"currentdirectory",level:3},{value:"PurgeArchived",id:"purgearchived",level:3},{value:"DaysBeforePurge",id:"daysbeforepurge",level:3},{value:"FileSizeLimit",id:"filesizelimit",level:3},{value:"FreezeOnError",id:"freezeonerror",level:3},{value:"JournalcspSession",id:"journalcspsession",level:3},{value:"JournalFilePrefix",id:"journalfileprefix",level:3},{value:"CompressFiles",id:"compressfiles",level:3},{value:"Methods",id:"methods",level:2},{value:"AlternateDirectorySet",id:"alternatedirectoryset",level:3},{value:"CurrentDirectorySet",id:"currentdirectoryset",level:3},{value:"IsJrnDirValid",id:"isjrndirvalid",level:3},{value:"JournalFilePrefixIsValid",id:"journalfileprefixisvalid",level:3},{value:"Load",id:"load",level:3},{value:"MoveToActive",id:"movetoactive",level:3},{value:"Verify",id:"verify",level:3},{value:"%OnValidateObject",id:"onvalidateobject",level:3},{value:"GetMirrorPrefix",id:"getmirrorprefix",level:3},{value:"TranslateTime",id:"translatetime",level:3}];function o(e){const r={br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"configjournal",children:"Config.Journal"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Class Config.Journal Extends (%Persistent, Config.CommonSingleMethods, Config.CommonProperties, %SYSTEM.Help) [ Final, Inheritance = right, System = 4 ]\n"})}),"\n",(0,n.jsxs)(r.p,{children:["This class allows you to modify and view the [Journal] section of the CPF file through programatic APIs. While properties are usually modified through the System Management portal, there may be some occasion where modifying them through the API's is best for your system. In all the Config methods, if you do not specify the CPFFile parameter, the currently active CPF file is used. If you wish to modify a CPF file which is not the currently active one, then specify the CPFFile you wish to modify in the method call.",(0,n.jsx)(r.br,{}),"\nThe Flags parameter does not normally need to be specified; the defaults are usually sufficient for most cases.",(0,n.jsx)(r.br,{}),"\nYou can use the provided API's (Get/Modify) to modify the properties by passing in the correct parameters."]}),"\n",(0,n.jsx)(r.p,{children:"NOTE: You cannot use object syntax to directly modify the [Journal] parameters. You MUST use the API's found in this class."}),"\n",(0,n.jsx)(r.p,{children:"EXAMPLE:"}),"\n",(0,n.jsxs)(r.p,{children:['; Use class methods to modify properties %SYS>s Status=##Class(Config.Journal).Get(.Properties) %SYS>i \'Status w !,"Error="',(0,n.jsx)(r.em,{children:'$SYSTEM.Status.GetErrorText(Status) %SYS>zw Properties Properties("AlternateDirectory")="C:\\AppDB1\\Mgr\\Journal" Properties("ArchiveName")="" Properties("BackupsBeforePurge")=2 Properties("CurrentDirectory")="C:\\AppDB1\\Mgr\\Journal" Properties("CompressFiles")=1 Properties("DaysBeforePurge")=2 Properties("FileSizeLimit")=2048 Properties("FreezeOnError")=0 Properties("JournalFilePrefix")="" Properties("JournalcspSession")=1 Properties("PurgeArchived")=0 %SYS>s Properties("FileSizeLimit")=1024 %SYS>s Status=##Class(Config.Journal).Modify(.Properties) %SYS>i \'Status w !,"Error="'}),"$SYSTEM.Status.GetErrorText(Status)"]}),"\n",(0,n.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsx)(r.h3,{id:"notransactions",children:"NOTRANSACTIONS"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Parameter NOTRANSACTIONS = 1;\n"})}),"\n",(0,n.jsx)(r.p,{children:"Setting this flag keeps the journal updates outside of a transaction When %Save() is called in the API's."}),"\n",(0,n.jsx)(r.h2,{id:"properties",children:"Properties"}),"\n",(0,n.jsx)(r.h3,{id:"alternatedirectory",children:"AlternateDirectory"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property AlternateDirectory As %SysPath;\n"})}),"\n",(0,n.jsx)(r.p,{children:"Alternate journal directory."}),"\n",(0,n.jsx)(r.h3,{id:"archivename",children:"ArchiveName"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property ArchiveName As %String(MAXLEN = 256);\n"})}),"\n",(0,n.jsx)(r.p,{children:"The destination for archiving journal files, given as the name of an archive target defined in the [Archives] section."}),"\n",(0,n.jsx)(r.h3,{id:"backupsbeforepurge",children:"BackupsBeforePurge"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property BackupsBeforePurge As %Integer(MAXVAL = 10, MINVAL = 0) [ InitialExpression = 2 ];\n"})}),"\n",(0,n.jsx)(r.p,{children:"Number of backups before the journal files (or the archived copies) are automatically purged."}),"\n",(0,n.jsx)(r.h3,{id:"currentdirectory",children:"CurrentDirectory"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property CurrentDirectory As %SysPath;\n"})}),"\n",(0,n.jsx)(r.p,{children:"Primary journal directory."}),"\n",(0,n.jsx)(r.h3,{id:"purgearchived",children:"PurgeArchived"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property PurgeArchived As %Boolean [ InitialExpression = 0 ];\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Whether to purge journal files as soon as they are copied to archive.",(0,n.jsx)(r.br,{}),"\nNote that purging never occur if files are needed by the system (for crash recovery, mirroring, etc.)"]}),"\n",(0,n.jsx)(r.h3,{id:"daysbeforepurge",children:"DaysBeforePurge"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property DaysBeforePurge As %Integer(MAXVAL = 100, MINVAL = 0) [ InitialExpression = 2, Required ];\n"})}),"\n",(0,n.jsx)(r.p,{children:"Number of days before the journal files are purged."}),"\n",(0,n.jsx)(r.h3,{id:"filesizelimit",children:"FileSizeLimit"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property FileSizeLimit As %Integer(MAXVAL = 4079, MINVAL = 0) [ InitialExpression = 1024, Required ];\n"})}),"\n",(0,n.jsx)(r.p,{children:"Maximum size of each journal file in MB."}),"\n",(0,n.jsx)(r.h3,{id:"freezeonerror",children:"FreezeOnError"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property FreezeOnError As Security.Datatype.BooleanYN [ InitialExpression = 0, Required ];\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Freeze the system if there is an error writing to the journal.",(0,n.jsx)(r.br,{}),"\nIf this option is set to true (1), as soon as the error occurs all global activities that are normally journaled are blocked, which causes other jobs to block. The typical outcome is that the system goes into a hang state until the journaling problem is resolved, and then resumes running. While InterSystems IRIS is hanging, the administrator can take corrective measures, such as freeing up space on a disk that is full, switching the journal to a new disk, etc. This option has the advantage that once the problem is fixed and InterSystems IRIS resumes running, no journal information has been lost. It has the disadvantage that the system is less available while the problem is being solved.",(0,n.jsx)(r.br,{}),"\nIf this option is set to false (0), when a journaling error occurs journaling is entirely disabled, while the system continues running as normal. The system sends a console message to alert the administrator, who can fix the problem and then run ^JRNSWTCH at the console to restart journaling."]}),"\n",(0,n.jsx)(r.h3,{id:"journalcspsession",children:"JournalcspSession"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property JournalcspSession As Security.Datatype.BooleanYN [ InitialExpression = 0, Required ];\n"})}),"\n",(0,n.jsx)(r.p,{children:"%cspSession global will be mapped to the TEMP database and not journaled."}),"\n",(0,n.jsx)(r.h3,{id:"journalfileprefix",children:"JournalFilePrefix"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property JournalFilePrefix As %String(MAXLEN = 64, MINLEN = 0);\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Prefixes journal file names with this string.",(0,n.jsx)(r.br,{}),"\nMay be used to distinguish journal files from different instances in the same directory."]}),"\n",(0,n.jsx)(r.h3,{id:"compressfiles",children:"CompressFiles"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Property CompressFiles As Security.Datatype.BooleanYN [ InitialExpression = 1, Internal ];\n"})}),"\n",(0,n.jsx)(r.p,{children:"Optional property CompressFiles when set indicates that journal files should be compressed after they are created. Files are created in uncompressed form and a compression job watches for new files to process. Compressed journal files have a 'z' appended to the end of the file type (sequence number). Journal files are accessed by their uncompressed filename and the system adds the 'z' if needed. Files are compressed and then deleted so as not to cause problems with a file which is in use while it is being compressed. If a file cannot be deleted because it is being used, it is added to a list to be retried later."}),"\n",(0,n.jsx)(r.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(r.h3,{id:"alternatedirectoryset",children:"AlternateDirectorySet"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Method AlternateDirectorySet(Directory As %SysPath) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.h3,{id:"currentdirectoryset",children:"CurrentDirectorySet"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Method CurrentDirectorySet(Directory As %SysPath) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.h3,{id:"isjrndirvalid",children:"IsJrnDirValid"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod IsJrnDirValid(Directory As %String, Prefix As %String) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.h3,{id:"journalfileprefixisvalid",children:"JournalFilePrefixIsValid"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod JournalFilePrefixIsValid(Val As %String) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Validate the journal file prefix name."}),"\n",(0,n.jsx)(r.h3,{id:"load",children:"Load"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'ClassMethod Load(Obj As %ObjectHandle = "", Flags As %Integer = 1) As %Status [ Internal ]\n'})}),"\n",(0,n.jsxs)(r.p,{children:["Load the parameters into memory and activate.",(0,n.jsx)(r.br,{}),"\nParameters:",(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Obj"}),' = Handle to the object which caused the load. If "", then load everything, only called from STU.',(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Flags"})," = Type of modification.",(0,n.jsx)(r.br,{}),"\n0 - Modify",(0,n.jsx)(r.br,{}),"\n1 - Create/Insert"]}),"\n",(0,n.jsx)(r.h3,{id:"movetoactive",children:"MoveToActive"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:'ClassMethod MoveToActive(Obj As %ObjectHandle = "", Flags As %Integer = 1) As %Status [ Internal ]\n'})}),"\n",(0,n.jsxs)(r.p,{children:["Load the parameters into ^CONFIG() as activate.",(0,n.jsx)(r.br,{}),"\nParameters:",(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Obj"}),' = Handle to the object which caused the load. If "", then load everything, only called from STU.',(0,n.jsx)(r.br,{}),"\nIf a delete operation, then Obj is the NAME of the item which was deleted since the oject itself has already been deleted.",(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Flags"})," = Type of modification.",(0,n.jsx)(r.br,{}),"\n0 - Modify",(0,n.jsx)(r.br,{}),"\n1 - Create/Insert",(0,n.jsx)(r.br,{}),"\n2 - Delete"]}),"\n",(0,n.jsx)(r.h3,{id:"verify",children:"Verify"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod Verify(Directory As %String, Prefix As %String) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.h3,{id:"onvalidateobject",children:"%OnValidateObject"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"Method %OnValidateObject() As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Called from %Save()."}),"\n",(0,n.jsx)(r.h3,{id:"getmirrorprefix",children:"GetMirrorPrefix"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod GetMirrorPrefix() As %String [ Internal ]\n"})}),"\n",(0,n.jsx)(r.p,{children:"Find the longest mirror set name configured and return mirror prefix. Return null if no mirror is configured."}),"\n",(0,n.jsx)(r.h3,{id:"translatetime",children:"TranslateTime"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-objectscript-class",children:"ClassMethod TranslateTime(TimeValue As %Integer, ByRef ScaleFactor As %Integer) As %Integer\n"})}),"\n",(0,n.jsxs)(r.p,{children:["TimeValue: in seconds",(0,n.jsx)(r.br,{}),"\nReturned value: in seconds, minutes, hours or days, whichever is the largest unit that makes the returned value a whole number.",(0,n.jsx)(r.br,{}),"\nScaleFactor: Returned value * ScaleFactor = TimeValue"]})]})}function c(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},28453:(e,r,s)=>{s.d(r,{R:()=>a,x:()=>l});var n=s(96540);const i={},t=n.createContext(i);function a(e){const r=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);