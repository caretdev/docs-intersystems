"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[98201],{43263:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>a,default:()=>d,frontMatter:()=>n,toc:()=>c});var i=s(74848),r=s(28453);const n={pagination_prev:null,pagination_next:null},a="PKI.CAServer",c=[{value:"Parameters",id:"parameters",level:2},{value:"SERVICENAME",id:"servicename",level:3},{value:"NAMESPACE",id:"namespace",level:3},{value:"USECLASSNAMESPACES",id:"useclassnamespaces",level:3},{value:"IRISCA",id:"irisca",level:3},{value:"Properties",id:"properties",level:2},{value:"Name",id:"name",level:3},{value:"CAPath",id:"capath",level:3},{value:"CAFilename",id:"cafilename",level:3},{value:"AttributePrompt",id:"attributeprompt",level:3},{value:"AttributeType",id:"attributetype",level:3},{value:"Days",id:"days",level:3},{value:"SMTPServer",id:"smtpserver",level:3},{value:"SMTPUsername",id:"smtpusername",level:3},{value:"SMTPPassword",id:"smtppassword",level:3},{value:"AdminEmail",id:"adminemail",level:3},{value:"Methods",id:"methods",level:2},{value:"BuildSubject",id:"buildsubject",level:3},{value:"SubmitCSR",id:"submitcsr",level:3},{value:"ListCertificates",id:"listcertificates",level:3},{value:"GetCertificate",id:"getcertificate",level:3},{value:"Sign",id:"sign",level:3},{value:"Configure",id:"configure",level:3},{value:"ConfigureData",id:"configuredata",level:3},{value:"%OnAfterSave",id:"onaftersave",level:3},{value:"%OnAfterDelete",id:"onafterdelete",level:3},{value:"CheckWebApp",id:"checkwebapp",level:3}];function l(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"pkicaserver",children:"PKI.CAServer"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Class PKI.CAServer Extends (%Persistent, %SOAP.WebService) [ Deprecated ]\n"})}),"\n",(0,i.jsx)(t.p,{children:"Certificate Authority server. Use with PKI.CAClient."}),"\n",(0,i.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsx)(t.h3,{id:"servicename",children:"SERVICENAME"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter SERVICENAME = "CAServer";\n'})}),"\n",(0,i.jsx)(t.p,{children:"Name of the WebService."}),"\n",(0,i.jsx)(t.h3,{id:"namespace",children:"NAMESPACE"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter NAMESPACE = "http://pki.intersystems.com";\n'})}),"\n",(0,i.jsx)(t.p,{children:"SOAP Namespace for the WebService"}),"\n",(0,i.jsx)(t.h3,{id:"useclassnamespaces",children:"USECLASSNAMESPACES"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Parameter USECLASSNAMESPACES = 1;\n"})}),"\n",(0,i.jsx)(t.p,{children:"Namespaces of referenced classes will be used in the WSDL."}),"\n",(0,i.jsx)(t.h3,{id:"irisca",children:"IRISCA"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter IRISCA = "IRIS CA";\n'})}),"\n",(0,i.jsx)(t.h2,{id:"properties",children:"Properties"}),"\n",(0,i.jsx)(t.h3,{id:"name",children:"Name"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property Name As %String [ InitialExpression = {..#IRISCA}, Required ];\n"})}),"\n",(0,i.jsx)(t.p,{children:'The default Certificate Authority server has the name "IRIS CA". There is at most one per InterSystems IRIS instance.'}),"\n",(0,i.jsx)(t.h3,{id:"capath",children:"CAPath"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property CAPath As %String(MAXLEN = 200);\n"})}),"\n",(0,i.jsx)(t.p,{children:"Path to this Certificate Authority server's Certificate (.cer) and Private Key (.key) files"}),"\n",(0,i.jsx)(t.h3,{id:"cafilename",children:"CAFilename"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property CAFilename As %String [ Required ];\n"})}),"\n",(0,i.jsx)(t.p,{children:"Name of this Certificate Authority server's Certificate (.cer) and Private Key (.key) files"}),"\n",(0,i.jsx)(t.h3,{id:"attributeprompt",children:"AttributePrompt"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:'Property AttributePrompt As %String(MAXLEN = 100) [ InitialExpression = "Country,State or Province,Locality,Organization,Organizational Unit,Common Name" ];\n'})}),"\n",(0,i.jsx)(t.p,{children:"Prompts to use when building a %List for constructing a Subject Distinguished Name."}),"\n",(0,i.jsx)(t.h3,{id:"attributetype",children:"AttributeType"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:'Property AttributeType As %String [ InitialExpression = "C,ST,L,O,OU,CN" ];\n'})}),"\n",(0,i.jsx)(t.p,{children:'Attribute type keywords to use when building the "-subject" argument to the "openssl req" command'}),"\n",(0,i.jsx)(t.h3,{id:"days",children:"Days"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property Days As %Integer [ InitialExpression = 365, Required ];\n"})}),"\n",(0,i.jsx)(t.p,{children:"Validity period (in days) for issued certificates"}),"\n",(0,i.jsx)(t.h3,{id:"smtpserver",children:"SMTPServer"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property SMTPServer As %String;\n"})}),"\n",(0,i.jsx)(t.p,{children:"SMTP server for sending email notification on receipt of a Certificate Signing Request or issuance of a Certificate"}),"\n",(0,i.jsx)(t.h3,{id:"smtpusername",children:"SMTPUsername"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property SMTPUsername As %String;\n"})}),"\n",(0,i.jsx)(t.p,{children:"SMTP username for sending email notification on receipt of a Certificate Signing Request or issuance of a Certificate"}),"\n",(0,i.jsx)(t.h3,{id:"smtppassword",children:"SMTPPassword"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property SMTPPassword As %String;\n"})}),"\n",(0,i.jsx)(t.p,{children:"SMTP password for sending email notification on receipt of a Certificate Signing Request or issuance of a Certificate"}),"\n",(0,i.jsx)(t.h3,{id:"adminemail",children:"AdminEmail"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Property AdminEmail As %String;\n"})}),"\n",(0,i.jsx)(t.p,{children:"Email address of the administrator of this Certificate Authority server. Email notification will be sent to this address on receipt of a Certificate Signing Request."}),"\n",(0,i.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,i.jsx)(t.h3,{id:"buildsubject",children:"BuildSubject"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method BuildSubject(values As %List) As %String\n"})}),"\n",(0,i.jsx)(t.p,{children:'Build the "-subject" argument to the "openssl req" command from a %List'}),"\n",(0,i.jsx)(t.h3,{id:"submitcsr",children:"SubmitCSR"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method SubmitCSR(csr As PKI.CSR) As %String [ WebMethod ]\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Web method for submitting a Certificate Signing Request. This method saves the PKI.CSR object and sends notification to the email address of the administrator of this Certificate Authority server.",(0,i.jsx)(t.br,{}),"\nParameter:",(0,i.jsx)(t.br,{}),"\ncsr - a PKI.CSR object",(0,i.jsx)(t.br,{}),"\nReturn value:",(0,i.jsx)(t.br,{}),"\nString describing successful Certificate Signing Request submission, or a SOAP fault on error"]}),"\n",(0,i.jsx)(t.h3,{id:"listcertificates",children:"ListCertificates"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method ListCertificates(hostname As %String, instance As %String) As %XML.DataSet [ WebMethod ]\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Web method for retrieving a list of X.509 Certificates issued by this Certificate Authority server.",(0,i.jsx)(t.br,{}),"\nReturn value:",(0,i.jsx)(t.br,{}),"\nAn %XML.DataSet object"]}),"\n",(0,i.jsx)(t.h3,{id:"getcertificate",children:"GetCertificate"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method GetCertificate(number As %String) As PKI.Certificate [ WebMethod ]\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Web method for retrieving an X.509 Certificate issued by this Certificate Authority server.",(0,i.jsx)(t.br,{}),"\nParameter:",(0,i.jsx)(t.br,{}),"\nnumber - serial number of the X.509 Certificate requested, or 0 to request this Certificate Authority server's X.509 Certificate",(0,i.jsx)(t.br,{}),"\nReturn value:",(0,i.jsx)(t.br,{}),"\nA PKI.Certificate object"]}),"\n",(0,i.jsx)(t.h3,{id:"sign",children:"Sign"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method Sign(name As %String, password As %String, certType As %Integer, ByRef st As %Status) As %String\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Issue an X.509 Certificate for a Certificate Signing Request. This method creates and saves a PKI.Certificate object and sends notification to the email address of the local technical contact of the Certificate Authority client that generated the Certificate Signing Request.",(0,i.jsx)(t.br,{}),"\nParameters:",(0,i.jsx)(t.br,{}),"\nname - Name of the Certificate Signing Request to be processed",(0,i.jsx)(t.br,{}),"\npassword - Password for this Certificate Authority server's Private Key file",(0,i.jsx)(t.br,{}),"\ncertType - Intended usage of the issued certificate",(0,i.jsx)(t.br,{}),"\n1 = TLS/SSL, XML encryption and signature verification",(0,i.jsx)(t.br,{}),"\n2 = Intermediate Certificate Authority server",(0,i.jsx)(t.br,{}),"\nst - On return, contains a status code",(0,i.jsx)(t.br,{}),"\nReturn value:",(0,i.jsx)(t.br,{}),"\nString describing successful Certificate issuance, or error"]}),"\n",(0,i.jsx)(t.h3,{id:"configure",children:"Configure"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod Configure(server As PKI.CAServer, attrList As %List, password As %String, days As %Integer, ByRef st As %Status) As %String\n"})}),"\n",(0,i.jsx)(t.p,{children:"Two use cases:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Configure this Certificate Authority server.",(0,i.jsx)(t.br,{}),'\nMust be called before Certificate Signing Requests can be submitted or Certificates issued. Creates the OpenSSL configuration file "openssl.cnf" if it does not exist. When called for the first time, this method creates this Certificate Authority server\'s Certificate (.cer) and Private Key (.key) files, and creates and saves its PKI.Certificate object. Once created these can not be changed. The other properties of this Certificate Authority server can be updated later.',(0,i.jsx)(t.br,{}),"\nParameters:",(0,i.jsx)(t.br,{}),"\nserver - PKI.CAServer object, with all required properties set",(0,i.jsx)(t.br,{}),"\nattrList - %List containing attribute values to be used in constructing this Certificate Authority server's Subject Distinguished Name (first invocation only)",(0,i.jsx)(t.br,{}),"\npassword - Password used to encrypt Private Key file (first invocation only)",(0,i.jsx)(t.br,{}),"\ndays - desired validity period of CA certificate, in days",(0,i.jsx)(t.br,{}),"\nst - On return, contains a status code",(0,i.jsx)(t.br,{}),"\nReturn value:",(0,i.jsx)(t.br,{}),"\nString describing successful configuration, or error"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Update the openssl.cnf file to the latest version",(0,i.jsx)(t.br,{}),"\nCalling ##class(PKI.CAServer).Configure() with no arguments will create or update the openssl.cnf file to the latest version."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"configuredata",children:"ConfigureData"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method ConfigureData() [ ProcedureBlock = 0 ]\n"})}),"\n",(0,i.jsx)(t.h3,{id:"onaftersave",children:"%OnAfterSave"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"Method %OnAfterSave(insert As %Boolean) As %Status [ Internal, Private ]\n"})}),"\n",(0,i.jsx)(t.h3,{id:"onafterdelete",children:"%OnAfterDelete"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod %OnAfterDelete(oid As %ObjectIdentity) As %Status [ Internal, Private ]\n"})}),"\n",(0,i.jsx)(t.h3,{id:"checkwebapp",children:"CheckWebApp"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod CheckWebApp() As %Status [ Internal ]\n"})}),"\n",(0,i.jsx)(t.p,{children:"This method will ensure that the /isc/pki web application is enabled if the default CAServer instance is configured and disabled otherwise. If the application does not exist this will return an error."})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>c});var i=s(96540);const r={},n=i.createContext(r);function a(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);