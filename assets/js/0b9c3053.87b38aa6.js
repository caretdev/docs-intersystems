"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[39716],{59644:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>c,default:()=>o,frontMatter:()=>r,toc:()=>a});var n=s(74848),i=s(28453);const r={pagination_prev:null,pagination_next:null},c="%Net.MQTT.Client",a=[{value:"Parameters",id:"parameters",level:2},{value:"DOMAIN",id:"domain",level:3},{value:"Properties",id:"properties",level:2},{value:"TimedOut",id:"timedout",level:3},{value:"Handle",id:"handle",level:3},{value:"UrlScheme",id:"urlscheme",level:3},{value:"ClientId",id:"clientid",level:3},{value:"Methods",id:"methods",level:2},{value:"%OnNew",id:"onnew",level:3},{value:"Connect",id:"connect",level:3},{value:"Disconnect",id:"disconnect",level:3},{value:"IsConnected",id:"isconnected",level:3},{value:"Publish",id:"publish",level:3},{value:"Subscribe",id:"subscribe",level:3},{value:"Receive",id:"receive",level:3},{value:"Unsubscribe",id:"unsubscribe",level:3},{value:"%OnClose",id:"onclose",level:3},{value:"DecodeError",id:"decodeerror",level:3},{value:"Create",id:"create",level:3},{value:"Destroy",id:"destroy",level:3}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"netmqttclient",children:"%Net.MQTT.Client"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Class %Net.MQTT.Client Extends %RegisteredObject\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This class implements an interface to the eclispse paho-c MQTT client library. Details of of the library can be found here :- ",(0,n.jsx)(t.a,{href:"https://www.eclipse.org/paho/clients/c",children:"https://www.eclipse.org/paho/clients/c"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"The client provides the ability to connect to a third-party MQTT broker and publish or subscribe to topics and send/receive messages. MQTT is a light-weight protocol and can provide superior performance to HTTP based messaging. There are many excellent tutorials for MQTT to be found on the internet and one should take the time to become familiar with the basics as although the interface to the client is relatively straight-forward, the behaviors can be sophisticated depending upon which options are selected. All strings passed to the library have the requirement to be utf-8 encoded which includes, but is not limited to, messages, topics, usernames and passwords."}),"\n",(0,n.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsx)(t.h3,{id:"domain",children:"DOMAIN"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Parameter DOMAIN = "%ObjectErrors";\n'})}),"\n",(0,n.jsx)(t.p,{children:"Error Text Domain"}),"\n",(0,n.jsx)(t.h2,{id:"properties",children:"Properties"}),"\n",(0,n.jsx)(t.h3,{id:"timedout",children:"TimedOut"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property TimedOut As %Boolean [ InitialExpression = 0 ];\n"})}),"\n",(0,n.jsx)(t.p,{children:"Indicates if the last send or receive operation timed out. You can test this following a successful call to determine if the operation timed out. The timeout on a send is only relevant if you have selected a quality of service which indicates that the broker should confirm receipt of the message ($$$QOSWaitForDelivery specified on the send)."}),"\n",(0,n.jsx)(t.h3,{id:"handle",children:"Handle"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property Handle As %Integer [ InitialExpression = 0, Private ];\n"})}),"\n",(0,n.jsx)(t.p,{children:"This holds the handle to the library's instance of the MQTT client"}),"\n",(0,n.jsx)(t.h3,{id:"urlscheme",children:"UrlScheme"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property UrlScheme As %String [ Private ];\n"})}),"\n",(0,n.jsx)(t.p,{children:"This holds the url scheme, tcp or ssl"}),"\n",(0,n.jsx)(t.h3,{id:"clientid",children:"ClientId"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Property ClientId As %String [ ReadOnly ];\n"})}),"\n",(0,n.jsx)(t.p,{children:"This holds the client id"}),"\n",(0,n.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(t.h3,{id:"onnew",children:"%OnNew"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method %OnNew(url As %String, clientid As %String = "", qos As %Integer = {$$$QOSFireAndForget}, keepaliveinterval As %Integer = {$$$KeepAliveInterval}, lwttopic As %String = "", lwtmessage As %String = "") As %Status\n'})}),"\n",(0,n.jsx)(t.p,{children:"When creating a new client instance at minimum the url to connect and a client id is required to be specified. The client id must be a utf-8 string which is used to uniquely identify the client. This takes the form \"tcp://localhost:1883\" where the scheme is tcp and the host and port are seperated by a colon. If you are using ssl you should specify the url in the form \"ssl://localhost:8883\" where scheme is ssl. The second parameter is a string which the broker can use to identify the client. The client will generate an id if not specified. The third parameter defines the required quality of service, 'Fire and Forget' or 'Wait for Delivery'. The fourth parameter is the keepalive interval. The client will send keepalive messages to the broker according to the specified interval. The final pair of parameters specifies the last will and testament topic and associated message. The LWT (last will and testament) feature tells the broker to deliver the Last Will message to the Last Will topic, should the client unexpectedly disconnect"}),"\n",(0,n.jsx)(t.p,{children:"Note, %New() can error so it's important to check that the return value with $IsObject() and examine the %objlasterror status value should the %New() not return a valid object."}),"\n",(0,n.jsx)(t.h3,{id:"connect",children:"Connect"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'Method Connect(username As %String = "", password As %String = "", cleansession As %Boolean = 1, timeout As %Integer = 1, sslconfig As %String = "") As %Status [ Final ]\n'})}),"\n",(0,n.jsx)(t.p,{children:"Connect to the broker specifying username and password if required. The cleansession argument can be set to 1 if a persistent session is required. Timeout is a connection timeout in seconds. If a secure connection using SSL is required then the name of an IRIS SSL configuration should be passed as the fifth argument. Please consult the documentation for an explanation of what it means to use a persistent session."}),"\n",(0,n.jsx)(t.h3,{id:"disconnect",children:"Disconnect"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Disconnect() As %Status [ Final ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Disconnect from the broker. It's important to disconnect from the broker when a connection is no longer required to free up system resources on both the broker and the client."}),"\n",(0,n.jsx)(t.h3,{id:"isconnected",children:"IsConnected"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method IsConnected(Output connected As %Boolean) As %Status\n"})}),"\n",(0,n.jsx)(t.p,{children:"Test to see if the client is connected. The library maintains a connection and it can be queried to determine if the client is currently connected. Disconnects can occur at any time due to network glitches so it's important to be able to determine the connection status."}),"\n",(0,n.jsx)(t.h3,{id:"publish",children:"Publish"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Publish(topic As %String, message As %String, retain As %Boolean = 0, timeout As %Integer = 1000) As %Status [ Final ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Send a message to a specified topic. Note that both should be utf-8 encoded. You may pass 1 as the retain argument if you want the broker to retain the message. Additionally if the QOS has been set to $$$QOSWaitForDelivery then the timeout argument will be used for the time to wait for an acknowledgement that the broker has received the message. After calling send you can check the TimedOut property to determine it's status."}),"\n",(0,n.jsx)(t.h3,{id:"subscribe",children:"Subscribe"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Subscribe(topic As %String) As %Status\n"})}),"\n",(0,n.jsx)(t.p,{children:"Call this to subscribe to the named topic. The topic must be utf-8 encoded. You must call this method before you attempt to Receive a message for the named topic."}),"\n",(0,n.jsx)(t.h3,{id:"receive",children:"Receive"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Receive(Output topic As %String, Output message As %String, timeout As %Integer = 1000) As %Status [ Final ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Listen for a message to be received for up to timeout milliseconds. If the timeout expires both the"}),"\n",(0,n.jsx)(t.p,{children:"topic and message will be set to the empty string. Additionally the TimedOut property will be set accordingly"}),"\n",(0,n.jsx)(t.h3,{id:"unsubscribe",children:"Unsubscribe"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Unsubscribe(topic As %String) As %Status [ Final ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Unsubscribe from a topic. After calling this the client will stop receiving messages for the"}),"\n",(0,n.jsx)(t.p,{children:"specific topic. Topic must be utf-8 encoded."}),"\n",(0,n.jsx)(t.h3,{id:"onclose",children:"%OnClose"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method %OnClose() As %Status\n"})}),"\n",(0,n.jsx)(t.h3,{id:"decodeerror",children:"DecodeError"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method DecodeError(list As %String) As %Status [ Final, Internal, Private ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Private, Decode an error reported by the library and form status"}),"\n",(0,n.jsx)(t.h3,{id:"create",children:"Create"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Create(url As %String, clientid As %String, qos As %Integer, keepaliveinterval As %Integer, lwttopic As %String, lwtmessage As %String) As %Status [ Final, Internal, Private ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Private, Create a client"}),"\n",(0,n.jsx)(t.h3,{id:"destroy",children:"Destroy"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Method Destroy() As %Status [ Final, Internal, Private ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Private, Destroy a client"})]})}function o(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>c,x:()=>a});var n=s(96540);const i={},r=n.createContext(i);function c(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);