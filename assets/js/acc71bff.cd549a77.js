"use strict";(self.webpackChunkdocs_intersystems=self.webpackChunkdocs_intersystems||[]).push([[72084],{48255:(e,t,s)=>{s.r(t),s.d(t,{contentTitle:()=>a,default:()=>d,frontMatter:()=>o,toc:()=>r});var n=s(74848),i=s(28453);const o={pagination_prev:null,pagination_next:null},a="%SYS.OAuth2.AccessToken",r=[{value:"Methods",id:"methods",level:2},{value:"AddAccessToken",id:"addaccesstoken",level:3},{value:"AuthorizeWithAccessToken",id:"authorizewithaccesstoken",level:3},{value:"RemoveAuthorizationAccessToken",id:"removeauthorizationaccesstoken",level:3},{value:"GetAccessTokenFromRequest",id:"getaccesstokenfromrequest",level:3},{value:"AddAuthentication",id:"addauthentication",level:3},{value:"GetAuthenticationJWT",id:"getauthenticationjwt",level:3},{value:"IsAuthorized",id:"isauthorized",level:3},{value:"GetAccessToken",id:"getaccesstoken",level:3},{value:"RemoveAccessToken",id:"removeaccesstoken",level:3},{value:"GetUserinfo",id:"getuserinfo",level:3},{value:"GetIntrospection",id:"getintrospection",level:3},{value:"RevokeToken",id:"revoketoken",level:3},{value:"IsAudContained",id:"isaudcontained",level:3},{value:"IsScopeContained",id:"isscopecontained",level:3},{value:"GetSSLConfigFromClient",id:"getsslconfigfromclient",level:3},{value:"GetEndpointsFromClient",id:"getendpointsfromclient",level:3},{value:"RevokeTokenInternal",id:"revoketokeninternal",level:3}];function c(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"sysoauth2accesstoken",children:"%SYS.OAuth2.AccessToken"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"Class %SYS.OAuth2.AccessToken Extends %RegisteredObject [ System = 4 ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"The %SYS.OAuth2.AccessToken class defines the client operations which allow an access token to be used to authorize to a resource server."}),"\n",(0,n.jsxs)(t.p,{children:["The underlying token is stored in OAuth2.AccessToken in the system database. OAuth2.AccessToken is indexed by the combination of SessionId and ApplicationName. Therefore, only one scope may be requested for each SessionId/ApplicationName. If a second request is made with a different scope and access token has yet been granted, the scope in the new request becomes the expected scope.",(0,n.jsx)(t.br,{}),"\nNote that this class is in library and thus available everywhere. However, token storage is in the system database and thus not directly available to most code."]}),"\n",(0,n.jsx)(t.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(t.h3,{id:"addaccesstoken",children:"AddAccessToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod AddAccessToken(httpRequest As %Net.HttpRequest, type As %String = "header", sslConfiguration As %String, applicationName As %String, sessionId As %String) As %Status\n'})}),"\n",(0,n.jsxs)(t.p,{children:["AddAccessToken adds the bearer access token associated with applicationName and sessionId to the resource server request as defined by RFC 6750. The sslConfiguration that is specified for the client is added to the httpRequest object. This method is used to prepare requests from the Client to the Resource Server. The type argument specifies one of three ways defined by RFC 6750 to send the access token to the Resource Server:",(0,n.jsx)(t.br,{}),'\n"header" to use Bearer token HTTP header.',(0,n.jsx)(t.br,{}),'\n"body" to use form encoded body. In this case, request must be a POST with form encoded body.',(0,n.jsx)(t.br,{}),'\n"query" to use a query parameter.',(0,n.jsx)(t.br,{}),"\nThe sslConfiguration is the name of the Security.SSLConfigs object to use for this request. The default for sslConfiguration comes from the OAuth2.Client instance."]}),"\n",(0,n.jsx)(t.h3,{id:"authorizewithaccesstoken",children:"AuthorizeWithAccessToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod AuthorizeWithAccessToken(httpRequest As %Net.HttpRequest, type As %String = "header", sslConfiguration As %String, applicationName As %String, accessToken As %String) As %Status\n'})}),"\n",(0,n.jsxs)(t.p,{children:["AuthorizeWithAccessToken adds the bearer access token which is passed as an argument to this method to the resource server request as defined by RFC 6750. The sslConfiguration that is specified for the client is added to the httpRequest object. This method is used to prepare requests from the Client to the Resource Server. The type argument specifies one of three ways defined by RFC 6750 to send the access token to the Resource Server:",(0,n.jsx)(t.br,{}),'\n"header" to use Bearer token HTTP header.',(0,n.jsx)(t.br,{}),'\n"body" to use form encoded body. In this case, request must be a POST with form encoded body.',(0,n.jsx)(t.br,{}),'\n"query" to use a query parameter.',(0,n.jsx)(t.br,{}),"\nThe sslConfiguration is the name of the Security.SSLConfigs object to use for this request. The default for sslConfiguration comes from the OAuth2.Client instance."]}),"\n",(0,n.jsx)(t.h3,{id:"removeauthorizationaccesstoken",children:"RemoveAuthorizationAccessToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod RemoveAuthorizationAccessToken(httpRequest As %Net.HttpRequest, type As %String = "header") As %Status\n'})}),"\n",(0,n.jsx)(t.p,{children:"RemoveAuthorizationAccessToken removes the access token from the %Net.HttpRequest object."}),"\n",(0,n.jsx)(t.h3,{id:"getaccesstokenfromrequest",children:"GetAccessTokenFromRequest"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetAccessTokenFromRequest(Output sc As %Status) As %String\n"})}),"\n",(0,n.jsx)(t.p,{children:"GetAccessTokenFromRequest returns the access token which is found in the HTTP request using one of the three RFC 6750 formats (See AddAccessToken above). The access token should be validated using a Validate method or a user written Validate method. This method is used by the Resource Server to authorize requests from the Client."}),"\n",(0,n.jsx)(t.h3,{id:"addauthentication",children:"AddAuthentication"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod AddAuthentication(applicationName As %String, httpRequest As %Net.HttpRequest) As %Status\n"})}),"\n",(0,n.jsx)(t.p,{children:'AddAuthication adds the required authentication for the token request and the SSLConfiguration that is specified for the client. See "token_endpoint_auth_method" property of OAuth2.Client.Metadata. This method is used for sending HTTP requests to the Authorization Server.'}),"\n",(0,n.jsx)(t.h3,{id:"getauthenticationjwt",children:"GetAuthenticationJWT"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetAuthenticationJWT(client As OAuth2.Client, httpRequest As %Net.HttpRequest, authType As %String, Output jwt As %String) As %Status [ Internal ]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Create a JWT for using in authenticating to the authorization server."}),"\n",(0,n.jsx)(t.h3,{id:"isauthorized",children:"IsAuthorized"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:'ClassMethod IsAuthorized(applicationName As %String, sessionId As %String, scope As %String = "", Output accessToken As %String, Output IDToken As %String, Output responseProperties, Output error As %OAuth2.Error) As %Boolean\n'})}),"\n",(0,n.jsxs)(t.p,{children:["IsAuthorized returns true if the applicationName and sessionId combination has an access token which authorizes all the scopes that are specified by the scope argument.",(0,n.jsx)(t.br,{}),"\napplicationName is the name of the application that is being authorized.",(0,n.jsx)(t.br,{}),"\nsessionId is the session id. sessionId defaults to %session.SessionId and will usually not be specified.",(0,n.jsx)(t.br,{}),"\nscope is a blank separated list of scopes.",(0,n.jsx)(t.br,{}),"\nresponseProperties will be returned as a local array specifying the properties that were included in the token response in the form properties(name)=value.",(0,n.jsx)(t.br,{}),"\nThe access token is returned in the accessToken argument."]}),"\n",(0,n.jsx)(t.h3,{id:"getaccesstoken",children:"GetAccessToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetAccessToken(applicationName As %String, sessionId As %String, Output scope As %String, Output accessToken As %String, Output IDToken As %String, Output responseProperties, Output error As %OAuth2.Error) As %Boolean [ Internal ]\n"})}),"\n",(0,n.jsxs)(t.p,{children:["GetAccessToken is an internal method to get (a possibly refreshed access token) for the applicationName and SessionId combination.",(0,n.jsx)(t.br,{}),"\nresponseProperties will be returned as a local array specifying the properties that were included in the token response in the form properties(name)=value."]}),"\n",(0,n.jsx)(t.h3,{id:"removeaccesstoken",children:"RemoveAccessToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod RemoveAccessToken(applicationName As %String, sessionId As %String) As %Status\n"})}),"\n",(0,n.jsx)(t.p,{children:"Remove the token associated with the specified application and session from the client"}),"\n",(0,n.jsx)(t.h3,{id:"getuserinfo",children:"GetUserinfo"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetUserinfo(applicationName As %String, accessToken As %String, IDTokenObject As %RegisteredObject, Output jsonObject As %RegisteredObject, Output securityParameters As %String) As %Status\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Retrieve the JSON object that is returned from the userinfo endpoint for the specified access token. The request is authorized using the specified access token. If the userinfo endpoint returns a JWT, then the object is optionally decrypted and the signature checked.",(0,n.jsx)(t.br,{}),"\nIf IDTokenObject is passed as the object returned by ##class(%SYS.OAuth2.Validation).ValidateIDToken and is used to check the sub property.",(0,n.jsx)(t.br,{}),"\nThe claims returned by the userinfo endpoint are returned as the properties of jsonObject.",(0,n.jsx)(t.br,{}),"\nsecurityParameters is returned as a local array of Strings that that indicate the algorithms that were used for JSON Object Signature and/or Encryption operations that were performed on the JWT by the authorization server"]}),"\n",(0,n.jsxs)(t.p,{children:["For JSON Web Signature (JWS):",(0,n.jsx)(t.br,{}),'\nsecurityParameters("sigalg") - Signature or MAC algorithm']}),"\n",(0,n.jsxs)(t.p,{children:["For JSON Web Encryption (JWE):",(0,n.jsx)(t.br,{}),'\nsecurityParameters("keyalg") - Key management algorithm',(0,n.jsx)(t.br,{}),'\nsecurityParameters("encalg") - Content encryption algorithm',(0,n.jsx)(t.br,{}),"\nSee %OAuth2.JWT for the list of supported algorithms."]}),"\n",(0,n.jsx)(t.h3,{id:"getintrospection",children:"GetIntrospection"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetIntrospection(applicationName As %String, accessToken As %String, Output jsonObject As %RegisteredObject) As %Status\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Retrieves the JSON object which contains claims about accessToken that is returned from the introspection endpoint. The request is authorized using the basic authorization HTTP header with the client_id and client_secret associated with applicationName.",(0,n.jsx)(t.br,{}),"\nThe claims returned by the introspection endpoint are returned as the properties of jsonObject."]}),"\n",(0,n.jsx)(t.h3,{id:"revoketoken",children:"RevokeToken"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod RevokeToken(applicationName As %String, accessToken As %String) As %Status\n"})}),"\n",(0,n.jsxs)(t.p,{children:["RevokeToken invalidates the access token using the revocation endpoint. This method will be called automatically when the session holding the token is deleted. This method may also be called from user code to make the token no longer valid. RevokeToken will call %SYS.OAuth2.AccessToken.Remove to remove the token from the client.",(0,n.jsx)(t.br,{}),"\nThe request is authorized using the basic authorization HTTP header with the client_id and client_secret associated with applicationName."]}),"\n",(0,n.jsx)(t.h3,{id:"isaudcontained",children:"IsAudContained"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod IsAudContained(containingAud As %DynamicArray, aud As %String) As %Boolean\n"})}),"\n",(0,n.jsx)(t.p,{children:"Check that specified audience is contained in the containing audience list. containingAud may either be a single audience as %String or a list of audiences as %DynamicArray."}),"\n",(0,n.jsx)(t.h3,{id:"isscopecontained",children:"IsScopeContained"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod IsScopeContained(containingScope As %String, scope As %String) As %Boolean\n"})}),"\n",(0,n.jsx)(t.p,{children:"Check that scope is subset of valid scopes for this token."}),"\n",(0,n.jsx)(t.h3,{id:"getsslconfigfromclient",children:"GetSSLConfigFromClient"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetSSLConfigFromClient(applicationName As %String, ByRef sc As %Status) As %String [ Internal, Private ]\n"})}),"\n",(0,n.jsx)(t.h3,{id:"getendpointsfromclient",children:"GetEndpointsFromClient"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod GetEndpointsFromClient(applicationName As %String, ByRef sc As %Status) As %DynamicObject [ Internal, Private ]\n"})}),"\n",(0,n.jsx)(t.h3,{id:"revoketokeninternal",children:"RevokeTokenInternal"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-objectscript-class",children:"ClassMethod RevokeTokenInternal(accessToken As %String) As %Status [ Internal, Private ]\n"})})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>r});var n=s(96540);const i={},o=n.createContext(i);function a(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);